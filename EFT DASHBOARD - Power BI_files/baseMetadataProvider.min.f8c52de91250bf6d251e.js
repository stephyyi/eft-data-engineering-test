const realmIdHttpHeaderName="x-ms-fabric-realm-id",realmCommonGlobals=window;function getRealmId(){return realmCommonGlobals.realmInfo?.realmId}function shouldApplyRealm(){return!!realmCommonGlobals.realmInFabricShellEnabled&&!!getRealmId()}var powerbi;function addOrUpdateQueryString(e,t,a=window.location.search){let n=parseQueryString(a);return n[e]=t,rebuildQueryString(n)}function clearQueryString(e,t=window.location.search){let a=parseQueryString(t);return delete a[e],rebuildQueryString(a)}function parseQueryString(e=window.location.search){let a={};return new URLSearchParams(e).forEach((e,t)=>{a[t]=e}),a}function rebuildQueryString(e){let t="",a=!0;for(var n in e)a||(t+="&"),t+=encodeURIComponent(n)+"=",e[n]&&(t+=encodeURIComponent(e[n])),a=!1;return a||(t="?"+t),t}function setCookie(e,t,a="/",n="none",o){o||(o=new Date).setFullYear(o.getFullYear()+1),window&&window.document&&(window.document.cookie=e+" = "+t+";secure;partitioned;path="+a+";expires="+o.toUTCString()+";samesite="+n)}function startBaseMetadataLogRequest(e,t,a){t={url:e,start:new Date,requestId:t,realmId:getRealmId()};return window[a].push(t),t}function endBaseMetadataLogRequest(e,t,a,n,o,r,i){e.end=new Date,e.isError=t,e.code=a,e.errorMessage=n,e.parseStart=r,e.parseEnd=i,e.size=o}function getBaseMetadata(a){const n=window;return new Promise((e,t)=>{n.clientAuthEnabled?n.signInPromise.then(()=>{window.baseMetadataFromClient?getBaseMetadataInternal(!1,a).then(()=>{e(!0)}).catch(()=>{e(!0)}):e(!0)}).catch(()=>{t(!0)}):window.baseMetadataFromClient?getBaseMetadataInternal(!1,a).then(()=>{e(!0)}).catch(()=>{e(!0)}):e(!0)})}function getBaseMetadataInternal(L,C){const v=window;return new Promise((h,b)=>{let e=window.clusterUri;var t=("/"===e.substring(e.length-1)?e:e+"/")+"metadata/bootstrap/base",a=L?window.baseMetadataRetryRequestId:window.baseMetadataRequestId;let I=startBaseMetadataLogRequest(t,a,"getBaseMetadataInfo");try{let p=new XMLHttpRequest;p.open("GET",t,!0),p.setRequestHeader("Accept","application/json"),p.setRequestHeader("Authorization","Bearer "+window.powerBIAccessToken),p.setRequestHeader("ActivityId",window.telemetrySessionId),p.setRequestHeader("RequestId",a),p.setRequestHeader("X-PowerBI-Auto-License-Info","AutoLicenseAssignmentSupported"),null!==window.aadConsistencyHeaderScenarioId&&""!==window.aadConsistencyHeaderScenarioId&&p.setRequestHeader("ConsistencyLevel","Organization;ScenarioId="+window.aadConsistencyHeaderScenarioId),null!==powerbi.getQueryStringValue("redirectedFromSignup")&&p.setRequestHeader("X-PowerBI-RedirectedFromSignup","true"),shouldApplyRealm()&&p.setRequestHeader(realmIdHttpHeaderName,getRealmId()),p.onreadystatechange=async function(){let n;try{if(p.readyState===XMLHttpRequest.DONE){n=p.status;let a=p.getAllResponseHeaders();if(200<=n&&n<300||304===n){var t=new Date;const f=JSON.parse(p.responseText);var o,r,i,s,d=new Date;window.powerbi;if(window.featureSwitches=f.clientFeatureSwitches,window.navPreferences=f.navPreferences,window.placeExpAssignmentContextOnPage&&(window.expAssignmentContext=f.expAssignmentContext),f&&f.branding&&f.branding.config){let a=JSON.parse(f.branding.config),n={},e=Object.keys(a);e.forEach(e=>{var t=e[0].toLowerCase()+e.substring(1);n[t]=a[e]}),f.branding.config=n}if(window.placeBrandingInfoOnPage&&(window.brandInfo=f.branding),window.placeAutoLicenseAssignmentStateOnPage){let e;!a||-1===a.indexOf("x-powerbi-auto-license-info")&&-1===a.indexOf("X-PowerBI-Auto-License-Info")||(e=p.getResponseHeader("x-powerbi-auto-license-info"));let t=!1;e&&e.toLowerCase()==="AutoLicenseAssignmentSucceeded".toLowerCase()&&(g=-1!==C.href.indexOf("/teams"),m=function(e){for(var t of["iphone","ipad","android"])if(e.toLowerCase().includes(t))return!0;return!1}(window.navigator.userAgent),g&&m&&(C.href="/TeamsMobileAutoLicense?originalUrl="+encodeURIComponent(C.href)),t=!0),S()&&(S().hasAutoAssignedLicense=t),window.hasAutoAssignedLicense=t}let e=f.userSettings.preferredLanguage;e&&0<e.length?(setCookie("PreferredLanguage",e),e.toLowerCase()!==R().toLowerCase()&&null===powerbi.getQueryStringValue("language")&&(o=C.origin+C.pathname,r=addOrUpdateQueryString("language",e,C.search),C.href=o+r)):""===e&&(setCookie("PreferredLanguage",e),window.navigator&&window.navigator.language&&window.navigator.language.toLowerCase()!==R().toLowerCase()&&null===powerbi.getQueryStringValue("language")&&(i=C.origin+C.pathname,s=addOrUpdateQueryString("language",window.navigator.language,C.search),C.href=i+s)),endBaseMetadataLogRequest(I,!1,n.toString(),void 0,p.responseText.length,t,d),h(f)}else if(isCAEClaimChallenge(n,p)&&v.teamsCAE&&("Teams"===v.hostPlatformName||"TeamsModern"===v.hostPlatformName||!0===v.inTeams)){var u;for(u of[v.metaOSAccessTokenKeyPrefix+v.hostPlatformName+"_"+v.hostPlatformType,v.metaOSUserInfoKeyPrefix+v.hostPlatformName+"_"+v.hostPlatformType])window.localStorage.removeItem(u);let e=new URL(C.href);e.searchParams.append("TeamsCAEinWFE","true"),C.href="/teams/TeamsAuthentication?"+encodeURIComponent(e.toString())}else{let t;if(!a||-1===a.indexOf("x-powerbi-error-info")&&-1===a.indexOf("X-PowerBI-Error-Info")||(t=p.getResponseHeader("x-powerbi-error-info")),0===n&&!t&&window.navigator&&(t="NavigatorOnLineProperty="+window.navigator.onLine),0===n||404===n||408===n||500<=n&&n<600)if(L)endBaseMetadataLogRequest(I,!0,n.toString(),t,void 0,void 0,void 0),b(t);else if(0===n)setTimeout(async()=>{try{var e=await getBaseMetadataInternal(!0,C);h(e)}catch(e){b(e)}},1e3);else try{var e=await getBaseMetadataInternal(!0,C);h(e)}catch(e){b(e)}else if(t&&t.toLowerCase()==="UserNotLicensed".toLowerCase()){endBaseMetadataLogRequest(I,!0,n.toString(),t,void 0,void 0,void 0);let e;if(!a||-1===a.indexOf("x-powerbi-auto-license-info")&&-1===a.indexOf("X-PowerBI-Auto-License-Info")||(e=p.getResponseHeader("x-powerbi-auto-license-info")),e&&e.toLowerCase()==="AutoLicenseAssignmentDisabledByTenant".toLowerCase())C.href="https://aka.ms/pbiAdHocSubscriptionNotAllowed";else{var l=window.staticPageRedirectInTeams,w=powerbi.getQueryStringValue("route"),c=-1!==C.href.indexOf("/teams/");let e,t;e=w&&0<w.length?(t=clearQueryString("route",C.search),C.origin+"/"+w):(t=C.search,C.origin+C.pathname),C.href=c&&l?"/StaticTeamsSignUp?originalUrl="+encodeURIComponent(C.href)+"&redirectUrl="+encodeURIComponent(e+t):"/SignupRedirect?ru="+e+t}b(t)}else endBaseMetadataLogRequest(I,!0,n.toString(),t,void 0,void 0,void 0),b(t)}}}catch(e){I.end||endBaseMetadataLogRequest(I,!0,n.toString(),e.message,void 0,void 0,void 0),b(e.message)}var g,m},p.send()}catch(e){I.end||endBaseMetadataLogRequest(I,!0,"No status code",e.message,void 0,void 0,void 0),b(e.message)}function S(){return function(){let e=n();e.session||(e.session={});return e.session}().userInfo}function R(){return function(){let e=n();e.common||(e.common={});return e.common}().cultureInfo}function n(){return window.powerbi||(window.powerbi={}),window.powerbi}})}(powerbi||(powerbi={})).getQueryStringValue=function(a,e){let n=!1,o=null;return new URLSearchParams(e||window.location.search).forEach((e,t)=>{t!==a||n||(n=!0,o=e)}),o};const baseMetadataWindow=window;function isCAEClaimChallenge(e,t){const a=t.getResponseHeader("WWW-Authenticate");return 401===e&&a?.includes("error")}baseMetadataWindow.getBaseMetadataInfo=[],baseMetadataWindow.deferBaseMetadataPromise?baseMetadataWindow.getBaseMetadata=getBaseMetadata:baseMetadataWindow.baseMetadataPromise=getBaseMetadata(window.location);