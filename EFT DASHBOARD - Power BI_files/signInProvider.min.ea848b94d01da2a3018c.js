!function(){"use strict";var n,e,Io={0:function(n,e,t){t.d(e,{t:function(){return o}});var r=t(726),i=t(761);class o extends r.B7{constructor(s){super(),this._value=s}get value(){return this.getValue()}_subscribe(s){var c=super._subscribe(s);return c&&!c.closed&&s.next(this._value),c}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new i.P;return this._value}next(s){super.next(this._value=s)}}},199:function(n,e,t){t.d(e,{E:function(){return u}});var r=t(603),o=t(151),a=t(712),c=t(527);var u=(()=>{class f{constructor(m,A,y){this.kind=m,this.value=A,this.error=y,this.hasValue="N"===m}observe(m){switch(this.kind){case"N":return m.next&&m.next(this.value);case"E":return m.error&&m.error(this.error);case"C":return m.complete&&m.complete()}}do(m,A,y){switch(this.kind){case"N":return m&&m(this.value);case"E":return A&&A(this.error);case"C":return y&&y()}}accept(m,A,y){return m&&"function"==typeof m.next?this.observe(m):this.do(m,A,y)}toObservable(){switch(this.kind){case"N":return function(...f){var p=f[f.length-1];return function(f){return f&&"function"==typeof f.schedule}(p)?(f.pop(),(0,a.V)(f,p)):(0,o.c)(f)}(this.value);case"E":return function(f){return new c.c(m=>m.error(f))}(this.error);case"C":return(0,r.I)()}throw new Error("unexpected notification kind value")}static createNext(m){return typeof m<"u"?new f("N",m):f.undefinedValueNotification}static createError(m){return new f("E",void 0,m)}static createComplete(){return f.completeNotification}}return f.completeNotification=new f("C"),f.undefinedValueNotification=new f("N",void 0),f})()},527:function(n,e,t){t.d(e,{c:function(){return f}});var r=t(874),o=t(275),a=t(930),c=t(266);function l(m){return m}var u=t(206),f=(()=>{class m{constructor(y){this._isScalar=!1,y&&(this._subscribe=y)}lift(y){var _=new m;return _.source=this,_.operator=y,_}subscribe(y,_,K){var{operator:Y}=this,H=function(m,A,y){if(m){if(m instanceof r.v)return m;if(m[o.D])return m[o.D]()}return m||A||y?new r.v(m,A,y):new r.v(a.I)}(y,_,K);if(H.add(Y?Y.call(H,this.source):this.source||u.$.useDeprecatedSynchronousErrorHandling&&!H.syncErrorThrowable?this._subscribe(H):this._trySubscribe(H)),u.$.useDeprecatedSynchronousErrorHandling&&H.syncErrorThrowable&&(H.syncErrorThrowable=!1,H.syncErrorThrown))throw H.syncErrorValue;return H}_trySubscribe(y){try{return this._subscribe(y)}catch(_){u.$.useDeprecatedSynchronousErrorHandling&&(y.syncErrorThrown=!0,y.syncErrorValue=_),function(m){for(;m;){var{closed:A,destination:y,isStopped:_}=m;if(A||_)return!1;m=y&&y instanceof r.v?y:null}return!0}(y)&&y.error(_)}}forEach(y,_){return new(_=p(_))((K,Y)=>{var H;H=this.subscribe(te=>{try{y(te)}catch(Ue){Y(Ue),H&&H.unsubscribe()}},Y,K)})}_subscribe(y){var{source:_}=this;return _&&_.subscribe(y)}[c.s](){return this}pipe(...y){return 0===y.length?this:function(m){return 0===m.length?l:1===m.length?m[0]:function(y){return m.reduce((_,K)=>K(_),y)}}(y)(this)}toPromise(y){return new(y=p(y))((_,K)=>{var Y;this.subscribe(H=>Y=H,H=>K(H),()=>_(Y))})}}return m.create=A=>new m(A),m})();function p(m){if(m||(m=u.$.Promise||Promise),!m)throw new Error("no Promise impl found");return m}},930:function(n,e,t){t.d(e,{I:function(){return o}});var r=t(206),i=t(773),o={closed:!0,next(a){},error(a){if(r.$.useDeprecatedSynchronousErrorHandling)throw a;(0,i.T)(a)},complete(){}}},726:function(n,e,t){t.d(e,{B7:function(){return d}});var r=t(527),i=t(874),o=t(492),a=t(761),s=t(163),c=t(275);class l extends i.v{constructor(f){super(f),this.destination=f}}var d=(()=>{class u extends r.c{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[c.D](){return new l(this)}lift(p){var m=new h(this,this);return m.operator=p,m}next(p){if(this.closed)throw new a.P;if(!this.isStopped)for(var{observers:m}=this,A=m.length,y=m.slice(),_=0;_<A;_++)y[_].next(p)}error(p){if(this.closed)throw new a.P;this.hasError=!0,this.thrownError=p,this.isStopped=!0;for(var{observers:m}=this,A=m.length,y=m.slice(),_=0;_<A;_++)y[_].error(p);this.observers.length=0}complete(){if(this.closed)throw new a.P;this.isStopped=!0;for(var{observers:p}=this,m=p.length,A=p.slice(),y=0;y<m;y++)A[y].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(p){if(this.closed)throw new a.P;return super._trySubscribe(p)}_subscribe(p){if(this.closed)throw new a.P;return this.hasError?(p.error(this.thrownError),o.y.EMPTY):this.isStopped?(p.complete(),o.y.EMPTY):(this.observers.push(p),new s.Y(this,p))}asObservable(){var p=new r.c;return p.source=this,p}}return u.create=(f,p)=>new h(f,p),u})();class h extends d{constructor(f,p){super(),this.destination=f,this.source=p}next(f){var{destination:p}=this;p&&p.next&&p.next(f)}error(f){var{destination:p}=this;p&&p.error&&this.destination.error(f)}complete(){var{destination:f}=this;f&&f.complete&&this.destination.complete()}_subscribe(f){var{source:p}=this;return p?this.source.subscribe(f):o.y.EMPTY}}},163:function(n,e,t){t.d(e,{Y:function(){return i}});var r=t(492);class i extends r.y{constructor(a,s){super(),this.subject=a,this.subscriber=s,this.closed=!1}unsubscribe(){if(!this.closed){this.closed=!0;var a=this.subject,s=a.observers;if(this.subject=null,s&&0!==s.length&&!a.isStopped&&!a.closed){var c=s.indexOf(this.subscriber);-1!==c&&s.splice(c,1)}}}}},874:function(n,e,t){t.d(e,{v:function(){return l}});var r=t(507),i=t(930),o=t(492),a=t(275),s=t(206),c=t(773);class l extends o.y{constructor(u,f,p){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=i.I;break;case 1:if(!u){this.destination=i.I;break}if("object"==typeof u){u instanceof l?(this.syncErrorThrowable=u.syncErrorThrowable,this.destination=u,u.add(this)):(this.syncErrorThrowable=!0,this.destination=new d(this,u));break}default:this.syncErrorThrowable=!0,this.destination=new d(this,u,f,p)}}[a.D](){return this}static create(u,f,p){var m=new l(u,f,p);return m.syncErrorThrowable=!1,m}next(u){this.isStopped||this._next(u)}error(u){this.isStopped||(this.isStopped=!0,this._error(u))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(u){this.destination.next(u)}_error(u){this.destination.error(u),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){var{_parentOrParents:u}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=u,this}}class d extends l{constructor(u,f,p,m){super(),this._parentSubscriber=u;var A,y=this;(0,r.T)(f)?A=f:f&&(A=f.next,p=f.error,m=f.complete,f!==i.I&&(y=Object.create(f),(0,r.T)(y.unsubscribe)&&this.add(y.unsubscribe.bind(y)),y.unsubscribe=this.unsubscribe.bind(this))),this._context=y,this._next=A,this._error=p,this._complete=m}next(u){if(!this.isStopped&&this._next){var{_parentSubscriber:f}=this;s.$.useDeprecatedSynchronousErrorHandling&&f.syncErrorThrowable?this.__tryOrSetError(f,this._next,u)&&this.unsubscribe():this.__tryOrUnsub(this._next,u)}}error(u){if(!this.isStopped){var{_parentSubscriber:f}=this,{useDeprecatedSynchronousErrorHandling:p}=s.$;if(this._error)p&&f.syncErrorThrowable?(this.__tryOrSetError(f,this._error,u),this.unsubscribe()):(this.__tryOrUnsub(this._error,u),this.unsubscribe());else if(f.syncErrorThrowable)p?(f.syncErrorValue=u,f.syncErrorThrown=!0):(0,c.T)(u),this.unsubscribe();else{if(this.unsubscribe(),p)throw u;(0,c.T)(u)}}}complete(){if(!this.isStopped){var{_parentSubscriber:u}=this;if(this._complete){var f=()=>this._complete.call(this._context);s.$.useDeprecatedSynchronousErrorHandling&&u.syncErrorThrowable?(this.__tryOrSetError(u,f),this.unsubscribe()):(this.__tryOrUnsub(f),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(u,f){try{u.call(this._context,f)}catch(p){if(this.unsubscribe(),s.$.useDeprecatedSynchronousErrorHandling)throw p;(0,c.T)(p)}}__tryOrSetError(u,f,p){if(!s.$.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{f.call(this._context,p)}catch(m){return s.$.useDeprecatedSynchronousErrorHandling?(u.syncErrorValue=m,u.syncErrorThrown=!0,!0):((0,c.T)(m),!0)}return!1}_unsubscribe(){var{_parentSubscriber:u}=this;this._context=null,this._parentSubscriber=null,u.unsubscribe()}}},492:function(n,e,t){t.d(e,{y:function(){return c}});var r=t(666),i=t(880),o=t(507),s=(()=>{function d(h){return Error.call(this),this.message=h?`${h.length} errors occurred during unsubscription:\n${h.map((u,f)=>`${f+1}) ${u.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=h,this}return d.prototype=Object.create(Error.prototype),d})(),c=(()=>{class d{constructor(u){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,u&&(this._ctorUnsubscribe=!0,this._unsubscribe=u)}unsubscribe(){var u;if(!this.closed){var{_parentOrParents:f,_ctorUnsubscribe:p,_unsubscribe:m,_subscriptions:A}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,f instanceof d)f.remove(this);else if(null!==f)for(var y=0;y<f.length;++y)f[y].remove(this);if((0,o.T)(m)){p&&(this._unsubscribe=void 0);try{m.call(this)}catch(te){u=te instanceof s?l(te.errors):[te]}}if((0,r.c)(A))for(var K=-1,Y=A.length;++K<Y;){var H=A[K];if((0,i.G)(H))try{H.unsubscribe()}catch(te){u=u||[],te instanceof s?u=u.concat(l(te.errors)):u.push(te)}}if(u)throw new s(u)}}add(u){var f=u;if(!u)return d.EMPTY;switch(typeof u){case"function":f=new d(u);case"object":if(f===this||f.closed||"function"!=typeof f.unsubscribe)return f;if(this.closed)return f.unsubscribe(),f;if(!(f instanceof d)){var p=f;(f=new d)._subscriptions=[p]}break;default:throw new Error("unrecognized teardown "+u+" added to Subscription.")}var{_parentOrParents:m}=f;if(null===m)f._parentOrParents=this;else if(m instanceof d){if(m===this)return f;f._parentOrParents=[m,this]}else{if(-1!==m.indexOf(this))return f;m.push(this)}var A=this._subscriptions;return null===A?this._subscriptions=[f]:A.push(f),f}remove(u){var f=this._subscriptions;if(f){var p=f.indexOf(u);-1!==p&&f.splice(p,1)}}}return d.EMPTY=((h=new d).closed=!0,h),d;var h})();function l(d){return d.reduce((h,u)=>h.concat(u instanceof s?u.errors:u),[])}},206:function(n,e,t){t.d(e,{$:function(){return i}});var r=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(o){o&&new Error,r=o},get useDeprecatedSynchronousErrorHandling(){return r}}},603:function(n,e,t){t.d(e,{I:function(){return o}});var r=t(527),i=new r.c(s=>s.complete());function o(s){return s?function(s){return new r.c(c=>s.schedule(()=>c.complete()))}(s):i}},151:function(n,e,t){t.d(e,{c:function(){return a}});var r=t(527),i=t(537),o=t(712);function a(s,c){return c?(0,o.V)(s,c):new r.c((0,i.v)(s))}},616:function(n,e,t){t.d(e,{p:function(){return i}});var r=t(874);function i(s,c){return function(d){return d.lift(new o(s,c))}}class o{constructor(c,l){this.predicate=c,this.thisArg=l}call(c,l){return l.subscribe(new a(c,this.predicate,this.thisArg))}}class a extends r.v{constructor(c,l,d){super(c),this.predicate=l,this.thisArg=d,this.count=0}_next(c){var l;try{l=this.predicate.call(this.thisArg,c,this.count++)}catch(d){return void this.destination.error(d)}l&&this.destination.next(c)}}},161:function(n,e,t){t.d(e,{QE:function(){return o},YZ:function(){return s}});var r=t(874),i=t(199);function o(l,d=0){return function(u){return u.lift(new a(l,d))}}class a{constructor(d,h=0){this.scheduler=d,this.delay=h}call(d,h){return h.subscribe(new s(d,this.scheduler,this.delay))}}class s extends r.v{constructor(d,h,u=0){super(d),this.scheduler=h,this.delay=u}static dispatch(d){var{notification:h,destination:u}=d;h.observe(u),this.unsubscribe()}scheduleMessage(d){this.destination.add(this.scheduler.schedule(s.dispatch,this.delay,new c(d,this.destination)))}_next(d){this.scheduleMessage(i.E.createNext(d))}_error(d){this.scheduleMessage(i.E.createError(d)),this.unsubscribe()}_complete(){this.scheduleMessage(i.E.createComplete()),this.unsubscribe()}}class c{constructor(d,h){this.notification=d,this.destination=h}}},208:function(n,e,t){t.d(e,{s:function(){return s}});var r=t(874),o=(()=>{function d(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return d.prototype=Object.create(Error.prototype),d})(),a=t(603);function s(d){return h=>0===d?(0,a.I)():h.lift(new c(d))}class c{constructor(h){if(this.total=h,this.total<0)throw new o}call(h,u){return u.subscribe(new l(h,this.total))}}class l extends r.v{constructor(h,u){super(h),this.total=u,this.count=0}_next(h){var u=this.total,f=++this.count;f<=u&&(this.destination.next(h),f===u&&(this.destination.complete(),this.unsubscribe()))}}},712:function(n,e,t){t.d(e,{V:function(){return o}});var r=t(527),i=t(492);function o(a,s){return new r.c(c=>{var l=new i.y,d=0;return l.add(s.schedule(function(){d!==a.length?(c.next(a[d++]),c.closed||l.add(this.schedule())):c.complete()})),l})}},548:function(n,e,t){t.d(e,{R:function(){return o}});var r=t(492);class i extends r.y{constructor(s,c){super()}schedule(s,c=0){return this}}class o extends i{constructor(s,c){super(s,c),this.scheduler=s,this.work=c,this.pending=!1}schedule(s,c=0){if(this.closed)return this;this.state=s;var l=this.id,d=this.scheduler;return null!=l&&(this.id=this.recycleAsyncId(d,l,c)),this.pending=!0,this.delay=c,this.id=this.id||this.requestAsyncId(d,this.id,c),this}requestAsyncId(s,c,l=0){return setInterval(s.flush.bind(s,this),l)}recycleAsyncId(s,c,l=0){if(null!==l&&this.delay===l&&!1===this.pending)return c;clearInterval(c)}execute(s,c){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var l=this._execute(s,c);if(l)return l;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(s,c){var l=!1,d=void 0;try{this.work(s)}catch(h){l=!0,d=!!h&&h||new Error(h)}if(l)return this.unsubscribe(),d}_unsubscribe(){var s=this.id,c=this.scheduler,l=c.actions,d=l.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==d&&l.splice(d,1),null!=s&&(this.id=this.recycleAsyncId(c,s,null)),this.delay=null}}},442:function(n,e,t){t.d(e,{q:function(){return i}});var r=(()=>{class o{constructor(s,c=o.now){this.SchedulerAction=s,this.now=c}schedule(s,c=0,l){return new this.SchedulerAction(this,s).schedule(l,c)}}return o.now=()=>Date.now(),o})();class i extends r{constructor(a,s=r.now){super(a,()=>i.delegate&&i.delegate!==this?i.delegate.now():s()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(a,s=0,c){return i.delegate&&i.delegate!==this?i.delegate.schedule(a,s,c):super.schedule(a,s,c)}flush(a){var{actions:s}=this;if(this.active)s.push(a);else{var c;this.active=!0;do{if(c=a.execute(a.state,a.delay))break}while(a=s.shift());if(this.active=!1,c){for(;a=s.shift();)a.unsubscribe();throw c}}}}},112:function(n,e,t){t.d(e,{g:function(){return c},T:function(){return s}});var r=t(548);class i extends r.R{constructor(d,h){super(d,h),this.scheduler=d,this.work=h}schedule(d,h=0){return h>0?super.schedule(d,h):(this.delay=h,this.state=d,this.scheduler.flush(this),this)}execute(d,h){return h>0||this.closed?super.execute(d,h):this._execute(d,h)}requestAsyncId(d,h,u=0){return null!==u&&u>0||null===u&&this.delay>0?super.requestAsyncId(d,h,u):d.flush(this)}}var o=t(442);class a extends o.q{}var s=new a(i),c=s},266:function(n,e,t){t.d(e,{s:function(){return r}});var r="function"==typeof Symbol&&Symbol.observable||"@@observable"},275:function(n,e,t){t.d(e,{D:function(){return r}});var r="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},761:function(n,e,t){t.d(e,{P:function(){return i}});var i=(()=>{function o(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return o.prototype=Object.create(Error.prototype),o})()},773:function(n,e,t){function r(i){setTimeout(()=>{throw i},0)}t.d(e,{T:function(){return r}})},666:function(n,e,t){t.d(e,{c:function(){return r}});var r=Array.isArray||(i=>i&&"number"==typeof i.length)},507:function(n,e,t){function r(i){return"function"==typeof i}t.d(e,{T:function(){return r}})},880:function(n,e,t){function r(i){return null!==i&&"object"==typeof i}t.d(e,{G:function(){return r}})},537:function(n,e,t){t.d(e,{v:function(){return r}});var r=i=>o=>{for(var a=0,s=i.length;a<s&&!o.closed;a++)o.next(i[a]);o.complete()}},235:function(n,e,t){t.d(e,{A:function(){return p}});var r,i=new Uint8Array(16);function o(){if(!r&&!(r=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)}for(var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,l=[],d=0;d<256;++d)l.push((d+256).toString(16).substr(1));var u=function(m){var A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=(l[m[A+0]]+l[m[A+1]]+l[m[A+2]]+l[m[A+3]]+"-"+l[m[A+4]]+l[m[A+5]]+"-"+l[m[A+6]]+l[m[A+7]]+"-"+l[m[A+8]]+l[m[A+9]]+"-"+l[m[A+10]]+l[m[A+11]]+l[m[A+12]]+l[m[A+13]]+l[m[A+14]]+l[m[A+15]]).toLowerCase();if(!function(m){return"string"==typeof m&&a.test(m)}(y))throw TypeError("Stringified UUID is invalid");return y},p=function(m,A,y){var _=(m=m||{}).random||(m.rng||o)();if(_[6]=15&_[6]|64,_[8]=63&_[8]|128,A){y=y||0;for(var K=0;K<16;++K)A[y+K]=_[K];return A}return u(_)}},390:function(n,e,t){function r(o,a,s,c,l,d,h){try{var u=o[d](h),f=u.value}catch(p){return void s(p)}u.done?a(f):Promise.resolve(f).then(c,l)}function i(o){return function(){var a=this,s=arguments;return new Promise(function(c,l){var d=o.apply(a,s);function h(f){r(d,c,l,h,u,"next",f)}function u(f){r(d,c,l,h,u,"throw",f)}h(void 0)})}}t.d(e,{A:function(){return i}})}},So={};function w(n){var e=So[n];if(void 0!==e)return e.exports;var t=So[n]={exports:{}};return Io[n](t,t.exports,w),t.exports}w.m=Io,w.d=function(n,e){for(var t in e)w.o(e,t)&&!w.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},w.f={},w.e=function(n){return Promise.all(Object.keys(w.f).reduce(function(e,t){return w.f[t](n,e),e},[]))},w.u=function(n){return"signInProvider."+(0===n?"app-insights":n)+".min."+{0:"fc3689ef7efe9406217f",SignInTelemetry:"3919bc4a3759151c2404"}[n]+".js"},w.miniCssF=function(n){},w.miniCssF=function(n){},w.miniCssF=function(n){},w.miniCssF=function(n){},w.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch{if("object"==typeof window)return window}}(),w.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},n={},e="clientAuthProvider:",w.l=function(t,r,i,o){if(n[t])n[t].push(r);else{var a,s;if(void 0!==i)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==e+i){a=d;break}}a||(s=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,w.nc&&a.setAttribute("nonce",w.nc),a.setAttribute("data-webpack",e+i),a.src=w.tu(t)),n[t]=[r];var h=function(p,m){a.onerror=a.onload=null,clearTimeout(f);var A=n[t];if(delete n[t],a.parentNode&&a.parentNode.removeChild(a),A&&A.forEach(function(y){return y(m)}),p)return p(m)},u=window.adjustCdnTimeoutThreshold?6e4:12e4,f=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),u);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),s&&document.head.appendChild(a)}},w.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},function(){var n;w.tt=function(){return void 0===n&&(n={createScriptURL:function(e){return e}},typeof trustedTypes<"u"&&trustedTypes.createPolicy&&(n=trustedTypes.createPolicy("angular#bundler",n))),n}}(),w.tu=function(n){return w.tt().createScriptURL(n)},function(){var n;w.g.importScripts&&(n=w.g.location+"");var e=w.g.document;if(!n&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(n=e.currentScript.src),!n)){var t=e.getElementsByTagName("script");if(t.length)for(var r=t.length-1;r>-1&&(!n||!/^http(s?):/.test(n));)n=t[r--].src}if(!n)throw new Error("Automatic publicPath is not supported in this browser");n=n.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),w.p=n}(),function(){var n=w.u,e=w.e,t={},r={};w.u=function(o){return n(o)+(t.hasOwnProperty(o)?"?"+t[o]:"")},w.e=function(o){return e(o).catch(function(s){var c=r.hasOwnProperty(o)?r[o]:5;if(window.adjustCdnTimeoutRetry&&"timeout"===s.type&&"True"===window.useCDN&&w.p.includes(window.cdnUrl)&&(c=0),c<1){var l=n(o);s.message="timeout"===s.type?s.message:"Loading chunk "+o+" failed after 5 retries.\n("+l+")",s.request=l;var h,d=new Date,u="unknown",f="unknown";if(window.cdnFallbackForLazyLoadBrowserRefreshed=!!window.cdnFallbackForLazyLoadBrowserRefreshed&&window.cdnFallbackForLazyLoadBrowserRefreshed,h=event&&event.currentTarget&&event.currentTarget.src||w.p+l,w.p.includes(window.cdnUrl)&&"True"===window.useCDN){if("function"==typeof window.performance?.getEntriesByName){var m=window.performance?.getEntriesByName(h)[0];m&&(u=m.responseStatus,f=m.duration)}var A="disablecdn=cdnRequestFailureTimestamp:"+d.toUTCString()+"-cdnRequestFailureUrl:"+h+"-sessionSource:"+window.sessionSource+"-statusCode:"+u+"-durationMs:"+f+"-loadType:lazy-errorType:"+s.type+"-documentHidden:"+document.hidden+"; max-age=28800; secure; partitioned; samesite=none",y="; cdnFallbackForLazyLoad: "+!!window.cdnFallbackForLazyLoad;if(window.telemetryService?.logTrace({type:4,text:"LazyLoadCDNFallback; error: "+JSON.stringify(s)+y+"; cookie: "+A}),window.telemetryService?.flush(),!document.hidden&&window.cdnFallbackForLazyLoad){try{document.cookie=A}catch{}var _=new URL(window.location.href);_.searchParams.set("disablecdnExpiration",Math.round(new Date/1e3+28800).toString()),window.cdnFallbackForLazyLoadBrowserRefreshed||(setTimeout(()=>{window.location.href=_.href},2e3),window.cdnFallbackForLazyLoadBrowserRefreshed=!0)}}throw s}return new Promise(function(K){setTimeout(function(){var te=Date.now();t[o]=te,r[o]=c-1,K(w.e(o))},3e3)})})}}(),function(){var n={1:0};w.f.j=function(r,i){var o=w.o(n,r)?n[r]:void 0;if(0!==o)if(o)i.push(o[2]);else{var a=new Promise(function(d,h){o=n[r]=[d,h]});i.push(o[2]=a);var s=w.p+w.u(r),c=new Error;w.l(s,function(d){if(w.o(n,r)&&(0!==(o=n[r])&&(n[r]=void 0),o)){var h=d&&("load"===d.type?"missing":d.type),u=d&&d.target&&d.target.src;c.message="Loading chunk "+r+" failed.\n("+h+": "+u+")",c.name="ChunkLoadError",c.type=h,c.request=u,o[1](c)}},"chunk-"+r,r)}};var e=function(r,i){var c,l,o=i[0],a=i[1],s=i[2],d=0;if(o.some(function(u){return 0!==n[u]})){for(c in a)w.o(a,c)&&(w.m[c]=a[c]);s&&s(w)}for(r&&r(i);d<o.length;d++)w.o(n,l=o[d])&&n[l]&&n[l][0](),n[l]=0},t=self.webpackChunkclientAuthProvider=self.webpackChunkclientAuthProvider||[];t.forEach(e.bind(null,0)),t.push=e.bind(null,t.push.bind(t))}();var Gn={};w.r(Gn),w.d(Gn,{SignInProviderService:function(){return ds},generateGuid:function(){return Co},isInIframe:function(){return fu},isNullOrUndefinedOrWhiteSpaceString:function(){return L},isSignedIn:function(){return gu},parseClaimChallenge:function(){return Za},parseClaimsFromToken:function(){return yo},retrieveSignedInAccount:function(){return hs},signIn:function(){return uu},signOut:function(){return hu}});var v=w(390),C={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},Ze=[C.OPENID_SCOPE,C.PROFILE_SCOPE,C.OFFLINE_ACCESS_SCOPE],Eo=[...Ze,C.EMAIL_SCOPE],X_ID_TOKEN="idtoken",X_CLIENT_INFO="client.info",X_ERROR="error",X_ERROR_DESC="error.description",Z={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},_o={PLAIN:"plain",S256:"S256"},Tt={QUERY:"query",FRAGMENT:"fragment"},fs={...Tt,FORM_POST:"form_post"},re={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},P={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},$n="appmetadata",ee={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},F={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},Et="unexpected_error",zn="post_request_failed",hr={[Et]:"Unexpected error in authentication.",[zn]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class q extends Error{constructor(e,t,r){super(t?`${e}: ${t}`:e),Object.setPrototypeOf(this,q.prototype),this.errorCode=e||C.EMPTY_STRING,this.errorMessage=t||C.EMPTY_STRING,this.subError=r||C.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function ko(n,e){return new q(n,e?`${hr[n]} ${e}`:hr[n])}var gr="redirect_uri_empty",Wn="claims_request_parsing_error",fr="authority_uri_insecure",qe="url_parse_error",mr="empty_url_error",pr="empty_input_scopes_error",vr="invalid_prompt_value",_t="invalid_claims",Cr="token_request_empty",yr="logout_request_empty",Ar="invalid_code_challenge_method",wt="pkce_params_missing",Rt="invalid_cloud_discovery_metadata",Tr="invalid_authority_metadata",bt="untrusted_authority",tt="missing_ssh_jwk",Ir="missing_ssh_kid",Qn="missing_nonce_authentication_header",Vn="invalid_authentication_header",Sr="cannot_set_OIDCOptions",Er="cannot_allow_native_broker",_r="authority_mismatch",V={[gr]:"A redirect URI is required for all calls, and none has been set.",[Wn]:"Could not parse the given claims request object.",[fr]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[qe]:"URL could not be parsed into appropriate segments.",[mr]:"URL was empty or null.",[pr]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[vr]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[_t]:"Given claims parameter must be a stringified JSON object.",[Cr]:"Token request was empty and not found in cache.",[yr]:"The logout request was null or undefined.",[Ar]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[wt]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[Rt]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[Tr]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[bt]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[tt]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[Ir]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[Qn]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[Vn]:"Invalid authentication header provided",[Sr]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[Er]:"Cannot set allowNativeBroker parameter to true when not in AAD protocol mode.",[_r]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class Yn extends q{constructor(e){super(e,V[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,Yn.prototype)}}function $(n){return new Yn(n)}class ge{static isEmptyObj(e){if(e)try{var t=JSON.parse(e);return 0===Object.keys(t).length}catch{}return!0}static startsWith(e,t){return 0===e.indexOf(t)}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){var t={},r=e.split("&"),i=o=>decodeURIComponent(o.replace(/\+/g," "));return r.forEach(o=>{if(o.trim()){var[a,s]=o.split(/=(.+)/g,2);a&&s&&(t[i(a)]=i(s))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}var kt="client_info_decoding_error",wr="client_info_empty_error",Pt="token_parsing_error",Rr="null_or_empty_token",fe="endpoints_resolution_error",br="network_error",Ot="openid_config_error",kr="hash_not_deserialized",He="invalid_state",Pr="state_mismatch",rt="state_not_found",Or="nonce_mismatch",Nt="auth_time_not_found",Nr="max_age_transpired",jn="multiple_matching_tokens",Jn="multiple_matching_accounts",Mr="multiple_matching_appMetadata",Ur="request_cannot_be_made",Dr="cannot_remove_empty_scope",Lr="cannot_append_scopeset",Mt="empty_input_scopeset",Xn="device_code_polling_cancelled",Zn="device_code_expired",ei="device_code_unknown_error",Ut="no_account_in_silent_request",Hr="invalid_cache_record",Dt="invalid_cache_environment",Lt="no_account_found",Ht="no_crypto_object",xt="unexpected_credential_type",ti="invalid_assertion",ri="invalid_client_credential",me="token_refresh_required",ni="user_timeout_reached",xr="token_claims_cnf_required_for_signedjwt",Kr="authorization_code_missing_from_server_response",Br="binding_key_not_removed",Fr="end_session_endpoint_not_supported",Kt="key_id_missing",ii="no_network_connectivity",oi="user_canceled",ai="missing_tenant_id_error",D="method_not_implemented",si="nested_app_auth_bridge_disabled",U={[kt]:"The client info could not be parsed/decoded correctly",[wr]:"The client info was empty",[Pt]:"Token cannot be parsed",[Rr]:"The token is null or empty",[fe]:"Endpoints cannot be resolved",[br]:"Network request failed",[Ot]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[kr]:"The hash parameters could not be deserialized",[He]:"State was not the expected format",[Pr]:"State mismatch error",[rt]:"State not found",[Or]:"Nonce mismatch error",[Nt]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[Nr]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[jn]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[Jn]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[Mr]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[Ur]:"Token request cannot be made without authorization code or refresh token.",[Dr]:"Cannot remove null or empty scope from ScopeSet",[Lr]:"Cannot append ScopeSet",[Mt]:"Empty input ScopeSet cannot be processed",[Xn]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[Zn]:"Device code is expired.",[ei]:"Device code stopped polling for unknown reasons.",[Ut]:"Please pass an account object, silent flow is not supported without account information",[Hr]:"Cache record object was null or undefined.",[Dt]:"Invalid environment when attempting to create cache entry",[Lt]:"No account found in cache for given key.",[Ht]:"No crypto object detected.",[xt]:"Unexpected credential type.",[ti]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[ri]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[me]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[ni]:"User defined timeout for device code polling reached",[xr]:"Cannot generate a POP jwt if the token_claims are not populated",[Kr]:"Server response does not contain an authorization code to proceed",[Br]:"Could not remove the credential's binding key from storage.",[Fr]:"The provided authority does not support logout",[Kt]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[ii]:"No network connectivity. Check your internet connection.",[oi]:"User cancelled the flow.",[ai]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[D]:"This method has not been implemented",[si]:"The nested app auth bridge is disabled"};class Gr extends q{constructor(e,t){super(e,t?`${U[e]}: ${t}`:U[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,Gr.prototype)}}function T(n,e){return new Gr(n,e)}function Po(n){return n.startsWith("#/")?n.substring(2):n.startsWith("#")||n.startsWith("?")?n.substring(1):n}function $r(n){if(!n||n.indexOf("=")<0)return null;try{var e=Po(n),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.error||t.error_description||t.state)return t}catch{throw T(kr)}return null}class x{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw $(mr);e.includes("#")||(this._urlString=x.canonicalizeUri(e))}static canonicalizeUri(e){if(e){var t=e.toLowerCase();return ge.endsWith(t,"?")?t=t.slice(0,-1):ge.endsWith(t,"?/")&&(t=t.slice(0,-2)),ge.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){var e;try{e=this.getUrlComponents()}catch{throw $(qe)}if(!e.HostNameAndPort||!e.PathSegments)throw $(qe);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw $(fr)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return x.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){var t=this.getUrlComponents(),r=t.PathSegments;return e&&0!==r.length&&("common"===r[0]||"organizations"===r[0])&&(r[0]=e),x.constructAuthorityUriFromObject(t)}getUrlComponents(){var e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw $(qe);var r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]},i=r.AbsolutePath.split("/");return i=i.filter(o=>o&&o.length>0),r.PathSegments=i,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){var t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw $(qe);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===C.FORWARD_SLASH){var i=new x(t).getUrlComponents();return i.Protocol+"//"+i.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new x(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!$r(e)}}var Bt="pkce_not_created",Ft="crypto_nonexistent",nt="empty_navigate_uri",qr="hash_empty_error",Gt="no_state_in_hash",zr="hash_does_not_contain_known_properties",Wr="unable_to_parse_state",Qr="state_interaction_type_mismatch",$t="interaction_in_progress",Vr="popup_window_error",Yr="empty_window_error",ye="user_cancelled",ci="monitor_popup_timeout",qt="monitor_window_timeout",zt="redirect_in_iframe",jr="block_iframe_reload",Wt="block_nested_popups",li="iframe_closed_prematurely",it="silent_logout_unsupported",Jr="no_account_error",di="silent_prompt_value_error",Xr="no_token_request_cache_error",Zr="unable_to_parse_token_request_cache_error",Qt="no_cached_authority_error",ui="auth_request_not_set_error",hi="invalid_cache_type",ot="non_browser_environment",xe="database_not_open",at="no_network_connectivity",Vt="post_request_failed",en="get_request_failed",Yt="failed_to_parse_response",tn="unable_to_load_token",jt="crypto_key_not_found",rn="auth_code_required",nn="auth_code_or_nativeAccountId_required",on="spa_code_and_nativeAccountId_present",Jt="database_unavailable",an="unable_to_acquire_token_from_native_platform",sn="native_handshake_timeout",cn="native_extension_not_installed",ze="native_connection_not_established",ln="uninitialized_public_client_application",dn="native_prompt_not_supported",un="invalid_base64_string",hn="invalid_pop_token_request",Oo="failed_to_build_headers",No="failed_to_parse_headers",be="For more visit: aka.ms/msaljs/browser-errors",N={[Bt]:"The PKCE code challenge and verifier could not be generated.",[Ft]:"The crypto object or function is not available.",[nt]:"Navigation URI is empty. Please check stack trace for more info.",[qr]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${be}`,[Gt]:"Hash does not contain state. Please verify that the request originated from msal.",[zr]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${be}`,[Wr]:"Unable to parse state. Please verify that the request originated from msal.",[Qr]:"Hash contains state but the interaction type does not match the caller.",[$t]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${be}`,[Vr]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[Yr]:"window.open returned null or undefined window object.",[ye]:"User cancelled the flow.",[ci]:`Token acquisition in popup failed due to timeout.  ${be}`,[qt]:`Token acquisition in iframe failed due to timeout.  ${be}`,[zt]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[jr]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${be}`,[Wt]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[li]:"The iframe being monitored was closed prematurely.",[it]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[Jr]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[di]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[Xr]:"No token request found in cache.",[Zr]:"The cached token request could not be parsed.",[Qt]:"No cached authority found.",[ui]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[hi]:"Invalid cache type",[ot]:"Login and token requests are not supported in non-browser environments.",[xe]:"Database is not open!",[at]:"No network connectivity. Check your internet connection.",[Vt]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[en]:"Network request failed. Please check the network trace to determine root cause.",[Yt]:"Failed to parse network response. Check network trace.",[tn]:"Error loading token to cache.",[jt]:"Cryptographic Key or Keypair not found in browser storage.",[rn]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[nn]:"An authorization code or nativeAccountId must be provided to this flow.",[on]:"Request cannot contain both spa code and native account id.",[Jt]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[an]:`Unable to acquire token from native platform.  ${be}`,[sn]:"Timed out while attempting to establish connection to browser extension",[cn]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[ze]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${be}`,[ln]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${be}`,[dn]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[un]:"Invalid base64 encoded string.",[hn]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[Oo]:"Failed to build request headers object.",[No]:"Failed to parse response headers"};class Xt extends q{constructor(e,t){super(e,N[e],t),Object.setPrototypeOf(this,Xt.prototype),this.name="BrowserAuthError"}}function R(n,e){return new Xt(n,e)}var b,ce={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},st_CHANNEL_ID="53ee284d-920a-4b59-9d30-a60315b26836",oe={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"};!function(n){n.Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none"}(b||(b={}));var Uo={scopes:Ze},Do="jwk",gi="msal.db",ys=`${gi}.keys`,As=[0,5,4],g={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues"};function fn(n){return encodeURIComponent(fi(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function mn(n){return Lo(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function fi(n){return Lo((new TextEncoder).encode(n))}function Lo(n){var e=Array.from(n,t=>String.fromCodePoint(t)).join("");return btoa(e)}var Ho="SHA-256",ws=new Uint8Array([1,0,1]),xo="0123456789abcdef",Ko=new Uint32Array(1),mi={name:"RSASSA-PKCS1-v1_5",hash:Ho,modulusLength:2048,publicExponent:ws};function Bo(n,e,t){return pi.apply(this,arguments)}function pi(){return pi=(0,v.A)(function*(n,e,t){e?.addQueueMeasurement(g.Sha256Digest,t);var i=(new TextEncoder).encode(n);return window.crypto.subtle.digest(Ho,i)}),pi.apply(this,arguments)}function ks(n){return window.crypto.getRandomValues(n)}function vi(){return window.crypto.getRandomValues(Ko),Ko[0]}function ke(){var n=Date.now(),e=1024*vi()+(1023&vi()),t=new Uint8Array(16),r=Math.trunc(e/2**30),i=e&2**30-1,o=vi();t[0]=n/2**40,t[1]=n/2**32,t[2]=n/2**24,t[3]=n/65536,t[4]=n/256,t[5]=n,t[6]=112|r>>>8,t[7]=r,t[8]=128|i>>>24,t[9]=i>>>16,t[10]=i>>>8,t[11]=i,t[12]=o>>>24,t[13]=o>>>16,t[14]=o>>>8,t[15]=o;for(var a="",s=0;s<t.length;s++)a+=xo.charAt(t[s]>>>4),a+=xo.charAt(15&t[s]),(3===s||5===s||7===s||9===s)&&(a+="-");return a}function Ci(){return Ci=(0,v.A)(function*(n,e){return window.crypto.subtle.generateKey(mi,n,e)}),Ci.apply(this,arguments)}function yi(n){return Ai.apply(this,arguments)}function Ai(){return Ai=(0,v.A)(function*(n){return window.crypto.subtle.exportKey(Do,n)}),Ai.apply(this,arguments)}function Ti(){return Ti=(0,v.A)(function*(n,e,t){return window.crypto.subtle.importKey(Do,n,mi,e,t)}),Ti.apply(this,arguments)}function Ii(){return Ii=(0,v.A)(function*(n,e){return window.crypto.subtle.sign(mi,n,e)}),Ii.apply(this,arguments)}function Fo(n){return Si.apply(this,arguments)}function Si(){return Si=(0,v.A)(function*(n){var e=yield Bo(n);return mn(new Uint8Array(e))}),Si.apply(this,arguments)}var ct="storage_not_supported",Ei="stubbed_public_client_application_called",Zt="in_mem_redirect_unavailable",pn={[ct]:"Given storage configuration option was not supported.",[Ei]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[Zt]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class _i extends q{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,_i.prototype)}}function wi(n){return new _i(n,pn[n])}function vn(){return window.parent!==window}function Pe(){return window.location.href.split("?")[0].split("#")[0]}function Go(){if(typeof window>"u")throw R(ot)}function $o(n){if(!n)throw R(ln)}function Ri(n){Go(),function(){if(x.hashContainsKnownProperties(window.location.hash)&&vn())throw R(jr)}(),function(){if(typeof window<"u"&&window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf(`${ce.POPUP_NAME_PREFIX}.`))throw R(Wt)}(),$o(n)}function qo(n,e){if(Ri(n),function(n){if(vn()&&!n)throw R(zt)}(e.system.allowRedirectInIframe),e.cache.cacheLocation===oe.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw wi(Zt)}function zo(n){var e=document.createElement("link");e.rel="preconnect",e.href=new URL(n).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}var Fs=w(726),Gs=w(112),$s=w(492),qs=w(161),zs=w(761),Ws=w(163);class Qs extends Fs.B7{constructor(e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,r){super(),this.scheduler=r,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=e<1?1:e,this._windowTime=t<1?1:t,t===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(e){if(!this.isStopped){var t=this._events;t.push(e),t.length>this._bufferSize&&t.shift()}super.next(e)}nextTimeWindow(e){this.isStopped||(this._events.push(new Vs(this._getNow(),e)),this._trimBufferThenGetEvents()),super.next(e)}_subscribe(e){var a,t=this._infiniteTimeWindow,r=t?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;if(this.closed)throw new zs.P;if(this.isStopped||this.hasError?a=$s.y.EMPTY:(this.observers.push(e),a=new Ws.Y(this,e)),i&&e.add(e=new qs.YZ(e,i)),t)for(var s=0;s<o&&!e.closed;s++)e.next(r[s]);else for(var c=0;c<o&&!e.closed;c++)e.next(r[c].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),a}_getNow(){return(this.scheduler||Gs.g).now()}_trimBufferThenGetEvents(){for(var e=this._getNow(),t=this._bufferSize,r=this._windowTime,i=this._events,o=i.length,a=0;a<o&&!(e-i[a].time<r);)a++;return o>t&&(a=Math.max(a,o-t)),a>0&&i.splice(0,a),i}}class Vs{constructor(e,t){this.time=e,this.value=t}}var Ys=w(548),Xs=new(w(442).q)(Ys.R),ec=w(874),Wo=w(199);class rc{constructor(e,t){this.delay=e,this.scheduler=t}call(e,t){return t.subscribe(new bi(e,this.delay,this.scheduler))}}class bi extends ec.v{constructor(e,t,r){super(e),this.delay=t,this.scheduler=r,this.queue=[],this.active=!1,this.errored=!1}static dispatch(e){for(var t=e.source,r=t.queue,i=e.scheduler,o=e.destination;r.length>0&&r[0].time-i.now()<=0;)r.shift().notification.observe(o);if(r.length>0){var a=Math.max(0,r[0].time-i.now());this.schedule(e,a)}else this.unsubscribe(),t.active=!1}_schedule(e){this.active=!0,this.destination.add(e.schedule(bi.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))}scheduleNotification(e){if(!0!==this.errored){var t=this.scheduler,r=new nc(t.now()+this.delay,e);this.queue.push(r),!1===this.active&&this._schedule(t)}}_next(e){this.scheduleNotification(Wo.E.createNext(e))}_error(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()}_complete(){this.scheduleNotification(Wo.E.createComplete()),this.unsubscribe()}}class nc{constructor(e,t){this.time=e,this.notification=t}}var Be=window,er=function(n){return n.UserInteractionRequired="User interaction is required.",n.UserNotSignedIn="User is not signed in.",n.UserInteractionDeclined="User interaction is declined.",n.UserAccountChanged="User account has changed.",n.FallbackToRedirection="Failed to get token silently, using redirection as fallback.",n.NoNetworkMessage="No network connectivity. Check your internet connection.",n.FalsyAccessToken="Access token is empty or undefined.",n}({}),ic=["browser_storage_unsupported","cluster_resolution_failure_401"],oc=["storage_quota_exceeded","host_window_unsupported"],ki="FabricSignedInFlag",Qo="[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}",ac=[/^msal\./,/^server-telemetry-/,new RegExp(`^${Qo}.${Qo}-`,"i")],Ae=function(n){return n[n.Low=-1]="Low",n[n.Medium=0]="Medium",n[n.High=1]="High",n}({}),Vo=[...ac.map(n=>({pattern:n,priority:Ae.High})),{pattern:ki,priority:Ae.High},{pattern:"multitaskingTabs",priority:Ae.Medium},{pattern:"AI_sentBuffer",priority:Ae.Low},{pattern:"AI_buffer",priority:Ae.Low}],Yo=[],Pi=new Map,sc={localStorage:Yo,sessionStorage:Vo};(()=>{var n=function(){var r={keyNameToPriorityMap:new Map,keyPatternToPriorityArray:new Array,lowPriorityKeyNames:[],lowPriorityKeyPatterns:[]};t.forEach(i=>{"string"==typeof i.pattern?(r.keyNameToPriorityMap.set(i.pattern,i.priority),i.priority===Ae.Low&&r.lowPriorityKeyNames.push(i.pattern)):(r.keyPatternToPriorityArray.push({pattern:i.pattern,priority:i.priority}),i.priority===Ae.Low&&r.lowPriorityKeyPatterns.push(i.pattern))}),Pi.set(e,r)};for(var[e,t]of Object.entries(sc))n()})();var jo=(n,e)=>{var t=e===localStorage?"localStorage":"sessionStorage",r=Pi.get(t);return r?r.keyNameToPriorityMap.get(n)??r.keyPatternToPriorityArray.find(i=>i.pattern.test(n))?.priority??Ae.Medium:Ae.Medium};class Cn{constructor(){this.storageEventSubject=new Qs(20),this.storageEvent$=this.storageEventSubject.pipe(function(n,e=Xs){var t=function(n){return n instanceof Date&&!isNaN(+n)}(n),r=t?+n-e.now():Math.abs(n);return i=>i.lift(new rc(r,e))}(0))}static init(){if(Be.webStorageManagementEnabled&&!Be.webStorageManager){var e=Be.webStorageManager=new Cn;if(Vo.length>0)try{e.applyMgmtToStorage(sessionStorage)}catch(t){e.storageEventSubject.next({type:"overrideFail",storage:"sessionStorage",err:t})}if(Yo.length>0)try{e.applyMgmtToStorage(localStorage)}catch(t){e.storageEventSubject.next({type:"overrideFail",storage:"localStorage",err:t})}}}static getInstance(){return Be.webStorageManager||Cn.init(),Be.webStorageManager}applyMgmtToStorage(e){var t=e.setItem,r=[];e.setItem=(i,o)=>{try{t.call(e,i,o),this.storageEventSubject.next({type:"setItemSuccess",storage:e,key:i,removedItems:[...r]}),r.length=0}catch(s){if((n=>"QuotaExceededError"===n?.name)(s)&&r.length<5&&(r.length>0||jo(i,e)>0)){var a=(n=>{var e=n===localStorage?"localStorage":"sessionStorage",t=Pi.get(e);if(!t)return null;for(var r of t.lowPriorityKeyNames)if(n.hasOwnProperty(r))return r;var i=Object.keys(n);for(var o of t.lowPriorityKeyPatterns)for(var a of i)if(o.test(a))return a;var s=i.filter(u=>jo(u,n)===Ae.Medium);if(s.length>0){var c=0,l="";for(var d of s.slice(0,20)){var h=d.length+(n.getItem(d)?.length||0);h>c&&(c=h,l=d)}return l}return null})(e);if(a)return e.removeItem(a),r.push(a),void e.setItem(i,o)}throw this.storageEventSubject.next({type:"setItemFail",storage:e,key:i,removedItems:[...r],err:s}),r.length=0,s}}}}var G,Jo=w(235),Xo=function(n){return n.Informational="Informational",n.Warning="Warning",n.Error="Error",n.Critical="Critical",n}({}),Qe=function(n){return n.Started="Started",n.Succeeded="Succeeded",n.Failed="Failed",n.Cancelled="Cancelled",n.Pending="Pending",n.SucceededWithErrors="SucceededWithErrors",n.FailedWithRemote="FailedWithRemote",n.Interrupted="Interrupted",n}({});class Zo{constructor(e,t,r){if(this.onComplete=r,this.status=Qe.Pending,this.telemetryEvent=e,void 0===this.onComplete)throw this.onComplete=()=>{},new Error("TimedTelemetryEvent: complete method is required");t>=0&&(this._timeout=setTimeout(()=>{this.reject({errorCode:"TimedEventTimedOut",level:Xo.Warning})},t))}resolve(e=Qe.Succeeded){this.status===Qe.Pending&&(clearTimeout(this._timeout),this.status=e,this.onComplete?.(this.status))}reject(e){this.status===Qe.Pending&&(clearTimeout(this._timeout),this.status=Qe.Failed,this.onComplete?.(this.status,e))}cancel(e){this.status===Qe.Pending&&(clearTimeout(this._timeout),this.status=Qe.Cancelled,e?this.onComplete?.(this.status):this.onComplete?.(this.status,{errorCode:"TimedEventCancelled",level:Xo.Informational}))}}new class{markEvent(e){return performance.mark(`${e}-start`).startTime+performance.timeOrigin}measureDuration(e){var t=performance.mark(`${e}-end`);if(0===performance.getEntriesByName(`${e}-start`,"mark").length)return{startTime:(new Date).toISOString(),endTime:(new Date).toISOString(),duration:0};try{var i=performance.measure(e,`${e}-start`,`${e}-end`),o=new Date(i.startTime+performance.timeOrigin).toISOString(),a=new Date(t.startTime+performance.timeOrigin).toISOString(),s=i.duration;return performance.clearMarks(`${e}-start`),performance.clearMarks(`${e}-end`),performance.clearMeasures(e),{startTime:o,endTime:a,duration:s}}catch{return{startTime:(new Date).toISOString(),endTime:(new Date).toISOString(),duration:0}}}assembleInfoToFeatureEvent(e,t,r){var{startTime:i,endTime:o,duration:a}=t;if(e.operationStartTime=i,e.operationEndTime=o,e.durationMs=a,r){var{errorCode:s,level:c,statusCode:l=0}=r;e.activityAttributes?(e.activityAttributes.errorCode=s,e.activityAttributes.level=c,e.activityAttributes.statusCode=l):e.activityAttributes={errorCode:s,level:c,statusCode:l}}}assembleInfoToDiagnosticTrace(e,t,r){var{startTime:i,endTime:o,duration:a}=t;e.properties={...e.properties,operationStartTime:i,operationEndTime:o,durationMs:a},r&&(e.properties={...e.properties,...r})}buildTimedEventByFeatureEvent(e,t,r){(e={...e}).activityAttributes&&(e.activityAttributes={...e.activityAttributes});var i=(0,Jo.A)();return this.markEvent(i),new Zo(e,r||3e4,(o,a)=>{e.activityStatus=o;var s=this.measureDuration(i);this.assembleInfoToFeatureEvent(e,s,a),t(e)})}buildTimedEventByDiagnosticTrace(e,t,r){(e={...e}).properties&&(e.properties={...e.properties});var{properties:i}=e,o=i?.eventId||(0,Jo.A)();return this.markEvent(o),new Zo(e,r||3e4,(a,s)=>{e.properties.status=a;var c=this.measureDuration(o);this.assembleInfoToDiagnosticTrace(e,c,s),t(e)})}},function(n){n[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace"}(G||(G={}));class Fe{constructor(e,t,r){this.level=G.Info;var o=e||Fe.createDefaultLoggerOptions();this.localCallback=o.loggerCallback||(()=>{}),this.piiLoggingEnabled=o.piiLoggingEnabled||!1,this.level="number"==typeof o.logLevel?o.logLevel:G.Info,this.correlationId=o.correlationId||C.EMPTY_STRING,this.packageName=t||C.EMPTY_STRING,this.packageVersion=r||C.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:G.Info}}clone(e,t,r){return new Fe({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(!(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)){var r=(new Date).toUTCString();this.executeCallback(t.logLevel,`[${r}] : [${t.correlationId||this.correlationId||""}] : ${this.packageName}@${this.packageVersion} : ${G[t.logLevel]} - ${e}`,t.containsPii||!1)}}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:G.Error,containsPii:!1,correlationId:t||C.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:G.Error,containsPii:!0,correlationId:t||C.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:G.Warning,containsPii:!1,correlationId:t||C.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:G.Warning,containsPii:!0,correlationId:t||C.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:G.Info,containsPii:!1,correlationId:t||C.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:G.Info,containsPii:!0,correlationId:t||C.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:G.Verbose,containsPii:!1,correlationId:t||C.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:G.Verbose,containsPii:!0,correlationId:t||C.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:G.Trace,containsPii:!1,correlationId:t||C.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:G.Trace,containsPii:!0,correlationId:t||C.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}var yn={createNewGuid:()=>{throw T(D)},base64Decode:()=>{throw T(D)},base64Encode:()=>{throw T(D)},base64UrlEncode:()=>{throw T(D)},encodeKid:()=>{throw T(D)},getPublicKeyThumbprint:()=>(0,v.A)(function*(){throw T(D)})(),removeTokenBindingKey:()=>(0,v.A)(function*(){throw T(D)})(),clearKeystore:()=>(0,v.A)(function*(){throw T(D)})(),signJwt:()=>(0,v.A)(function*(){throw T(D)})(),hashString:()=>(0,v.A)(function*(){throw T(D)})()},ta="@azure/msal-common",Ni="14.16.0";function Ve(n,e){var t=function(n){if(!n)throw T(Rr);var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(n);if(!t||t.length<4)throw T(Pt);return t[2]}(n);try{var r=e(t);return JSON.parse(r)}catch{throw T(Pt)}}function ra(n,e){if(0===e||Date.now()-3e5>n+e)throw T(Nr)}function Te(){return Math.round((new Date).getTime()/1e3)}function Mi(n,e){var t=Number(n)||0;return Te()+e>t}function lt(n){return[fc(n),mc(n),pc(n),vc(n),Cc(n)].join(re.CACHE_KEY_SEPARATOR).toLowerCase()}function An(n,e,t,r,i){return{credentialType:P.ID_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t,realm:i}}function Tn(n,e,t,r,i,o,a,s,c,l,d,h,u,f,p){var m={homeAccountId:n,credentialType:P.ACCESS_TOKEN,secret:t,cachedAt:Te().toString(),expiresOn:a.toString(),extendedExpiresOn:s.toString(),environment:e,clientId:r,realm:i,target:o,tokenType:d||F.BEARER};if(h&&(m.userAssertionHash=h),l&&(m.refreshOn=l.toString()),f&&(m.requestedClaims=f,m.requestedClaimsHash=p),m.tokenType?.toLowerCase()!==F.BEARER.toLowerCase())switch(m.credentialType=P.ACCESS_TOKEN_WITH_AUTH_SCHEME,m.tokenType){case F.POP:var A=Ve(t,c);if(!A?.cnf?.kid)throw T(xr);m.keyId=A.cnf.kid;break;case F.SSH:m.keyId=u}return m}function na(n,e,t,r,i,o,a){var s={credentialType:P.REFRESH_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t};return o&&(s.userAssertionHash=o),i&&(s.familyId=i),a&&(s.expiresOn=a.toString()),s}function Ui(n){return n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("credentialType")&&n.hasOwnProperty("clientId")&&n.hasOwnProperty("secret")}function ia(n){return!!n&&Ui(n)&&n.hasOwnProperty("realm")&&n.hasOwnProperty("target")&&(n.credentialType===P.ACCESS_TOKEN||n.credentialType===P.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function oa(n){return!!n&&Ui(n)&&n.hasOwnProperty("realm")&&n.credentialType===P.ID_TOKEN}function aa(n){return!!n&&Ui(n)&&n.credentialType===P.REFRESH_TOKEN}function fc(n){return[n.homeAccountId,n.environment].join(re.CACHE_KEY_SEPARATOR).toLowerCase()}function mc(n){return[n.credentialType,n.credentialType===P.REFRESH_TOKEN&&n.familyId||n.clientId,n.realm||""].join(re.CACHE_KEY_SEPARATOR).toLowerCase()}function pc(n){return(n.target||"").toLowerCase()}function vc(n){return(n.requestedClaimsHash||"").toLowerCase()}function Cc(n){return n.tokenType&&n.tokenType.toLowerCase()!==F.BEARER.toLowerCase()?n.tokenType.toLowerCase():""}function sa(){return Te()+86400}function In(n,e,t){n.authorization_endpoint=e.authorization_endpoint,n.token_endpoint=e.token_endpoint,n.end_session_endpoint=e.end_session_endpoint,n.issuer=e.issuer,n.endpointsFromNetwork=t,n.jwks_uri=e.jwks_uri}function Di(n,e,t){n.aliases=e.aliases,n.preferred_cache=e.preferred_cache,n.preferred_network=e.preferred_network,n.aliasesFromNetwork=t}function ca(n){return n.expiresAt<=Te()}class j{constructor(e){var t=e?ge.trimArrayEntries([...e]):[],r=t?ge.removeEmptyStringsFromArray(t):[];this.validateInputScopes(r),this.scopes=new Set,r.forEach(i=>this.scopes.add(i))}static fromString(e){var r=(e||C.EMPTY_STRING).split(" ");return new j(r)}static createSearchScopes(e){var t=new j(e);return t.containsOnlyOIDCScopes()?t.removeScope(C.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}validateInputScopes(e){if(!e||e.length<1)throw $(pr)}containsScope(e){var t=this.printScopesLowerCase().split(" "),r=new j(t);return!!e&&r.scopes.has(e.toLowerCase())}containsScopeSet(e){return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){var e=0;return Eo.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw T(Lr)}}removeScope(e){if(!e)throw T(Dr);this.scopes.delete(e.trim())}removeOIDCScopes(){Eo.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw T(Mt);var t=new Set;return e.scopes.forEach(r=>t.add(r.toLowerCase())),this.scopes.forEach(r=>t.add(r.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw T(Mt);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();var t=this.unionScopeSets(e),r=e.getScopeCount(),i=this.getScopeCount();return t.size<i+r}getScopeCount(){return this.scopes.size}asArray(){var e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):C.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}function Sn(n,e){if(!n)throw T(wr);try{var t=e(n);return JSON.parse(t)}catch{throw T(kt)}}function dt(n){if(!n)throw T(kt);var e=n.split(re.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?C.EMPTY_STRING:e[1]}}function En(n,e){return!!n&&!!e&&n===e.split(".")[1]}function Li(n,e,t,r){if(r){var{oid:i,sub:o,tid:a,name:s,tfp:c,acr:l}=r,d=a||c||l||"";return{tenantId:d,localAccountId:i||o||"",name:s,isHomeTenant:En(d,n)}}return{tenantId:t,localAccountId:e,isHomeTenant:En(t,n)}}function Hi(n,e,t,r){var i=n;if(e){var{isHomeTenant:o,...a}=e;i={...n,...a}}if(t){var{isHomeTenant:s,...c}=Li(n.homeAccountId,n.localAccountId,n.tenantId,t);return{...i,...c,idTokenClaims:t,idToken:r}}return i}function la(n){return n&&(n.tid||n.tfp||n.acr)||null}class J{generateAccountId(){return[this.homeAccountId,this.environment].join(re.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return J.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){var t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(re.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,r){var o,i=new J;i.authorityType=1===t.authorityType?"ADFS":"AAD"===t.protocolMode?"MSSTS":"Generic",e.clientInfo&&r&&(o=Sn(e.clientInfo,r)),i.clientInfo=e.clientInfo,i.homeAccountId=e.homeAccountId,i.nativeAccountId=e.nativeAccountId;var a=e.environment||t&&t.getPreferredCache();if(!a)throw T(Dt);if(i.environment=a,i.realm=o?.utid||la(e.idTokenClaims)||"",i.localAccountId=o?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"",i.username=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn||(e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null)||"",i.name=e.idTokenClaims?.name||"",i.cloudGraphHostName=e.cloudGraphHostName,i.msGraphHost=e.msGraphHost,e.tenantProfiles)i.tenantProfiles=e.tenantProfiles;else{var l=Li(e.homeAccountId,i.localAccountId,i.realm,e.idTokenClaims);i.tenantProfiles=[l]}return i}static createFromAccountInfo(e,t,r){var i=new J;return i.authorityType=e.authorityType||"Generic",i.homeAccountId=e.homeAccountId,i.localAccountId=e.localAccountId,i.nativeAccountId=e.nativeAccountId,i.realm=e.tenantId,i.environment=e.environment,i.username=e.username,i.name=e.name,i.cloudGraphHostName=t,i.msGraphHost=r,i.tenantProfiles=Array.from(e.tenantProfiles?.values()||[]),i}static generateHomeAccountId(e,t,r,i,o){if(1!==t&&2!==t){if(e)try{var a=Sn(e,i.base64Decode);if(a.uid&&a.utid)return`${a.uid}.${a.utid}`}catch{}r.warning("No client info in response")}return o?.sub||""}static isAccountEntity(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;var i=!0;if(r){var o=e.idTokenClaims||{},a=t.idTokenClaims||{};i=o.iat===a.iat&&o.nonce===a.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&i}}var ua={"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},xi={tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},ha=new Set;function ga(n,e,t,r){if(r?.trace(`getAliasesFromMetadata called with source: ${t}`),n&&e){var i=_n(e,n);if(i)return r?.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),i.aliases;r?.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function _n(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.aliases.includes(e))return r}return null}xi.metadata.forEach(n=>{n.aliases.forEach(e=>{ha.add(e)})});var fa="cache_quota_exceeded",Ki="cache_error_unknown",Bi={[fa]:"Exceeded cache storage capacity.",[Ki]:"Unexpected error occurred when using cache storage."};class ut extends Error{constructor(e,t){var r=t||(Bi[e]?Bi[e]:Bi[Ki]);super(`${e}: ${r}`),Object.setPrototypeOf(this,ut.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}}class ht{constructor(e,t,r,i){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(ta,Ni),this.staticAuthorityOptions=i}getAllAccounts(e){return this.buildTenantProfiles(this.getAccountsFilteredBy(e||{}),e)}getAccountInfoFilteredBy(e){var t=this.getAllAccounts(e);return t.length>1?t.sort(i=>i.idTokenClaims?-1:1)[0]:1===t.length?t[0]:null}getBaseAccountInfo(e){var t=this.getAccountsFilteredBy(e);return t.length>0?t[0].getAccountInfo():null}buildTenantProfiles(e,t){return e.flatMap(r=>this.getTenantProfilesFromAccountEntity(r,t?.tenantId,t))}getTenantedAccountInfoByFilter(e,t,r,i){var a;if(i&&!this.tenantProfileMatchesFilter(r,i))return null;var s=this.getIdToken(e,t,r.tenantId);return s&&(a=Ve(s.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(a,i))?null:Hi(e,r,a,s?.secret)}getTenantProfilesFromAccountEntity(e,t,r){var i=e.getAccountInfo(),o=i.tenantProfiles||new Map,a=this.getTokenKeys();if(t){var s=o.get(t);if(!s)return[];o=new Map([[t,s]])}var c=[];return o.forEach(l=>{var d=this.getTenantedAccountInfoByFilter(i,a,l,r);d&&c.push(d)}),c}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||void 0!==t.isHomeTenant&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}saveCacheRecord(e,t,r){var i=this;return(0,v.A)(function*(){if(!e)throw T(Hr);try{e.account&&i.setAccount(e.account),e.idToken&&!1!==t?.idToken&&i.setIdTokenCredential(e.idToken),e.accessToken&&!1!==t?.accessToken&&(yield i.saveAccessToken(e.accessToken)),e.refreshToken&&!1!==t?.refreshToken&&i.setRefreshTokenCredential(e.refreshToken),e.appMetadata&&i.setAppMetadata(e.appMetadata)}catch(o){throw i.commonLogger?.error("CacheManager.saveCacheRecord: failed"),o instanceof Error?(i.commonLogger?.errorPii(`CacheManager.saveCacheRecord: ${o.message}`,r),"QuotaExceededError"===o.name||"NS_ERROR_DOM_QUOTA_REACHED"===o.name||o.message.includes("exceeded the quota")?(i.commonLogger?.error("CacheManager.saveCacheRecord: exceeded storage quota",r),new ut(fa)):new ut(o.name,o.message)):(i.commonLogger?.errorPii(`CacheManager.saveCacheRecord: ${o}`,r),new ut(Ki))}})()}saveAccessToken(e){var t=this;return(0,v.A)(function*(){var r={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},i=t.getTokenKeys(),o=j.fromString(e.target),a=[];i.accessToken.forEach(s=>{if(t.accessTokenKeyMatchesFilter(s,r,!1)){var c=t.getAccessTokenCredential(s);c&&t.credentialMatchesFilter(c,r)&&j.fromString(c.target).intersectingScopeSets(o)&&a.push(t.removeAccessToken(s))}}),yield Promise.all(a),t.setAccessTokenCredential(e)})()}getAccountsFilteredBy(e){var t=this.getAccountKeys(),r=[];return t.forEach(i=>{if(this.isAccountKey(i,e.homeAccountId)){var o=this.getAccount(i,this.commonLogger);if(o&&(!e.homeAccountId||this.matchHomeAccountId(o,e.homeAccountId))&&(!e.username||this.matchUsername(o.username,e.username))&&(!e.environment||this.matchEnvironment(o,e.environment))&&(!e.realm||this.matchRealm(o,e.realm))&&(!e.nativeAccountId||this.matchNativeAccountId(o,e.nativeAccountId))&&(!e.authorityType||this.matchAuthorityType(o,e.authorityType))){var a={localAccountId:e?.localAccountId,name:e?.name},s=o.tenantProfiles?.filter(c=>this.tenantProfileMatchesFilter(c,a));s&&0===s.length||r.push(o)}}}),r}isAccountKey(e,t,r){return!(e.split(re.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||r&&!e.toLowerCase().includes(r.toLowerCase()))}isCredentialKey(e){if(e.split(re.CACHE_KEY_SEPARATOR).length<6)return!1;var t=e.toLowerCase();if(-1===t.indexOf(P.ID_TOKEN.toLowerCase())&&-1===t.indexOf(P.ACCESS_TOKEN.toLowerCase())&&-1===t.indexOf(P.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())&&-1===t.indexOf(P.REFRESH_TOKEN.toLowerCase()))return!1;if(t.indexOf(P.REFRESH_TOKEN.toLowerCase())>-1){var i=`${P.REFRESH_TOKEN}${re.CACHE_KEY_SEPARATOR}1${re.CACHE_KEY_SEPARATOR}`;if(-1===t.indexOf(`${P.REFRESH_TOKEN}${re.CACHE_KEY_SEPARATOR}${this.clientId}${re.CACHE_KEY_SEPARATOR}`.toLowerCase())&&-1===t.indexOf(i.toLowerCase()))return!1}else if(-1===t.indexOf(this.clientId.toLowerCase()))return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||"string"==typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===P.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===F.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){var t=this.getKeys(),r={};return t.forEach(i=>{if(this.isAppMetadata(i)){var o=this.getAppMetadata(i);o&&(e.environment&&!this.matchEnvironment(o,e.environment)||e.clientId&&!this.matchClientId(o,e.clientId)||(r[i]=o))}}),r}getAuthorityMetadataByAlias(e){var t=this.getAuthorityMetadataKeys(),r=null;return t.forEach(i=>{if(this.isAuthorityMetadata(i)&&-1!==i.indexOf(this.clientId)){var o=this.getAuthorityMetadata(i);o&&-1!==o.aliases.indexOf(e)&&(r=o)}}),r}removeAllAccounts(){var e=this;return(0,v.A)(function*(){var t=e.getAccountKeys(),r=[];t.forEach(i=>{r.push(e.removeAccount(i))}),yield Promise.all(r)})()}removeAccount(e){var t=this;return(0,v.A)(function*(){var r=t.getAccount(e,t.commonLogger);r&&(yield t.removeAccountContext(r),t.removeItem(e))})()}removeAccountContext(e){var t=this;return(0,v.A)(function*(){var r=t.getTokenKeys(),i=e.generateAccountId(),o=[];r.idToken.forEach(a=>{0===a.indexOf(i)&&t.removeIdToken(a)}),r.accessToken.forEach(a=>{0===a.indexOf(i)&&o.push(t.removeAccessToken(a))}),r.refreshToken.forEach(a=>{0===a.indexOf(i)&&t.removeRefreshToken(a)}),yield Promise.all(o)})()}updateOutdatedCachedAccount(e,t,r){if(t&&t.isSingleTenant()){this.commonLogger?.verbose("updateOutdatedCachedAccount: Found a single-tenant (outdated) account entity in the cache, migrating to multi-tenant account entity");var i=this.getAccountKeys().filter(l=>l.startsWith(t.homeAccountId)),o=[];i.forEach(l=>{var d=this.getCachedAccountEntity(l);d&&o.push(d)});var a=o.find(l=>En(l.realm,l.homeAccountId))||o[0];a.tenantProfiles=o.map(l=>({tenantId:l.realm,localAccountId:l.localAccountId,name:l.name,isHomeTenant:En(l.realm,l.homeAccountId)}));var s=ht.toObject(new J,{...a}),c=s.generateAccountKey();return i.forEach(l=>{l!==c&&this.removeOutdatedAccount(e)}),this.setAccount(s),r?.verbose("Updated an outdated account entity in the cache"),s}return t}removeAccessToken(e){var t=this;return(0,v.A)(function*(){var r=t.getAccessTokenCredential(e);if(r){if(r.credentialType.toLowerCase()===P.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&r.tokenType===F.POP){var o=r.keyId;if(o)try{yield t.cryptoImpl.removeTokenBindingKey(o)}catch{throw T(Br)}}return t.removeItem(e)}})()}removeAppMetadata(){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t)}),!0}readAccountFromCache(e){var t=J.generateAccountCacheKey(e);return this.getAccount(t,this.commonLogger)}getIdToken(e,t,r,i,o){this.commonLogger.trace("CacheManager - getIdToken called");var s=this.getIdTokensByFilter({homeAccountId:e.homeAccountId,environment:e.environment,credentialType:P.ID_TOKEN,clientId:this.clientId,realm:r},t),c=s.size;if(c<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(c>1){var l=s;if(!r){var d=new Map;s.forEach((u,f)=>{u.realm===e.tenantId&&d.set(f,u)});var h=d.size;if(h<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),s.values().next().value;if(1===h)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),d.values().next().value;l=d}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),l.forEach((u,f)=>{this.removeIdToken(f)}),i&&o&&i.addFields({multiMatchedID:s.size},o),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),s.values().next().value}getIdTokensByFilter(e,t){var r=t&&t.idToken||this.getTokenKeys().idToken,i=new Map;return r.forEach(o=>{if(this.idTokenKeyMatchesFilter(o,{clientId:this.clientId,...e})){var a=this.getIdTokenCredential(o);a&&this.credentialMatchesFilter(a,e)&&i.set(o,a)}}),i}idTokenKeyMatchesFilter(e,t){var r=e.toLowerCase();return!(t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,r,i,o,a){this.commonLogger.trace("CacheManager - getAccessToken called");var s=j.createSearchScopes(t.scopes),c=t.authenticationScheme||F.BEARER,l=c&&c.toLowerCase()!==F.BEARER.toLowerCase()?P.ACCESS_TOKEN_WITH_AUTH_SCHEME:P.ACCESS_TOKEN,d={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:l,clientId:this.clientId,realm:i||e.tenantId,target:s,tokenType:c,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},h=r&&r.accessToken||this.getTokenKeys().accessToken,u=[];h.forEach(p=>{if(this.accessTokenKeyMatchesFilter(p,d,!0)){var m=this.getAccessTokenCredential(p);m&&this.credentialMatchesFilter(m,d)&&u.push(m)}});var f=u.length;return f<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):f>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),u.forEach(p=>{this.removeAccessToken(lt(p))}),o&&a&&o.addFields({multiMatchedAT:u.length},a),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),u[0])}accessTokenKeyMatchesFilter(e,t,r){var i=e.toLowerCase();if(t.clientId&&-1===i.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===i.indexOf(t.homeAccountId.toLowerCase())||t.realm&&-1===i.indexOf(t.realm.toLowerCase())||t.requestedClaimsHash&&-1===i.indexOf(t.requestedClaimsHash.toLowerCase()))return!1;if(t.target)for(var o=t.target.asArray(),a=0;a<o.length;a++){if(r&&!i.includes(o[a].toLowerCase()))return!1;if(!r&&i.includes(o[a].toLowerCase()))return!0}return!0}getAccessTokensByFilter(e){var t=this.getTokenKeys(),r=[];return t.accessToken.forEach(i=>{if(this.accessTokenKeyMatchesFilter(i,e,!0)){var o=this.getAccessTokenCredential(i);o&&this.credentialMatchesFilter(o,e)&&r.push(o)}}),r}getRefreshToken(e,t,r,i,o){this.commonLogger.trace("CacheManager - getRefreshToken called");var s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:P.REFRESH_TOKEN,clientId:this.clientId,familyId:t?"1":void 0},c=r&&r.refreshToken||this.getTokenKeys().refreshToken,l=[];c.forEach(h=>{if(this.refreshTokenKeyMatchesFilter(h,s)){var u=this.getRefreshTokenCredential(h);u&&this.credentialMatchesFilter(u,s)&&l.push(u)}});var d=l.length;return d<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(d>1&&i&&o&&i.addFields({multiMatchedRT:d},o),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),l[0])}refreshTokenKeyMatchesFilter(e,t){var r=e.toLowerCase();return!(t.familyId&&-1===r.indexOf(t.familyId.toLowerCase())||!t.familyId&&t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))}readAppMetadataFromCache(e){var r=this.getAppMetadataFilteredBy({environment:e,clientId:this.clientId}),i=Object.keys(r).map(a=>r[a]),o=i.length;if(o<1)return null;if(o>1)throw T(Mr);return i[0]}isAppMetadataFOCI(e){var t=this.readAppMetadataFromCache(e);return!(!t||"1"!==t.familyId)}matchHomeAccountId(e,t){return"string"==typeof e.homeAccountId&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return t.toLowerCase()===e.name?.toLowerCase()}matchUsername(e,t){return!(!e||"string"!=typeof e||t?.toLowerCase()!==e.toLowerCase())}matchUserAssertionHash(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){var r=function(n,e){var t,r=n.canonicalAuthority;if(r){var i=new x(r).getUrlComponents().HostNameAndPort;t=ga(i,n.cloudDiscoveryMetadata?.metadata,"config",e)||ga(i,xi.metadata,"hardcoded_values",e)||n.knownAuthorities}return t||[]}(this.staticAuthorityOptions,this.commonLogger);if(r.includes(t)&&r.includes(e.environment))return!0}var i=this.getAuthorityMetadataByAlias(t);return!!(i&&i.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!(!e.clientId||t!==e.clientId)}matchFamilyId(e,t){return!(!e.familyId||t!==e.familyId)}matchRealm(e,t){return e.realm?.toLowerCase()===t.toLowerCase()}matchNativeAccountId(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!(!e.authorityType||t.toLowerCase()!==e.authorityType.toLowerCase())}matchTarget(e,t){return!(e.credentialType!==P.ACCESS_TOKEN&&e.credentialType!==P.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&j.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!(!e.tokenType||e.tokenType!==t)}matchKeyId(e,t){return!(!e.keyId||e.keyId!==t)}isAppMetadata(e){return-1!==e.indexOf($n)}isAuthorityMetadata(e){return-1!==e.indexOf("authority-metadata")}generateAuthorityMetadataCacheKey(e){return`authority-metadata-${this.clientId}-${e}`}static toObject(e,t){for(var r in t)e[r]=t[r];return e}}class wc extends ht{setAccount(){throw T(D)}getAccount(){throw T(D)}getCachedAccountEntity(){throw T(D)}setIdTokenCredential(){throw T(D)}getIdTokenCredential(){throw T(D)}setAccessTokenCredential(){throw T(D)}getAccessTokenCredential(){throw T(D)}setRefreshTokenCredential(){throw T(D)}getRefreshTokenCredential(){throw T(D)}setAppMetadata(){throw T(D)}getAppMetadata(){throw T(D)}setServerTelemetry(){throw T(D)}getServerTelemetry(){throw T(D)}setAuthorityMetadata(){throw T(D)}getAuthorityMetadata(){throw T(D)}getAuthorityMetadataKeys(){throw T(D)}setThrottlingCache(){throw T(D)}getThrottlingCache(){throw T(D)}removeItem(){throw T(D)}getKeys(){throw T(D)}getAccountKeys(){throw T(D)}getTokenKeys(){throw T(D)}updateCredentialCacheKey(){throw T(D)}removeOutdatedAccount(){throw T(D)}}var ma={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},Rc={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:G.Info,correlationId:C.EMPTY_STRING},bc={claimsBasedCachingEnabled:!1},kc={sendGetRequestAsync:()=>(0,v.A)(function*(){throw T(D)})(),sendPostRequestAsync:()=>(0,v.A)(function*(){throw T(D)})()},Pc={sku:C.SKU,version:Ni,cpu:C.EMPTY_STRING,os:C.EMPTY_STRING},Oc={clientSecret:C.EMPTY_STRING,clientAssertion:void 0},Nc={azureCloudInstance:"none",tenant:`${C.DEFAULT_COMMON_TENANT}`},Mc={application:{appName:"",appVersion:""}};function Dc(n){return{clientCapabilities:[],azureCloudOptions:Nc,skipAuthorityMetadataCache:!1,instanceAware:!1,...n}}function Fi(n){return"OIDC"===n.authOptions.authority.options.protocolMode}var Lc={sendGetRequestAsync:()=>Promise.reject(T(D)),sendPostRequestAsync:()=>Promise.reject(T(D))};class pa{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class Hc{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:1,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new pa}}startPerformanceMeasurement(){return new pa}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}class wn{navigateInternal(e,t){return wn.defaultNavigateWindow(e,t)}navigateExternal(e,t){return wn.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(r=>{setTimeout(()=>{r(!0)},t.timeout)})}}class Rn extends q{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Rn.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}}function va(n,e,t){return new Rn(n,e,t)}class xc{sendGetRequestAsync(e,t){return(0,v.A)(function*(){var r,i,o=0,a=Ca(t);try{r=yield fetch(e,{method:"GET",headers:a})}catch{throw R(window.navigator.onLine?en:at)}i=ya(r.headers);try{return o=r.status,{headers:i,body:yield r.json(),status:o}}catch{throw va(R(Yt),o,i)}})()}sendPostRequestAsync(e,t){return(0,v.A)(function*(){var o,s,r=t&&t.body||"",i=Ca(t),a=0;try{o=yield fetch(e,{method:"POST",headers:i,body:r})}catch{throw R(window.navigator.onLine?Vt:at)}s=ya(o.headers);try{return a=o.status,{headers:s,body:yield o.json(),status:a}}catch{throw va(R(Yt),a,s)}})()}}function Ca(n){try{var e=new Headers;return n&&n.headers?(Object.entries(n.headers).forEach(([r,i])=>{e.append(r,i)}),e):e}catch{throw R(Oo)}}function ya(n){try{var e={};return n.forEach((t,r)=>{e[r]=t}),e}catch{throw R(No)}}var Gi=1e4,bn="3.28.0";class $i{static loggerCallback(e,t){}constructor(e){var t;this.browserEnvironment=typeof window<"u",this.config=function({auth:n,cache:e,system:t,telemetry:r},i){var o={clientId:C.EMPTY_STRING,authority:`${C.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:C.EMPTY_STRING,authorityMetadata:C.EMPTY_STRING,redirectUri:typeof window<"u"?Pe():"",postLogoutRedirectUri:C.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:"AAD",OIDCOptions:{serverResponseType:Tt.FRAGMENT,defaultScopes:[C.OPENID_SCOPE,C.PROFILE_SCOPE,C.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:"none",tenant:C.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},a={cacheLocation:oe.SessionStorage,temporaryCacheLocation:oe.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!e||e.cacheLocation!==oe.LocalStorage),claimsBasedCachingEnabled:!1},s={loggerCallback:()=>{},logLevel:G.Info,piiLoggingEnabled:!1},l={...{...ma,loggerOptions:s,networkClient:i?new xc:Lc,navigationClient:new wn,loadFrameTimeout:0,windowHashTimeout:t?.loadFrameTimeout||6e4,iframeHashTimeout:t?.loadFrameTimeout||Gi,navigateFrameWait:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:t?.nativeBrokerHandshakeTimeout||2e3,pollIntervalMilliseconds:ce.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:t?.loggerOptions||s},d={application:{appName:C.EMPTY_STRING,appVersion:C.EMPTY_STRING},client:new Hc};if("OIDC"!==n?.protocolMode&&n?.OIDCOptions&&new Fe(l.loggerOptions).warning(JSON.stringify($(Sr))),n?.protocolMode&&"AAD"!==n.protocolMode&&l?.allowNativeBroker)throw $(Er);return{auth:{...o,...n,OIDCOptions:{...o.OIDCOptions,...n?.OIDCOptions}},cache:{...a,...e},system:l,telemetry:{...d,...r}}}(e,this.browserEnvironment);try{t=window[oe.SessionStorage]}catch{}var r=t?.getItem("msal.browser.log.level"),i=t?.getItem("msal.browser.log.pii")?.toLowerCase(),o="true"===i||"false"!==i&&void 0,a={...this.config.system.loggerOptions},s=r&&Object.keys(G).includes(r)?G[r]:void 0;s&&(a.loggerCallback=$i.loggerCallback,a.logLevel=s),void 0!==o&&(a.piiLoggingEnabled=o),this.logger=new Fe(a,"@azure/msal-browser",bn),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}class Ye extends $i{getModuleName(){return Ye.MODULE_NAME}getId(){return Ye.ID}initialize(){var e=this;return(0,v.A)(function*(){return e.available=typeof window<"u",e.available})()}}Ye.MODULE_NAME="",Ye.ID="StandardOperatingContext";var Aa="missing_kid_error",Ta="missing_alg_error",qc={[Aa]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[Ta]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class qi extends q{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,qi.prototype)}}function Ia(n){return new qi(n,qc[n])}class zi{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw Ia(Aa);if(!e.alg)throw Ia(Ta);var t=new zi({typ:e.typ||"pop",kid:e.kid,alg:e.alg});return JSON.stringify(t)}}function Ie(n){return(new TextDecoder).decode(function(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw R(un)}var t=atob(e);return Uint8Array.from(t,r=>r.codePointAt(0)||0)}(n))}class Wc{constructor(){this.dbName=gi,this.version=1,this.tableName=ys,this.dbOpen=!1}open(){var e=this;return(0,v.A)(function*(){return new Promise((t,r)=>{var i=window.indexedDB.open(e.dbName,e.version);i.addEventListener("upgradeneeded",o=>{o.target.result.createObjectStore(e.tableName)}),i.addEventListener("success",o=>{e.db=o.target.result,e.dbOpen=!0,t()}),i.addEventListener("error",()=>r(R(Jt)))})})()}closeConnection(){var e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}validateDbIsOpen(){var e=this;return(0,v.A)(function*(){if(!e.dbOpen)return e.open()})()}getItem(e){var t=this;return(0,v.A)(function*(){return yield t.validateDbIsOpen(),new Promise((r,i)=>{if(!t.db)return i(R(xe));var s=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).get(e);s.addEventListener("success",c=>{var l=c;t.closeConnection(),r(l.target.result)}),s.addEventListener("error",c=>{t.closeConnection(),i(c)})})})()}setItem(e,t){var r=this;return(0,v.A)(function*(){return yield r.validateDbIsOpen(),new Promise((i,o)=>{if(!r.db)return o(R(xe));var c=r.db.transaction([r.tableName],"readwrite").objectStore(r.tableName).put(t,e);c.addEventListener("success",()=>{r.closeConnection(),i()}),c.addEventListener("error",l=>{r.closeConnection(),o(l)})})})()}removeItem(e){var t=this;return(0,v.A)(function*(){return yield t.validateDbIsOpen(),new Promise((r,i)=>{if(!t.db)return i(R(xe));var s=t.db.transaction([t.tableName],"readwrite").objectStore(t.tableName).delete(e);s.addEventListener("success",()=>{t.closeConnection(),r()}),s.addEventListener("error",c=>{t.closeConnection(),i(c)})})})()}getKeys(){var e=this;return(0,v.A)(function*(){return yield e.validateDbIsOpen(),new Promise((t,r)=>{if(!e.db)return r(R(xe));var a=e.db.transaction([e.tableName],"readonly").objectStore(e.tableName).getAllKeys();a.addEventListener("success",s=>{var c=s;e.closeConnection(),t(c.target.result)}),a.addEventListener("error",s=>{e.closeConnection(),r(s)})})})()}containsKey(e){var t=this;return(0,v.A)(function*(){return yield t.validateDbIsOpen(),new Promise((r,i)=>{if(!t.db)return i(R(xe));var s=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).count(e);s.addEventListener("success",c=>{var l=c;t.closeConnection(),r(1===l.target.result)}),s.addEventListener("error",c=>{t.closeConnection(),i(c)})})})()}deleteDatabase(){var e=this;return(0,v.A)(function*(){return e.db&&e.dbOpen&&e.closeConnection(),new Promise((t,r)=>{var i=window.indexedDB.deleteDatabase(gi),o=setTimeout(()=>r(!1),200);i.addEventListener("success",()=>(clearTimeout(o),t(!0))),i.addEventListener("blocked",()=>(clearTimeout(o),t(!0))),i.addEventListener("error",()=>(clearTimeout(o),r(!1)))})})()}}class Wi{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){var e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}class Qc{constructor(e){this.inMemoryCache=new Wi,this.indexedDBCache=new Wc,this.logger=e}handleDatabaseAccessError(e){if(!(e instanceof Xt&&e.errorCode===Jt))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")}getItem(e){var t=this;return(0,v.A)(function*(){var r=t.inMemoryCache.getItem(e);if(!r)try{return t.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),yield t.indexedDBCache.getItem(e)}catch(i){t.handleDatabaseAccessError(i)}return r})()}setItem(e,t){var r=this;return(0,v.A)(function*(){r.inMemoryCache.setItem(e,t);try{yield r.indexedDBCache.setItem(e,t)}catch(i){r.handleDatabaseAccessError(i)}})()}removeItem(e){var t=this;return(0,v.A)(function*(){t.inMemoryCache.removeItem(e);try{yield t.indexedDBCache.removeItem(e)}catch(r){t.handleDatabaseAccessError(r)}})()}getKeys(){var e=this;return(0,v.A)(function*(){var t=e.inMemoryCache.getKeys();if(0===t.length)try{return e.logger.verbose("In-memory cache is empty, now querying persistent storage."),yield e.indexedDBCache.getKeys()}catch(r){e.handleDatabaseAccessError(r)}return t})()}containsKey(e){var t=this;return(0,v.A)(function*(){var r=t.inMemoryCache.containsKey(e);if(!r)try{return t.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),yield t.indexedDBCache.containsKey(e)}catch(i){t.handleDatabaseAccessError(i)}return r})()}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}clearPersistent(){var e=this;return(0,v.A)(function*(){try{e.logger.verbose("Deleting persistent keystore");var t=yield e.indexedDBCache.deleteDatabase();return t&&e.logger.verbose("Persistent keystore deleted"),t}catch(r){return e.handleDatabaseAccessError(r),!1}})()}}class gt{constructor(e,t){this.logger=e,function(){if(!window)throw R(ot);if(!window.crypto)throw R(Ft);if(!window.crypto.subtle)throw R(Ft,"crypto_subtle_undefined")}(),this.cache=new Qc(this.logger),this.performanceClient=t}createNewGuid(){return ke()}base64Encode(e){return fi(e)}base64Decode(e){return Ie(e)}base64UrlEncode(e){return fn(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}getPublicKeyThumbprint(e){var t=this;return(0,v.A)(function*(){var r=t.performanceClient?.startMeasurement(g.CryptoOptsGetPublicKeyThumbprint,e.correlationId),i=yield function(n,e){return Ci.apply(this,arguments)}(gt.EXTRACTABLE,gt.POP_KEY_USAGES),o=yield yi(i.publicKey),s=Sa({e:o.e,kty:o.kty,n:o.n}),c=yield t.hashString(s),l=yield yi(i.privateKey),d=yield function(n,e,t){return Ti.apply(this,arguments)}(l,!1,["sign"]);return yield t.cache.setItem(c,{privateKey:d,publicKey:i.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),r&&r.end({success:!0}),c})()}removeTokenBindingKey(e){var t=this;return(0,v.A)(function*(){return yield t.cache.removeItem(e),!(yield t.cache.containsKey(e))})()}clearKeystore(){var e=this;return(0,v.A)(function*(){e.cache.clearInMemory();try{return yield e.cache.clearPersistent(),!0}catch(t){return t instanceof Error?e.logger.error(`Clearing keystore failed with error: ${t.message}`):e.logger.error("Clearing keystore failed with unknown error"),!1}})()}signJwt(e,t,r,i){var o=this;return(0,v.A)(function*(){var a=o.performanceClient?.startMeasurement(g.CryptoOptsSignJwt,i),s=yield o.cache.getItem(t);if(!s)throw R(jt);var c=yield yi(s.publicKey),l=Sa(c),d=fn(JSON.stringify({kid:t})),u=fn(zi.getShrHeaderString({...r?.header,alg:c.alg,kid:d}));e.cnf={jwk:JSON.parse(l)};var p=`${u}.${fn(JSON.stringify(e))}`,A=(new TextEncoder).encode(p),y=yield function(n,e){return Ii.apply(this,arguments)}(s.privateKey,A),K=`${p}.${mn(new Uint8Array(y))}`;return a&&a.end({success:!0}),K})()}hashString(e){return(0,v.A)(function*(){return Fo(e)})()}}function Sa(n){return JSON.stringify(n,Object.keys(n).sort())}gt.POP_KEY_USAGES=["sign","verify"],gt.EXTRACTABLE=!0;var je=(n,e,t,r,i)=>(...o)=>{t.trace(`Executing function ${e}`);var a=r?.startMeasurement(e,i);if(i){var s=e+"CallCount";r?.incrementFields({[s]:1},i)}try{var c=n(...o);return a?.end({success:!0}),t.trace(`Returning result from ${e}`),c}catch(l){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(l))}catch{t.trace("Unable to print error message.")}throw a?.end({success:!1},l),l}},E=(n,e,t,r,i)=>(...o)=>{t.trace(`Executing function ${e}`);var a=r?.startMeasurement(e,i);if(i){var s=e+"CallCount";r?.incrementFields({[s]:1},i)}return r?.setPreQueueTime(e,i),n(...o).then(c=>(t.trace(`Returning result from ${e}`),a?.end({success:!0}),c)).catch(c=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(c))}catch{t.trace("Unable to print error message.")}throw a?.end({success:!1},c),c})};class kn{constructor(e,t,r,i){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=i}detectRegion(e,t){var r=this;return(0,v.A)(function*(){r.performanceClient?.addQueueMeasurement(g.RegionDiscoveryDetectRegion,r.correlationId);var i=e;if(i)t.region_source="3";else{var o=kn.IMDS_OPTIONS;try{var a=yield E(r.getRegionFromIMDS.bind(r),g.RegionDiscoveryGetRegionFromIMDS,r.logger,r.performanceClient,r.correlationId)(C.IMDS_VERSION,o);if(200===a.status&&(i=a.body,t.region_source="4"),400===a.status){var s=yield E(r.getCurrentVersion.bind(r),g.RegionDiscoveryGetCurrentVersion,r.logger,r.performanceClient,r.correlationId)(o);if(!s)return t.region_source="1",null;var c=yield E(r.getRegionFromIMDS.bind(r),g.RegionDiscoveryGetRegionFromIMDS,r.logger,r.performanceClient,r.correlationId)(s,o);200===c.status&&(i=c.body,t.region_source="4")}}catch{return t.region_source="1",null}}return i||(t.region_source="1"),i||null})()}getRegionFromIMDS(e,t){var r=this;return(0,v.A)(function*(){return r.performanceClient?.addQueueMeasurement(g.RegionDiscoveryGetRegionFromIMDS,r.correlationId),r.networkInterface.sendGetRequestAsync(`${C.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,C.IMDS_TIMEOUT)})()}getCurrentVersion(e){var t=this;return(0,v.A)(function*(){t.performanceClient?.addQueueMeasurement(g.RegionDiscoveryGetCurrentVersion,t.correlationId);try{var r=yield t.networkInterface.sendGetRequestAsync(`${C.IMDS_ENDPOINT}?format=json`,e);return 400===r.status&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch{return null}})()}}kn.IMDS_OPTIONS={headers:{Metadata:"true"}};class ne{constructor(e,t,r,i,o,a,s,c){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=i,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=s,this.correlationId=a,this.managedIdentity=c||!1,this.regionDiscovery=new kn(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(C.CIAM_AUTH_URL))return 3;var t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case C.ADFS:return 1;case C.DSTS:return 2}return 0}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new x(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw T(fe)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw T(fe)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw T(fe)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw T(Fr);return this.replacePath(this.metadata.end_session_endpoint)}throw T(fe)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw T(fe)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw T(fe)}canReplaceTenant(e){return 1===e.PathSegments.length&&!ne.reservedTenantDomains.has(e.PathSegments[0])&&0===this.getAuthorityType(e)&&"AAD"===this.protocolMode}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){var t=e,i=new x(this.metadata.canonical_authority).getUrlComponents(),o=i.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((s,c)=>{var l=o[c];if(0===c&&this.canReplaceTenant(i)){var d=new x(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];l!==d&&(this.logger.verbose(`Replacing tenant domain name ${l} with id ${d}`),l=d)}s!==l&&(t=t.replace(`/${l}/`,`/${s}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){var e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||1===this.authorityType||"AAD"!==this.protocolMode&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}resolveEndpointsAsync(){var e=this;return(0,v.A)(function*(){e.performanceClient?.addQueueMeasurement(g.AuthorityResolveEndpointsAsync,e.correlationId);var t=e.getCurrentMetadataEntity(),r=yield E(e.updateCloudDiscoveryMetadata.bind(e),g.AuthorityUpdateCloudDiscoveryMetadata,e.logger,e.performanceClient,e.correlationId)(t);e.canonicalAuthority=e.canonicalAuthority.replace(e.hostnameAndPort,t.preferred_network);var i=yield E(e.updateEndpointMetadata.bind(e),g.AuthorityUpdateEndpointMetadata,e.logger,e.performanceClient,e.correlationId)(t);e.updateCachedMetadata(t,r,{source:i}),e.performanceClient?.addFields({cloudDiscoverySource:r,authorityEndpointSource:i},e.correlationId)})()}getCurrentMetadataEntity(){var e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:sa(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){"cache"!==t&&"cache"!==r?.source&&(e.expiresAt=sa(),e.canonical_authority=this.canonicalAuthority);var i=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(i,e),this.metadata=e}updateEndpointMetadata(e){var t=this;return(0,v.A)(function*(){t.performanceClient?.addQueueMeasurement(g.AuthorityUpdateEndpointMetadata,t.correlationId);var r=t.updateEndpointMetadataFromLocalSources(e);if(r){if("hardcoded_values"===r.source&&t.authorityOptions.azureRegionConfiguration?.azureRegion&&r.metadata){var i=yield E(t.updateMetadataWithRegionalInformation.bind(t),g.AuthorityUpdateMetadataWithRegionalInformation,t.logger,t.performanceClient,t.correlationId)(r.metadata);In(e,i,!1),e.canonical_authority=t.canonicalAuthority}return r.source}var o=yield E(t.getEndpointMetadataFromNetwork.bind(t),g.AuthorityGetEndpointMetadataFromNetwork,t.logger,t.performanceClient,t.correlationId)();if(o)return t.authorityOptions.azureRegionConfiguration?.azureRegion&&(o=yield E(t.updateMetadataWithRegionalInformation.bind(t),g.AuthorityUpdateMetadataWithRegionalInformation,t.logger,t.performanceClient,t.correlationId)(o)),In(e,o,!0),"network";throw T(Ot,t.defaultOpenIdConfigurationEndpoint)})()}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");var t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),In(e,t,!1),{source:"config"};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{var r=this.getEndpointMetadataFromHardcodedValues();if(r)return In(e,r,!1),{source:"hardcoded_values",metadata:r};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}var i=ca(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!i?(this.logger.verbose("Found endpoint metadata in the cache."),{source:"cache"}):(i&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new x(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw $(Tr)}return null}getEndpointMetadataFromNetwork(){var e=this;return(0,v.A)(function*(){e.performanceClient?.addQueueMeasurement(g.AuthorityGetEndpointMetadataFromNetwork,e.correlationId);var r=e.defaultOpenIdConfigurationEndpoint;e.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${r}`);try{var i=yield e.networkInterface.sendGetRequestAsync(r,{}),o=function(n){return n.hasOwnProperty("authorization_endpoint")&&n.hasOwnProperty("token_endpoint")&&n.hasOwnProperty("issuer")&&n.hasOwnProperty("jwks_uri")}(i.body);return o?i.body:(e.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(a){return e.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${a}`),null}})()}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in ua?ua[this.hostnameAndPort]:null}updateMetadataWithRegionalInformation(e){var t=this;return(0,v.A)(function*(){t.performanceClient?.addQueueMeasurement(g.AuthorityUpdateMetadataWithRegionalInformation,t.correlationId);var r=t.authorityOptions.azureRegionConfiguration?.azureRegion;if(r){if(r!==C.AZURE_REGION_AUTO_DISCOVER_FLAG)return t.regionDiscoveryMetadata.region_outcome="2",t.regionDiscoveryMetadata.region_used=r,ne.replaceWithRegionalInformation(e,r);var i=yield E(t.regionDiscovery.detectRegion.bind(t.regionDiscovery),g.RegionDiscoveryDetectRegion,t.logger,t.performanceClient,t.correlationId)(t.authorityOptions.azureRegionConfiguration?.environmentRegion,t.regionDiscoveryMetadata);if(i)return t.regionDiscoveryMetadata.region_outcome="4",t.regionDiscoveryMetadata.region_used=i,ne.replaceWithRegionalInformation(e,i);t.regionDiscoveryMetadata.region_outcome="5"}return e})()}updateCloudDiscoveryMetadata(e){var t=this;return(0,v.A)(function*(){t.performanceClient?.addQueueMeasurement(g.AuthorityUpdateCloudDiscoveryMetadata,t.correlationId);var r=t.updateCloudDiscoveryMetadataFromLocalSources(e);if(r)return r;var i=yield E(t.getCloudDiscoveryMetadataFromNetwork.bind(t),g.AuthorityGetCloudDiscoveryMetadataFromNetwork,t.logger,t.performanceClient,t.correlationId)();if(i)return Di(e,i,!0),"network";throw $(bt)})()}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||C.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||C.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||C.NOT_APPLICABLE}`);var t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),Di(e,t,!1),"config";if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{var r=function(n){return _n(xi.metadata,n)}(this.hostnameAndPort);if(r)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),Di(e,r,!1),"hardcoded_values";this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}var i=ca(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!i?(this.logger.verbose("Found cloud discovery metadata in the cache."),"cache"):(i&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(3===this.authorityType)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),ne.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");var t=_n(JSON.parse(this.authorityOptions.cloudDiscoveryMetadata).metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),$(Rt)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),ne.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}getCloudDiscoveryMetadataFromNetwork(){var e=this;return(0,v.A)(function*(){e.performanceClient?.addQueueMeasurement(g.AuthorityGetCloudDiscoveryMetadataFromNetwork,e.correlationId);var t=`${C.AAD_INSTANCE_DISCOVERY_ENDPT}${e.canonicalAuthority}oauth2/v2.0/authorize`,i=null;try{var a,s,o=yield e.networkInterface.sendGetRequestAsync(t,{});if(function(n){return n.hasOwnProperty("tenant_discovery_endpoint")&&n.hasOwnProperty("metadata")}(o.body))s=(a=o.body).metadata,e.logger.verbosePii(`tenant_discovery_endpoint is: ${a.tenant_discovery_endpoint}`);else{if(!function(n){return n.hasOwnProperty("error")&&n.hasOwnProperty("error_description")}(o.body))return e.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;if(e.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${o.status}`),(a=o.body).error===C.INVALID_INSTANCE)return e.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;e.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${a.error}`),e.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${a.error_description}`),e.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),s=[]}e.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),i=_n(s,e.hostnameAndPort)}catch(l){return e.logger.error(l instanceof q?`There was a network error while attempting to get the cloud discovery instance metadata.\nError: ${l.errorCode}\nError Description: ${l.errorMessage}`:`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.\nError: ${l.name}\nError Description: ${l.message}`),null}return i||(e.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),e.logger.verbose("Creating custom Authority for custom domain scenario."),i=ne.createCloudDiscoveryMetadataFromHost(e.hostnameAndPort)),i})()}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&x.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){var r;return t&&"none"!==t.azureCloudInstance&&(r=`${t.azureCloudInstance}/${t.tenant?t.tenant:C.DEFAULT_COMMON_TENANT}/`),r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return C.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw T(fe)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return ha.has(e)}static isPublicCloudAuthority(e){return C.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){var i=new x(e);i.validateAsUri();var o=i.getUrlComponents(),a=`${t}.${o.HostNameAndPort}`;this.isPublicCloudAuthority(o.HostNameAndPort)&&(a=`${t}.${C.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);var s=x.constructAuthorityUriFromObject({...i.getUrlComponents(),HostNameAndPort:a}).urlString;return r?`${s}?${r}`:s}static replaceWithRegionalInformation(e,t){var r={...e};return r.authorization_endpoint=ne.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=ne.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=ne.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){var t=e,i=new x(e).getUrlComponents();return 0===i.PathSegments.length&&i.HostNameAndPort.endsWith(C.CIAM_AUTH_URL)&&(t=`${t}${i.HostNameAndPort.split(".")[0]}${C.AAD_TENANT_DOMAIN_SUFFIX}`),t}}function Ea(n){return n.endsWith(C.FORWARD_SLASH)?n:`${n}${C.FORWARD_SLASH}`}ne.reservedTenantDomains=new Set(["{tenant}","{tenantid}","common","consumers","organizations"]);var ft="no_tokens_found",Pn="native_account_unavailable",Qi="refresh_token_expired",mt="bad_token",_a=["interaction_required","consent_required","login_required",mt],rl=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],On={[ft]:"No refresh token found in the cache. Please sign-in.",[Pn]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[Qi]:"Refresh token has expired.",[mt]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class he extends q{constructor(e,t,r,i,o,a,s,c){super(e,t,r),Object.setPrototypeOf(this,he.prototype),this.timestamp=i||C.EMPTY_STRING,this.traceId=o||C.EMPTY_STRING,this.correlationId=a||C.EMPTY_STRING,this.claims=s||C.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=c}}function wa(n,e,t){var r=!!n&&_a.indexOf(n)>-1,i=!!t&&rl.indexOf(t)>-1,o=!!e&&_a.some(a=>e.indexOf(a)>-1);return r||o||i}function Vi(n){return new he(n,On[n])}class ve{static setRequestState(e,t,r){var i=ve.generateLibraryState(e,r);return t?`${i}${C.RESOURCE_DELIM}${t}`:i}static generateLibraryState(e,t){if(!e)throw T(Ht);var r={id:e.createNewGuid()};t&&(r.meta=t);var i=JSON.stringify(r);return e.base64Encode(i)}static parseRequestState(e,t){if(!e)throw T(Ht);if(!t)throw T(He);try{var r=t.split(C.RESOURCE_DELIM),i=r[0],o=r.length>1?r.slice(1).join(C.RESOURCE_DELIM):C.EMPTY_STRING,a=e.base64Decode(i),s=JSON.parse(a);return{userRequestState:o||C.EMPTY_STRING,libraryState:s}}catch{throw T(He)}}}class nl{constructor(){if(!window.localStorage)throw wi(ct)}getItem(e){return window.localStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t)}removeItem(e){window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}}class il{constructor(){if(!window.sessionStorage)throw wi(ct)}getItem(e){return window.sessionStorage.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}}function Ra(n,e){if(!e)return null;try{return ve.parseRequestState(n,e).libraryState.meta}catch{throw T(He)}}class al{getItem(e){for(var t=`${encodeURIComponent(e)}`,r=document.cookie.split(";"),i=0;i<r.length;i++){var o=r[i],[a,...s]=decodeURIComponent(o).trim().split("="),c=s.join("=");if(a===t)return c}return""}setItem(e,t,r,i=!0){var o=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;if(r){var a=function(n){return new Date((new Date).getTime()+864e5*n).toUTCString()}(r);o+=`expires=${a};`}i&&(o+="Secure;"),document.cookie=o}removeItem(e){this.setItem(e,"",-1)}getKeys(){var e=document.cookie.split(";"),t=[];return e.forEach(r=>{var i=decodeURIComponent(r).trim().split("=");t.push(i[0])}),t}containsKey(e){return this.getKeys().includes(e)}}class Yi extends ht{constructor(e,t,r,i,o,a){super(e,r,i,o),this.cacheConfig=t,this.logger=i,this.internalStorage=new Wi,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupBrowserStorage(this.cacheConfig.temporaryCacheLocation),this.cookieStorage=new al,t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps()),this.performanceClient=a}setupBrowserStorage(e){try{switch(e){case oe.LocalStorage:return new nl;case oe.SessionStorage:return new il}}catch(t){this.logger.error(t)}return this.cacheConfig.cacheLocation=oe.MemoryStorage,new Wi}migrateCacheEntries(){var t=`${C.CACHE_PREFIX}.${X_CLIENT_INFO}`,r=`${C.CACHE_PREFIX}.${X_ERROR}`,i=`${C.CACHE_PREFIX}.${X_ERROR_DESC}`,l=[this.browserStorage.getItem(`${C.CACHE_PREFIX}.${X_ID_TOKEN}`),this.browserStorage.getItem(t),this.browserStorage.getItem(r),this.browserStorage.getItem(i)];[X_ID_TOKEN,X_CLIENT_INFO,X_ERROR,X_ERROR_DESC].forEach((h,u)=>{var f=l[u];f&&this.setTemporaryCache(h,f,!0)})}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");var e=this.getItem("msal.account.keys"),t=this.getItem(`msal.token.keys.${this.clientId}`);e&&t?this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration."):this.browserStorage.getKeys().forEach(i=>{if(this.isCredentialKey(i)){var o=this.getItem(i);if(o){var a=this.validateAndParseJson(o);if(a&&a.hasOwnProperty("credentialType"))switch(a.credentialType){case P.ID_TOKEN:if(oa(a)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${i} found, saving key to token key map`);var c=this.updateCredentialCacheKey(i,a);return void this.addTokenKey(c,P.ID_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${i}`);break;case P.ACCESS_TOKEN:case P.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(ia(a)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${i} found, saving key to token key map`);var d=this.updateCredentialCacheKey(i,a);return void this.addTokenKey(d,P.ACCESS_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${i}`);break;case P.REFRESH_TOKEN:if(aa(a)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${i} found, saving key to token key map`);var u=this.updateCredentialCacheKey(i,a);return void this.addTokenKey(u,P.REFRESH_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${i}`)}}}if(this.isAccountKey(i)){var f=this.getItem(i);if(f){var p=this.validateAndParseJson(f);p&&J.isAccountEntity(p)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${i} found, saving key to account key map`),this.addAccountKeyToMap(i))}}})}validateAndParseJson(e){try{var t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch{return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t){this.browserStorage.setItem(e,t)}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");var r=this.getCachedAccountEntity(e);return this.updateOutdatedCachedAccount(e,r,t)}getCachedAccountEntity(e){var t=this.getItem(e);if(!t)return this.removeAccountKeyFromMap(e),null;var r=this.validateAndParseJson(t);return r&&J.isAccountEntity(r)?ht.toObject(new J,r):(this.removeAccountKeyFromMap(e),null)}setAccount(e){this.logger.trace("BrowserCacheManager.setAccount called");var t=e.generateAccountKey();this.setItem(t,JSON.stringify(e)),this.addAccountKeyToMap(t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");var e=this.getItem("msal.account.keys");return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);var t=this.getAccountKeys();-1===t.indexOf(e)?(t.push(e),this.setItem("msal.account.keys",JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);var t=this.getAccountKeys(),r=t.indexOf(e);r>-1?(t.splice(r,1),this.setItem("msal.account.keys",JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e){var t=()=>super.removeAccount,r=this;return(0,v.A)(function*(){t().call(r,e),r.removeAccountKeyFromMap(e)})()}removeOutdatedAccount(e){this.removeItem(e),this.removeAccountKeyFromMap(e)}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,P.ID_TOKEN)}removeAccessToken(e){var t=()=>super.removeAccessToken,r=this;return(0,v.A)(function*(){t().call(r,e),r.removeTokenKey(e,P.ACCESS_TOKEN)})()}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,P.REFRESH_TOKEN)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");var e=this.getItem(`msal.token.keys.${this.clientId}`);if(e){var t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");var r=this.getTokenKeys();switch(t){case P.ID_TOKEN:-1===r.idToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),r.idToken.push(e));break;case P.ACCESS_TOKEN:-1===r.accessToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),r.accessToken.push(e));break;case P.REFRESH_TOKEN:-1===r.refreshToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),r.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),T(xt)}this.setItem(`msal.token.keys.${this.clientId}`,JSON.stringify(r))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");var r=this.getTokenKeys();switch(t){case P.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);var i=r.idToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),r.idToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case P.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);var o=r.accessToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),r.accessToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case P.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);var a=r.refreshToken.indexOf(e);a>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),r.refreshToken.splice(a,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),T(xt)}this.setItem(`msal.token.keys.${this.clientId}`,JSON.stringify(r))}getIdTokenCredential(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,P.ID_TOKEN),null;var r=this.validateAndParseJson(t);return r&&oa(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,P.ID_TOKEN),null)}setIdTokenCredential(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");var t=lt(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,P.ID_TOKEN)}getAccessTokenCredential(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,P.ACCESS_TOKEN),null;var r=this.validateAndParseJson(t);return r&&ia(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,P.ACCESS_TOKEN),null)}setAccessTokenCredential(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");var t=lt(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,P.ACCESS_TOKEN)}getRefreshTokenCredential(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,P.REFRESH_TOKEN),null;var r=this.validateAndParseJson(t);return r&&aa(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,P.REFRESH_TOKEN),null)}setRefreshTokenCredential(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");var t=lt(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,P.REFRESH_TOKEN)}getAppMetadata(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;var r=this.validateAndParseJson(t);return r&&function(n,e){return!!e&&0===n.indexOf($n)&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment")}(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");var t=function({environment:n,clientId:e}){return[$n,n,e].join(re.CACHE_KEY_SEPARATOR).toLowerCase()}(e);this.setItem(t,JSON.stringify(e))}getServerTelemetry(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;var r=this.validateAndParseJson(t);return r&&function(n,e){var t=0===n.indexOf(ee.CACHE_KEY),r=!0;return e&&(r=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&r}(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){var t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;var r=this.validateAndParseJson(t);return r&&function(n,e){return!!e&&0===n.indexOf("authority-metadata")&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri")}(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem("wrapper.sku",e),this.internalStorage.setItem("wrapper.version",t)}getWrapperMetadata(){return[this.internalStorage.getItem("wrapper.sku")||C.EMPTY_STRING,this.internalStorage.getItem("wrapper.version")||C.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){var e=this.generateCacheKey("active-account-filters"),t=this.getItem(e);if(!t){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");var r=this.generateCacheKey("active-account"),i=this.getItem(r);if(!i)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;var o=this.getAccountInfoFilteredBy({localAccountId:i});return o?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(o),o):null}var a=this.validateAndParseJson(t);return a?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:a.homeAccountId,localAccountId:a.localAccountId,tenantId:a.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){var t=this.generateCacheKey("active-account-filters"),r=this.generateCacheKey("active-account");e?(this.logger.verbose("setActiveAccount: Active account set"),this.browserStorage.setItem(t,JSON.stringify({homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId})),this.browserStorage.setItem(r,e.localAccountId)):(this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(r))}getThrottlingCache(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;var r=this.validateAndParseJson(t);return r&&function(n,e){var t=!1;n&&(t=0===n.indexOf("throttling"));var r=!0;return e&&(r=e.hasOwnProperty("throttleTime")),t&&r}(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){var r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){var i=this.cookieStorage.getItem(r);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),i}var o=this.temporaryCacheStorage.getItem(r);if(!o){if(this.cacheConfig.cacheLocation===oe.LocalStorage){var a=this.browserStorage.getItem(r);if(a)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),a}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),o}setTemporaryCache(e,t,r){var i=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(i,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(i,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(){var e=this;return(0,v.A)(function*(){yield e.removeAllAccounts(),e.removeAppMetadata(),e.temporaryCacheStorage.getKeys().forEach(t=>{(-1!==t.indexOf(C.CACHE_PREFIX)||-1!==t.indexOf(e.clientId))&&e.removeTemporaryItem(t)}),e.browserStorage.getKeys().forEach(t=>{(-1!==t.indexOf(C.CACHE_PREFIX)||-1!==t.indexOf(e.clientId))&&e.browserStorage.removeItem(t)}),e.internalStorage.clear()})()}clearTokensAndKeysWithClaims(e,t){var r=this;return(0,v.A)(function*(){e.addQueueMeasurement(g.ClearTokensAndKeysWithClaims,t);var i=r.getTokenKeys(),o=[];i.accessToken.forEach(a=>{var s=r.getAccessTokenCredential(a);s?.requestedClaimsHash&&a.includes(s.requestedClaimsHash.toLowerCase())&&o.push(r.removeAccessToken(a))}),yield Promise.all(o),o.length>0&&r.logger.warning(`${o.length} access tokens with claims in the cache keys have been removed from the cache.`)})()}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):ge.startsWith(e,C.CACHE_PREFIX)||ge.startsWith(e,"adal.idtoken")?e:`${C.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){var{libraryState:{id:t}}=ve.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`authority.${t}`)}generateNonceKey(e){var{libraryState:{id:t}}=ve.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`nonce.id_token.${t}`)}generateStateKey(e){var{libraryState:{id:t}}=ve.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`request.state.${t}`)}getCachedAuthority(e){var t=this.generateStateKey(e),r=this.getTemporaryCache(t);if(!r)return null;var i=this.generateAuthorityKey(r);return this.getTemporaryCache(i)}updateCacheEntries(e,t,r,i,o){this.logger.trace("BrowserCacheManager.updateCacheEntries called");var a=this.generateStateKey(e);this.setTemporaryCache(a,e,!1);var s=this.generateNonceKey(e);this.setTemporaryCache(s,t,!1);var c=this.generateAuthorityKey(e);this.setTemporaryCache(c,r,!1),o?this.setTemporaryCache("ccs.credential",JSON.stringify({credential:o.homeAccountId,type:"home_account_id"}),!0):i&&this.setTemporaryCache("ccs.credential",JSON.stringify({credential:i,type:"UPN"}),!0)}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{-1!==t.indexOf(e)&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey("request.params")),this.removeTemporaryItem(this.generateCacheKey("request.origin")),this.removeTemporaryItem(this.generateCacheKey("urlHash")),this.removeTemporaryItem(this.generateCacheKey("request.correlationId")),this.removeTemporaryItem(this.generateCacheKey("ccs.credential")),this.removeTemporaryItem(this.generateCacheKey("request.native")),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){var t=this.generateStateKey(e),r=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r||C.EMPTY_STRING)}}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(-1!==t.indexOf("request.state")){var r=this.temporaryCacheStorage.getItem(t);if(r){var i=Ra(this.cryptoImpl,r);i&&i.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r))}}}),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");var t=fi(JSON.stringify(e));this.setTemporaryCache("request.params",t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");var r,t=this.getTemporaryCache("request.params",!0);if(!t)throw R(Xr);try{r=JSON.parse(Ie(t))}catch(a){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${a}`),R(Zr)}if(this.removeTemporaryItem(this.generateCacheKey("request.params")),!r.authority){var i=this.generateAuthorityKey(e),o=this.getTemporaryCache(i);if(!o)throw R(Qt);r.authority=o}return r}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");var e=this.getTemporaryCache("request.native",!0);return e?this.validateAndParseJson(e)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null):(this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null)}isInteractionInProgress(e){var t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){return this.getTemporaryCache(`${C.CACHE_PREFIX}.interaction.status`,!1)}setInteractionInProgress(e){var t=`${C.CACHE_PREFIX}.interaction.status`;if(e){if(this.getInteractionInProgress())throw R($t);this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeTemporaryItem(t)}getLegacyLoginHint(){var e=this.getTemporaryCache("adal.idtoken");e&&(this.browserStorage.removeItem("adal.idtoken"),this.logger.verbose("Cached ADAL id token retrieved."));var t=this.getTemporaryCache(X_ID_TOKEN,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(X_ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));var r=t||e;if(r){var i=Ve(r,Ie);if(i.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),i.preferred_username;if(i.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),i.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t){var r=lt(t);if(e!==r){var i=this.getItem(e);if(i)return this.browserStorage.removeItem(e),this.setItem(r,i),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),r;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}hydrateCache(e,t){var r=this;return(0,v.A)(function*(){var o,i=An(e.account?.homeAccountId,e.account?.environment,e.idToken,r.clientId,e.tenantId);t.claims&&(o=yield r.cryptoImpl.hashString(t.claims));var a=Tn(e.account?.homeAccountId,e.account.environment,e.accessToken,r.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,Ie,void 0,e.tokenType,void 0,t.sshKid,t.claims,o);return r.saveCacheRecord({idToken:i,accessToken:a})})()}saveCacheRecord(e,t,r){var i=()=>super.saveCacheRecord,o=this;return(0,v.A)(function*(){try{yield i().call(o,e,t,r)}catch(s){if(s instanceof ut&&o.performanceClient&&r)try{var a=o.getTokenKeys();o.performanceClient.addFields({cacheRtCount:a.refreshToken.length,cacheIdCount:a.idToken.length,cacheAtCount:a.accessToken.length},r)}catch{}throw s}})()}}class pl{constructor(e){this.eventCallbacks=new Map,this.logger=e||new Fe({})}addEventCallback(e,t,r){if(typeof window<"u"){var i=r||ke();return this.eventCallbacks.has(i)?(this.logger.error(`Event callback with id: ${i} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(i,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${i}`),i)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,r,i){if(typeof window<"u"){var o={eventType:e,interactionType:t||null,payload:r||null,error:i||null,timestamp:Date.now()};this.eventCallbacks.forEach(([a,s],c)=>{(0===s.length||s.includes(e))&&(this.logger.verbose(`Emitting event to callback ${c}: ${e}`),a.apply(null,[o]))})}}}class Ge extends q{constructor(e,t,r,i,o){super(e,t,r),this.name="ServerError",this.errorNo=i,this.status=o,Object.setPrototypeOf(this,Ge.prototype)}}class Se{static generateThrottlingStorageKey(e){return`throttling.${JSON.stringify(e)}`}static preProcess(e,t){var r=Se.generateThrottlingStorageKey(t),i=e.getThrottlingCache(r);if(i){if(i.throttleTime<Date.now())return void e.removeItem(r);throw new Ge(i.errorCodes?.join(" ")||C.EMPTY_STRING,i.errorMessage,i.subError)}}static postProcess(e,t,r){if(Se.checkResponseStatus(r)||Se.checkResponseForRetryAfter(r)){var i={throttleTime:Se.calculateThrottleTime(parseInt(r.headers["Retry-After"])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(Se.generateThrottlingStorageKey(t),i)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty("Retry-After")&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){var t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(1e3*Math.min(r+(t||60),r+3600))}static removeThrottle(e,t,r,i){var a=this.generateThrottlingStorageKey({clientId:t,authority:r.authority,scopes:r.scopes,homeAccountIdentifier:i,claims:r.claims,authenticationScheme:r.authenticationScheme,resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,sshKid:r.sshKid});e.removeItem(a)}}var Je="client_id",ba="redirect_uri",ka="response_type",Pa="token_type",Oa="req_cnf",Na="return_spa_code",Xl="x-client-xtra-sku",ji="brk_client_id",Ji="brk_redirect_uri";class pt{static validateRedirectUri(e){if(!e)throw $(gr)}static validatePrompt(e){var t=[];for(var r in Z)t.push(Z[r]);if(t.indexOf(e)<0)throw $(vr)}static validateClaims(e){try{JSON.parse(e)}catch{throw $(_t)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw $(wt);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([_o.PLAIN,_o.S256].indexOf(e)<0)throw $(Ar)}}class tr{constructor(e,t){this.parameters=new Map,this.performanceClient=t,this.correlationId=e}addResponseTypeCode(){this.parameters.set(ka,encodeURIComponent(C.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(ka,encodeURIComponent(`${C.TOKEN_RESPONSE_TYPE} ${C.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set("response_mode",encodeURIComponent(e||fs.QUERY))}addNativeBroker(){this.parameters.set("nativebroker",encodeURIComponent("1"))}addScopes(e,t=!0,r=Ze){t&&!r.includes("openid")&&!e.includes("openid")&&r.push("openid");var i=t?[...e||[],...r]:e||[],o=new j(i);this.parameters.set("scope",encodeURIComponent(o.printScopes()))}addClientId(e){this.parameters.set(Je,encodeURIComponent(e))}addRedirectUri(e){pt.validateRedirectUri(e),this.parameters.set(ba,encodeURIComponent(e))}addPostLogoutRedirectUri(e){pt.validateRedirectUri(e),this.parameters.set("post_logout_redirect_uri",encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set("id_token_hint",encodeURIComponent(e))}addDomainHint(e){this.parameters.set("domain_hint",encodeURIComponent(e))}addLoginHint(e){this.parameters.set("login_hint",encodeURIComponent(e))}addCcsUpn(e){this.parameters.set("X-AnchorMailbox",encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set("X-AnchorMailbox",encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set("sid",encodeURIComponent(e))}addClaims(e,t){var r=this.addClientCapabilitiesToClaims(e,t);pt.validateClaims(r),this.parameters.set("claims",encodeURIComponent(r))}addCorrelationId(e){this.parameters.set("client-request-id",encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set("x-client-SKU",e.sku),this.parameters.set("x-client-VER",e.version),e.os&&this.parameters.set("x-client-OS",e.os),e.cpu&&this.parameters.set("x-client-CPU",e.cpu)}addApplicationTelemetry(e){e?.appName&&this.parameters.set("x-app-name",e.appName),e?.appVersion&&this.parameters.set("x-app-ver",e.appVersion)}addPrompt(e){pt.validatePrompt(e),this.parameters.set("prompt",encodeURIComponent(e))}addState(e){e&&this.parameters.set("state",encodeURIComponent(e))}addNonce(e){this.parameters.set("nonce",encodeURIComponent(e))}addCodeChallengeParams(e,t){if(pt.validateCodeChallengeParams(e,t),!e||!t)throw $(wt);this.parameters.set("code_challenge",encodeURIComponent(e)),this.parameters.set("code_challenge_method",encodeURIComponent(t))}addAuthorizationCode(e){this.parameters.set("code",encodeURIComponent(e))}addDeviceCode(e){this.parameters.set("device_code",encodeURIComponent(e))}addRefreshToken(e){this.parameters.set("refresh_token",encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set("code_verifier",encodeURIComponent(e))}addClientSecret(e){this.parameters.set("client_secret",encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set("client_assertion",encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set("client_assertion_type",encodeURIComponent(e))}addOboAssertion(e){this.parameters.set("assertion",encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set("requested_token_use",encodeURIComponent(e))}addGrantType(e){this.parameters.set("grant_type",encodeURIComponent(e))}addClientInfo(){this.parameters.set("client_info","1")}addExtraQueryParameters(e){Object.entries(e).forEach(([t,r])=>{!this.parameters.has(t)&&r&&this.parameters.set(t,r)})}addClientCapabilitiesToClaims(e,t){var r;if(e)try{r=JSON.parse(e)}catch{throw $(_t)}else r={};return t&&t.length>0&&(r.hasOwnProperty("access_token")||(r.access_token={}),r.access_token.xms_cc={values:t}),JSON.stringify(r)}addUsername(e){this.parameters.set("username",encodeURIComponent(e))}addPassword(e){this.parameters.set("password",encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(Pa,F.POP),this.parameters.set(Oa,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(Pa,F.SSH),this.parameters.set(Oa,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set("x-client-current-telemetry",e.generateCurrentRequestHeaderValue()),this.parameters.set("x-client-last-telemetry",e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set("x-ms-lib-capability","retry-after, h429")}addLogoutHint(e){this.parameters.set("logout_hint",encodeURIComponent(e))}addBrokerParameters(e){var t={};t[ji]=e.brokerClientId,t[Ji]=e.brokerRedirectUri,this.addExtraQueryParameters(t)}createQueryString(){var e=new Array;return this.parameters.forEach((t,r)=>{e.push(`${r}=${t}`)}),function(n,e,t){if(e){var r=n.get(Je);r&&n.has(ji)&&t?.addFields({embeddedClientId:r,embeddedRedirectUri:n.get(ba)},e)}}(this.parameters,this.correlationId,this.performanceClient),e.join("&")}}function Ma(n,e,t,r,i,o,a){return Xi.apply(this,arguments)}function Xi(){return Xi=(0,v.A)(function*(n,e,t,r,i,o,a){a?.addQueueMeasurement(g.AuthorityFactoryCreateDiscoveredInstance,o);var s=ne.transformCIAMAuthority(Ea(n)),c=new ne(s,e,t,r,i,o,a);try{return yield E(c.resolveEndpointsAsync.bind(c),g.AuthorityResolveEndpointsAsync,i,a,o)(),c}catch{throw T(fe)}}),Xi.apply(this,arguments)}class Zi{constructor(e,t){this.config=function({authOptions:n,systemOptions:e,loggerOptions:t,cacheOptions:r,storageInterface:i,networkInterface:o,cryptoInterface:a,clientCredentials:s,libraryInfo:c,telemetry:l,serverTelemetryManager:d,persistencePlugin:h,serializableCache:u}){var f={...Rc,...t};return{authOptions:Dc(n),systemOptions:{...ma,...e},loggerOptions:f,cacheOptions:{...bc,...r},storageInterface:i||new wc(n.clientId,yn,new Fe(f)),networkInterface:o||kc,cryptoInterface:a||yn,clientCredentials:s||Oc,libraryInfo:{...Pc,...c},telemetry:{...Mc,...l},serverTelemetryManager:d||null,persistencePlugin:h||null,serializableCache:u||null}}(e),this.logger=new Fe(this.config.loggerOptions,ta,Ni),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){var t={};if(t["Content-Type"]=C.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case"home_account_id":try{var r=dt(e.credential);t["X-AnchorMailbox"]=`Oid:${r.uid}@${r.utid}`}catch(i){this.logger.verbose("Could not parse home account ID for CCS Header: "+i)}break;case"UPN":t["X-AnchorMailbox"]=`UPN: ${e.credential}`}return t}executePostToTokenEndpoint(e,t,r,i,o,a){var s=this;return(0,v.A)(function*(){a&&s.performanceClient?.addQueueMeasurement(a,o);var c=yield s.sendPostRequest(i,e,{body:t,headers:r},o);return s.config.serverTelemetryManager&&c.status<500&&429!==c.status&&s.config.serverTelemetryManager.clearTelemetryCache(),c})()}sendPostRequest(e,t,r,i){var o=this;return(0,v.A)(function*(){var a;Se.preProcess(o.cacheManager,e);try{var s=(a=yield E(o.networkClient.sendPostRequestAsync.bind(o.networkClient),g.NetworkClientSendPostRequestAsync,o.logger,o.performanceClient,i)(t,r)).headers||{};o.performanceClient?.addFields({refreshTokenSize:a.body.refresh_token?.length||0,httpVerToken:s["x-ms-httpver"]||"",requestId:s["x-ms-request-id"]||""},i)}catch(l){if(l instanceof Rn){var c=l.responseHeaders;throw c&&o.performanceClient?.addFields({httpVerToken:c["x-ms-httpver"]||"",requestId:c["x-ms-request-id"]||"",contentTypeHeader:c["Content-Type"]||void 0,contentLengthHeader:c["Content-Length"]||void 0,httpStatus:l.httpStatus},i),l.error}throw l instanceof q?l:T(br)}return Se.postProcess(o.cacheManager,e,a),a})()}updateAuthority(e,t){var r=this;return(0,v.A)(function*(){r.performanceClient?.addQueueMeasurement(g.UpdateTokenEndpointAuthority,t);var i=`https://${e}/${r.authority.tenant}/`,o=yield Ma(i,r.networkClient,r.cacheManager,r.authority.options,r.logger,t,r.performanceClient);r.authority=o})()}createTokenQueryParameters(e){var t=new tr(e.correlationId,this.performanceClient);return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.addCorrelationId(e.correlationId),t.createQueryString()}}class vt{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}generateCnf(e,t){var r=this;return(0,v.A)(function*(){r.performanceClient?.addQueueMeasurement(g.PopTokenGenerateCnf,e.correlationId);var i=yield E(r.generateKid.bind(r),g.PopTokenGenerateCnf,t,r.performanceClient,e.correlationId)(e),o=r.cryptoUtils.base64UrlEncode(JSON.stringify(i));return{kid:i.kid,reqCnfString:o}})()}generateKid(e){var t=this;return(0,v.A)(function*(){return t.performanceClient?.addQueueMeasurement(g.PopTokenGenerateKid,e.correlationId),{kid:yield t.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:"sw"}})()}signPopToken(e,t,r){var i=this;return(0,v.A)(function*(){return i.signPayload(e,t,r)})()}signPayload(e,t,r,i){var o=this;return(0,v.A)(function*(){var{resourceRequestMethod:a,resourceRequestUri:s,shrClaims:c,shrNonce:l,shrOptions:d}=r,h=s?new x(s):void 0,u=h?.getUrlComponents();return o.cryptoUtils.signJwt({at:e,ts:Te(),m:a?.toUpperCase(),u:u?.HostNameAndPort,nonce:l||o.cryptoUtils.createNewGuid(),p:u?.AbsolutePath,q:u?.QueryString?[[],u.QueryString]:void 0,client_claims:c||void 0,...i},t,d,r.correlationId)})()}}class td{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}class Xe{constructor(e,t,r,i,o,a,s){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=i,this.serializableCache=o,this.persistencePlugin=a,this.performanceClient=s}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw T(rt,e.state?"Cached State":"Server State");var r,i;try{r=decodeURIComponent(e.state)}catch{throw T(He,e.state)}try{i=decodeURIComponent(t)}catch{throw T(He,e.state)}if(r!==i)throw T(Pr);if(e.error||e.error_description||e.suberror){var o=function(n){var t=n.error_uri?.lastIndexOf("code=");return t&&t>=0?n.error_uri?.substring(t+5):void 0}(e);throw wa(e.error,e.error_description,e.suberror)?new he(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",o):new Ge(e.error||"",e.error_description,e.suberror,o)}}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){var r=`Error(s): ${e.error_codes||C.NOT_AVAILABLE} - Timestamp: ${e.timestamp||C.NOT_AVAILABLE} - Description: ${e.error_description||C.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||C.NOT_AVAILABLE} - Trace ID: ${e.trace_id||C.NOT_AVAILABLE}`,i=e.error_codes?.length?e.error_codes[0]:void 0,o=new Ge(e.error,r,e.suberror,i,e.status);if(t&&e.status&&e.status>=500&&e.status<=599)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.\n${o}`);if(t&&e.status&&e.status>=400&&e.status<=499)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.\n${o}`);throw wa(e.error,e.error_description,e.suberror)?new he(e.error,e.error_description,e.suberror,e.timestamp||C.EMPTY_STRING,e.trace_id||C.EMPTY_STRING,e.correlation_id||C.EMPTY_STRING,e.claims||C.EMPTY_STRING,i):o}}handleServerTokenResponse(e,t,r,i,o,a,s,c,l){var d=this;return(0,v.A)(function*(){var h,f;if(d.performanceClient?.addQueueMeasurement(g.HandleServerTokenResponse,e.correlation_id),e.id_token){if(h=Ve(e.id_token||C.EMPTY_STRING,d.cryptoObj.base64Decode),o&&o.nonce&&h.nonce!==o.nonce)throw T(Or);if(i.maxAge||0===i.maxAge){var u=h.auth_time;if(!u)throw T(Nt);ra(u,i.maxAge)}}d.homeAccountIdentifier=J.generateHomeAccountId(e.client_info||C.EMPTY_STRING,t.authorityType,d.logger,d.cryptoObj,h),o&&o.state&&(f=ve.parseRequestState(d.cryptoObj,o.state)),e.key_id=e.key_id||i.sshKid||void 0;var m,p=d.generateCacheRecord(e,t,r,i,h,a,o);try{if(d.persistencePlugin&&d.serializableCache&&(d.logger.verbose("Persistence enabled, calling beforeCacheAccess"),m=new td(d.serializableCache,!0),yield d.persistencePlugin.beforeCacheAccess(m)),s&&!c&&p.account){var A=p.account.generateAccountKey();if(!d.cacheStorage.getAccount(A,d.logger))return d.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),yield Xe.generateAuthenticationResult(d.cryptoObj,t,p,!1,i,h,f,void 0,l)}yield d.cacheStorage.saveCacheRecord(p,i.storeInCache,i.correlationId)}finally{d.persistencePlugin&&d.serializableCache&&m&&(d.logger.verbose("Persistence enabled, calling afterCacheAccess"),yield d.persistencePlugin.afterCacheAccess(m))}return Xe.generateAuthenticationResult(d.cryptoObj,t,p,!1,i,h,f,e,l)})()}generateCacheRecord(e,t,r,i,o,a,s){var c=t.getPreferredCache();if(!c)throw T(Dt);var d,h,l=la(o);e.id_token&&o&&(d=An(this.homeAccountIdentifier,c,e.id_token,this.clientId,l||""),h=eo(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,o,e.client_info,c,l,s,void 0,this.logger));var u=null;if(e.access_token){var f=e.scope?j.fromString(e.scope):new j(i.scopes||[]),p=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,m=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,A=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,y=r+p,_=y+m,K=A&&A>0?r+A:void 0;u=Tn(this.homeAccountIdentifier,c,e.access_token,this.clientId,l||t.tenant||"",f.printScopes(),y,_,this.cryptoObj.base64Decode,K,e.token_type,a,e.key_id,i.claims,i.requestedClaimsHash)}var H,Y=null;e.refresh_token&&(e.refresh_token_expires_in&&(H=r+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in)),Y=na(this.homeAccountIdentifier,c,e.refresh_token,this.clientId,e.foci,a,H));var Ue=null;return e.foci&&(Ue={clientId:this.clientId,environment:c,familyId:e.foci}),{account:h,idToken:d,accessToken:u,refreshToken:Y,appMetadata:Ue}}static generateAuthenticationResult(e,t,r,i,o,a,s,c,l){return(0,v.A)(function*(){var f,p,d=C.EMPTY_STRING,h=[],u=null,m=C.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType!==F.POP||o.popKid)d=r.accessToken.secret;else{var A=new vt(e),{secret:y,keyId:_}=r.accessToken;if(!_)throw T(Kt);d=yield A.signPopToken(y,_,o)}h=j.fromString(r.accessToken.target).asArray(),u=new Date(1e3*Number(r.accessToken.expiresOn)),f=new Date(1e3*Number(r.accessToken.extendedExpiresOn)),r.accessToken.refreshOn&&(p=new Date(1e3*Number(r.accessToken.refreshOn)))}r.appMetadata&&(m="1"===r.appMetadata.familyId?"1":"");var K=a?.oid||a?.sub||"",Y=a?.tid||"";c?.spa_accountid&&r.account&&(r.account.nativeAccountId=c?.spa_accountid);var H=r.account?Hi(r.account.getAccountInfo(),void 0,a,r.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:K,tenantId:Y,scopes:h,account:H,idToken:r?.idToken?.secret||"",idTokenClaims:a||{},accessToken:d,fromCache:i,expiresOn:u,extExpiresOn:f,refreshOn:p,correlationId:o.correlationId,requestId:l||C.EMPTY_STRING,familyId:m,tokenType:r.accessToken?.tokenType||C.EMPTY_STRING,state:s?s.userRequestState:C.EMPTY_STRING,cloudGraphHostName:r.account?.cloudGraphHostName||C.EMPTY_STRING,msGraphHost:r.account?.msGraphHost||C.EMPTY_STRING,code:c?.spa_code,fromNativeBroker:!1}})()}}function eo(n,e,t,r,i,o,a,s,c,l,d){d?.verbose("setCachedAccount called");var u=n.getAccountKeys().find(_=>_.startsWith(t)),f=null;u&&(f=n.getAccount(u,d));var p=f||J.createAccount({homeAccountId:t,idTokenClaims:i,clientInfo:o,environment:a,cloudGraphHostName:c?.cloud_graph_host_name,msGraphHost:c?.msgraph_host,nativeAccountId:l},e,r),m=p.tenantProfiles||[],A=s||p.realm;if(A&&!m.find(_=>_.tenantId===A)){var y=Li(t,p.localAccountId,A,i);m.push(y)}return p.tenantProfiles=m,p}function Ua(n,e,t){return to.apply(this,arguments)}function to(){return to=(0,v.A)(function*(n,e,t){return"string"==typeof n?n:n({clientId:e,tokenEndpoint:t})}),to.apply(this,arguments)}class Da extends Zi{constructor(e,t){super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}getAuthCodeUrl(e){var t=this;return(0,v.A)(function*(){t.performanceClient?.addQueueMeasurement(g.GetAuthCodeUrl,e.correlationId);var r=yield E(t.createAuthCodeUrlQueryString.bind(t),g.AuthClientCreateQueryString,t.logger,t.performanceClient,e.correlationId)(e);return x.appendQueryString(t.authority.authorizationEndpoint,r)})()}acquireToken(e,t){var r=this;return(0,v.A)(function*(){if(r.performanceClient?.addQueueMeasurement(g.AuthClientAcquireToken,e.correlationId),!e.code)throw T(Ur);var i=Te(),o=yield E(r.executeTokenRequest.bind(r),g.AuthClientExecuteTokenRequest,r.logger,r.performanceClient,e.correlationId)(r.authority,e),a=o.headers?.["x-ms-request-id"],s=new Xe(r.config.authOptions.clientId,r.cacheManager,r.cryptoUtils,r.logger,r.config.serializableCache,r.config.persistencePlugin,r.performanceClient);return s.validateTokenResponse(o.body),E(s.handleServerTokenResponse.bind(s),g.HandleServerTokenResponse,r.logger,r.performanceClient,e.correlationId)(o.body,r.authority,i,e,t,void 0,void 0,void 0,a)})()}handleFragmentResponse(e,t){if(new Xe(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw T(Kr);return e}getLogoutUri(e){if(!e)throw $(yr);var t=this.createLogoutUrlQueryString(e);return x.appendQueryString(this.authority.endSessionEndpoint,t)}executeTokenRequest(e,t){var r=this;return(0,v.A)(function*(){r.performanceClient?.addQueueMeasurement(g.AuthClientExecuteTokenRequest,t.correlationId);var i=r.createTokenQueryParameters(t),o=x.appendQueryString(e.tokenEndpoint,i),a=yield E(r.createTokenRequestBody.bind(r),g.AuthClientCreateTokenRequestBody,r.logger,r.performanceClient,t.correlationId)(t),s=void 0;if(t.clientInfo)try{var c=Sn(t.clientInfo,r.cryptoUtils.base64Decode);s={credential:`${c.uid}${re.CLIENT_INFO_SEPARATOR}${c.utid}`,type:"home_account_id"}}catch(h){r.logger.verbose("Could not parse client info for CCS Header: "+h)}var l=r.createTokenRequestHeaders(s||t.ccsCredential),d={clientId:t.tokenBodyParameters?.clientId||r.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return E(r.executePostToTokenEndpoint.bind(r),g.AuthorizationCodeClientExecutePostToTokenEndpoint,r.logger,r.performanceClient,t.correlationId)(o,a,l,d,t.correlationId,g.AuthorizationCodeClientExecutePostToTokenEndpoint)})()}createTokenRequestBody(e){var t=this;return(0,v.A)(function*(){t.performanceClient?.addQueueMeasurement(g.AuthClientCreateTokenRequestBody,e.correlationId);var r=new tr(e.correlationId,t.performanceClient);if(r.addClientId(e.embeddedClientId||e.tokenBodyParameters?.[Je]||t.config.authOptions.clientId),t.includeRedirectUri?r.addRedirectUri(e.redirectUri):pt.validateRedirectUri(e.redirectUri),r.addScopes(e.scopes,!0,t.oidcDefaultScopes),r.addAuthorizationCode(e.code),r.addLibraryInfo(t.config.libraryInfo),r.addApplicationTelemetry(t.config.telemetry.application),r.addThrottling(),t.serverTelemetryManager&&!Fi(t.config)&&r.addServerTelemetry(t.serverTelemetryManager),e.codeVerifier&&r.addCodeVerifier(e.codeVerifier),t.config.clientCredentials.clientSecret&&r.addClientSecret(t.config.clientCredentials.clientSecret),t.config.clientCredentials.clientAssertion){var i=t.config.clientCredentials.clientAssertion;r.addClientAssertion(yield Ua(i.assertion,t.config.authOptions.clientId,e.resourceRequestUri)),r.addClientAssertionType(i.assertionType)}if(r.addGrantType("authorization_code"),r.addClientInfo(),e.authenticationScheme===F.POP){var a,o=new vt(t.cryptoUtils,t.performanceClient);a=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield E(o.generateCnf.bind(o),g.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,r.addPopToken(a)}else if(e.authenticationScheme===F.SSH){if(!e.sshJwk)throw $(tt);r.addSshJwk(e.sshJwk)}(!ge.isEmptyObj(e.claims)||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&r.addClaims(e.claims,t.config.authOptions.clientCapabilities);var c=void 0;if(e.clientInfo)try{var l=Sn(e.clientInfo,t.cryptoUtils.base64Decode);c={credential:`${l.uid}${re.CLIENT_INFO_SEPARATOR}${l.utid}`,type:"home_account_id"}}catch(h){t.logger.verbose("Could not parse client info for CCS Header: "+h)}else c=e.ccsCredential;if(t.config.systemOptions.preventCorsPreflight&&c)switch(c.type){case"home_account_id":try{var d=dt(c.credential);r.addCcsOid(d)}catch(h){t.logger.verbose("Could not parse home account ID for CCS Header: "+h)}break;case"UPN":r.addCcsUpn(c.credential)}return e.embeddedClientId&&r.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),e.tokenBodyParameters&&r.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[Na])&&r.addExtraQueryParameters({[Na]:"1"}),r.createQueryString()})()}createAuthCodeUrlQueryString(e){var t=this;return(0,v.A)(function*(){var r=e.correlationId||t.config.cryptoInterface.createNewGuid();t.performanceClient?.addQueueMeasurement(g.AuthClientCreateQueryString,r);var i=new tr(r,t.performanceClient);i.addClientId(e.embeddedClientId||e.extraQueryParameters?.[Je]||t.config.authOptions.clientId);var o=[...e.scopes||[],...e.extraScopesToConsent||[]];if(i.addScopes(o,!0,t.oidcDefaultScopes),i.addRedirectUri(e.redirectUri),i.addCorrelationId(r),i.addResponseMode(e.responseMode),i.addResponseTypeCode(),i.addLibraryInfo(t.config.libraryInfo),Fi(t.config)||i.addApplicationTelemetry(t.config.telemetry.application),i.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&i.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&i.addPrompt(e.prompt),e.domainHint&&i.addDomainHint(e.domainHint),e.prompt!==Z.SELECT_ACCOUNT)if(e.sid&&e.prompt===Z.NONE)t.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),i.addSid(e.sid);else if(e.account){var a=t.extractAccountSid(e.account),s=t.extractLoginHint(e.account);if(s&&e.domainHint&&(t.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),s=null),s){t.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),i.addLoginHint(s);try{var c=dt(e.account.homeAccountId);i.addCcsOid(c)}catch{t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(a&&e.prompt===Z.NONE){t.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),i.addSid(a);try{var l=dt(e.account.homeAccountId);i.addCcsOid(l)}catch{t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)t.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),i.addLoginHint(e.loginHint),i.addCcsUpn(e.loginHint);else if(e.account.username){t.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),i.addLoginHint(e.account.username);try{var d=dt(e.account.homeAccountId);i.addCcsOid(d)}catch{t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(t.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),i.addLoginHint(e.loginHint),i.addCcsUpn(e.loginHint));else t.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&i.addNonce(e.nonce),e.state&&i.addState(e.state),(e.claims||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&i.addClaims(e.claims,t.config.authOptions.clientCapabilities),e.embeddedClientId&&i.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),t.addExtraQueryParams(e,i),e.nativeBroker&&(i.addNativeBroker(),e.authenticationScheme===F.POP)){var u,h=new vt(t.cryptoUtils);u=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield E(h.generateCnf.bind(h),g.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,i.addPopToken(u)}return i.createQueryString()})()}createLogoutUrlQueryString(e){var t=new tr(e.correlationId,this.performanceClient);return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),this.addExtraQueryParams(e,t),t.createQueryString()}addExtraQueryParams(e,t){!(e.extraQueryParameters&&e.extraQueryParameters.hasOwnProperty("instance_aware"))&&this.config.authOptions.instanceAware&&(e.extraQueryParameters=e.extraQueryParameters||{},e.extraQueryParameters.instance_aware="true"),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters)}extractAccountSid(e){return e.idTokenClaims?.sid||null}extractLoginHint(e){return e.idTokenClaims?.login_hint||null}}class rr{constructor(e,t){this.cacheOutcome="0",this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||C.EMPTY_STRING,this.wrapperVer=e.wrapperVer||C.EMPTY_STRING,this.telemetryCacheKey=ee.CACHE_KEY+re.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){var e=`${this.apiId}${ee.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r?.length&&t.push(`broker_error=${r}`);var i=t.join(ee.VALUE_SEPARATOR),a=[e,this.getRegionDiscoveryFields()].join(ee.VALUE_SEPARATOR);return[ee.SCHEMA_VERSION,a,i].join(ee.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){var e=this.getLastRequests(),t=rr.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(ee.VALUE_SEPARATOR),i=e.errors.slice(0,t).join(ee.VALUE_SEPARATOR),o=e.errors.length,s=[o,t<o?ee.OVERFLOW_TRUE:ee.OVERFLOW_FALSE].join(ee.VALUE_SEPARATOR);return[ee.SCHEMA_VERSION,e.cacheHits,r,i,s].join(ee.CATEGORY_SEPARATOR)}cacheFailedRequest(e){var t=this.getLastRequests();t.errors.length>=ee.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?t.errors.push(e instanceof q?e.subError?e.subError:e.errorCode?e.errorCode:e.toString():e.toString()):t.errors.push(ee.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){var e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){var e=this.getLastRequests(),t=rr.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey);else{var i={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,i)}}static maxErrorsToSend(e){var t,r=0,i=0,o=e.errors.length;for(t=0;t<o;t++){var s=e.failedRequests[2*t+1]||C.EMPTY_STRING,c=e.errors[t]||C.EMPTY_STRING;if(!((i+=(e.failedRequests[2*t]||C.EMPTY_STRING).toString().length+s.toString().length+c.length+3)<ee.MAX_LAST_HEADER_BYTES))break;r+=1}return r}getRegionDiscoveryFields(){var e=[];return e.push(this.regionUsed||C.EMPTY_STRING),e.push(this.regionSource||C.EMPTY_STRING),e.push(this.regionOutcome||C.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){var t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){var e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e)}static makeExtraSkuString(e){return function(n){var{skus:e,libraryName:t,libraryVersion:r,extensionName:i,extensionVersion:o}=n,a=new Map([[0,[t,r]],[2,[i,o]]]),s=[];if(e?.length){if((s=e.split(",")).length<4)return e}else s=Array.from({length:4},()=>"|");return a.forEach((c,l)=>{2===c.length&&c[0]?.length&&c[1]?.length&&function(n){var{skuArr:e,index:t,skuName:r,skuVersion:i}=n;t>=e.length||(e[t]=[r,i].join("|"))}({skuArr:s,index:l,skuName:c[0],skuVersion:c[1]})}),s.join(",")}(e)}}class xa{constructor(e,t,r,i,o,a,s,c,l){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=a,this.nativeMessageHandler=c,this.correlationId=l||ke(),this.logger=i.clone(ce.MSAL_SKU,bn,this.correlationId),this.performanceClient=s}clearCacheOnLogout(e){var t=this;return(0,v.A)(function*(){if(e){J.accountInfoIsEqual(e,t.browserStorage.getActiveAccount(),!1)&&(t.logger.verbose("Setting active account to null"),t.browserStorage.setActiveAccount(null));try{yield t.browserStorage.removeAccount(J.generateAccountCacheKey(e)),t.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{t.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{t.logger.verbose("No account provided in logout request, clearing all cache items.",t.correlationId),yield t.browserStorage.clear(),yield t.browserCrypto.clearKeystore()}catch{t.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}})()}getRedirectUri(e){return this.logger.verbose("getRedirectUri called"),x.getAbsoluteUrl(e||this.config.auth.redirectUri,Pe())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");var r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new rr(r,this.browserStorage)}getDiscoveredAuthority(e){var t=this;return(0,v.A)(function*(){var{account:r}=e,i=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;t.performanceClient.addQueueMeasurement(g.StandardInteractionClientGetDiscoveredAuthority,t.correlationId);var o={protocolMode:t.config.auth.protocolMode,OIDCOptions:t.config.auth.OIDCOptions,knownAuthorities:t.config.auth.knownAuthorities,cloudDiscoveryMetadata:t.config.auth.cloudDiscoveryMetadata,authorityMetadata:t.config.auth.authorityMetadata,skipAuthorityMetadataCache:t.config.auth.skipAuthorityMetadataCache},a=e.requestAuthority||t.config.auth.authority,c=r&&(i?.length?"true"===i:t.config.auth.instanceAware)?t.config.auth.authority.replace(x.getDomainFromUrl(a),r.environment):a,l=ne.generateAuthority(c,e.requestAzureCloudOptions||t.config.auth.azureCloudOptions),d=yield E(Ma,g.AuthorityFactoryCreateDiscoveredInstance,t.logger,t.performanceClient,t.correlationId)(l,t.config.system.networkClient,t.browserStorage,o,t.logger,t.correlationId,t.performanceClient);if(r&&!d.isAlias(r.environment))throw $(_r);return d})()}}var od=32;function ad(n,e,t){return ro.apply(this,arguments)}function ro(){return ro=(0,v.A)(function*(n,e,t){n.addQueueMeasurement(g.GeneratePkceCodes,t);var r=je(sd,g.GenerateCodeVerifier,e,n,t)(n,e,t);return{verifier:r,challenge:yield E(cd,g.GenerateCodeChallengeFromVerifier,e,n,t)(r,n,e,t)}}),ro.apply(this,arguments)}function sd(n,e,t){try{var r=new Uint8Array(od);return je(ks,g.GetRandomValues,e,n,t)(r),mn(r)}catch{throw R(Bt)}}function cd(n,e,t,r){return no.apply(this,arguments)}function no(){return no=(0,v.A)(function*(n,e,t,r){e.addQueueMeasurement(g.GenerateCodeChallengeFromVerifier,r);try{var i=yield E(Bo,g.Sha256Digest,t,e,r)(n,e,r);return mn(new Uint8Array(i))}catch{throw R(Bt)}}),no.apply(this,arguments)}function io(n,e,t,r){return oo.apply(this,arguments)}function oo(){return oo=(0,v.A)(function*(n,e,t,r){t.addQueueMeasurement(g.InitializeBaseRequest,n.correlationId);var i=n.authority||e.auth.authority,o=[...n&&n.scopes||[]],a={...n,correlationId:n.correlationId,authority:i,scopes:o};if(a.authenticationScheme){if(a.authenticationScheme===F.SSH){if(!n.sshJwk)throw $(tt);if(!n.sshKid)throw $(Ir)}r.verbose(`Authentication Scheme set to "${a.authenticationScheme}" as configured in Auth request`)}else a.authenticationScheme=F.BEARER,r.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return e.cache.claimsBasedCachingEnabled&&n.claims&&!ge.isEmptyObj(n.claims)&&(a.requestedClaimsHash=yield Fo(n.claims)),a}),oo.apply(this,arguments)}function ld(n,e,t,r,i){return ao.apply(this,arguments)}function ao(){return ao=(0,v.A)(function*(n,e,t,r,i){r.addQueueMeasurement(g.InitializeSilentRequest,n.correlationId);var o=yield E(io,g.InitializeBaseRequest,i,r,n.correlationId)(n,t,r,i);return{...n,...o,account:e,forceRefresh:n.forceRefresh||!1}}),ao.apply(this,arguments)}class Ct extends xa{initializeAuthorizationCodeRequest(e){var t=this;return(0,v.A)(function*(){t.performanceClient.addQueueMeasurement(g.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId);var r=yield E(ad,g.GeneratePkceCodes,t.logger,t.performanceClient,t.correlationId)(t.performanceClient,t.logger,t.correlationId),i={...e,redirectUri:e.redirectUri,code:C.EMPTY_STRING,codeVerifier:r.verifier};return e.codeChallenge=r.challenge,e.codeChallengeMethod=C.S256_CODE_CHALLENGE_METHOD,i})()}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);var t={correlationId:this.correlationId||ke(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){var r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=x.getAbsoluteUrl(e.postLogoutRedirectUri,Pe())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=x.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,Pe())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=x.getAbsoluteUrl(Pe(),Pe())),t}getLogoutHintFromIdTokenClaims(e){var t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}createAuthCodeClient(e){var t=this;return(0,v.A)(function*(){t.performanceClient.addQueueMeasurement(g.StandardInteractionClientCreateAuthCodeClient,t.correlationId);var r=yield E(t.getClientConfiguration.bind(t),g.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,t.correlationId)(e);return new Da(r,t.performanceClient)})()}getClientConfiguration(e){var t=this;return(0,v.A)(function*(){var{serverTelemetryManager:r,requestAuthority:i,requestAzureCloudOptions:o,requestExtraQueryParameters:a,account:s}=e;t.performanceClient.addQueueMeasurement(g.StandardInteractionClientGetClientConfiguration,t.correlationId);var c=yield E(t.getDiscoveredAuthority.bind(t),g.StandardInteractionClientGetDiscoveredAuthority,t.logger,t.performanceClient,t.correlationId)({requestAuthority:i,requestAzureCloudOptions:o,requestExtraQueryParameters:a,account:s}),l=t.config.system.loggerOptions;return{authOptions:{clientId:t.config.auth.clientId,authority:c,clientCapabilities:t.config.auth.clientCapabilities,redirectUri:t.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:t.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:l.loggerCallback,piiLoggingEnabled:l.piiLoggingEnabled,logLevel:l.logLevel,correlationId:t.correlationId},cacheOptions:{claimsBasedCachingEnabled:t.config.cache.claimsBasedCachingEnabled},cryptoInterface:t.browserCrypto,networkInterface:t.networkClient,storageInterface:t.browserStorage,serverTelemetryManager:r,libraryInfo:{sku:ce.MSAL_SKU,version:bn,cpu:C.EMPTY_STRING,os:C.EMPTY_STRING},telemetry:t.config.telemetry}})()}initializeAuthorizationRequest(e,t){var r=this;return(0,v.A)(function*(){r.performanceClient.addQueueMeasurement(g.StandardInteractionClientInitializeAuthorizationRequest,r.correlationId);var i=r.getRedirectUri(e.redirectUri),a=ve.setRequestState(r.browserCrypto,e&&e.state||C.EMPTY_STRING,{interactionType:t}),c={...yield E(io,g.InitializeBaseRequest,r.logger,r.performanceClient,r.correlationId)({...e,correlationId:r.correlationId},r.config,r.performanceClient,r.logger),redirectUri:i,state:a,nonce:e.nonce||ke(),responseMode:r.config.auth.OIDCOptions.serverResponseType};if(e.loginHint||e.sid)return c;var l=e.account||r.browserStorage.getActiveAccount();if(l&&(r.logger.verbose("Setting validated request account",r.correlationId),r.logger.verbosePii(`Setting validated request account: ${l.homeAccountId}`,r.correlationId),c.account=l),!c.loginHint&&!l){var d=r.browserStorage.getLegacyLoginHint();d&&(c.loginHint=d)}return c})()}}var Ka="user_switch",Cd={[Ka]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class Ee extends q{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,Ee.prototype),this.name="NativeAuthError",this.ext=r}}function yt(n){return!!(n.ext&&n.ext.status&&("PERSISTENT_ERROR"===n.ext.status||"DISABLED"===n.ext.status)||n.ext&&n.ext.error&&-2147186943===n.ext.error)||"ContentError"===n.errorCode}function so(n,e,t){if(t&&t.status)switch(t.status){case"ACCOUNT_UNAVAILABLE":return Vi(Pn);case"USER_INTERACTION_REQUIRED":return new he(n,e);case"USER_CANCEL":return R(ye);case"NO_NETWORK":return R(at)}return new Ee(n,Cd[n]||e,t)}class co extends Zi{constructor(e,t){super(e,t)}acquireToken(e){var t=this;return(0,v.A)(function*(){t.performanceClient?.addQueueMeasurement(g.RefreshTokenClientAcquireToken,e.correlationId);var r=Te(),i=yield E(t.executeTokenRequest.bind(t),g.RefreshTokenClientExecuteTokenRequest,t.logger,t.performanceClient,e.correlationId)(e,t.authority),o=i.headers?.["x-ms-request-id"],a=new Xe(t.config.authOptions.clientId,t.cacheManager,t.cryptoUtils,t.logger,t.config.serializableCache,t.config.persistencePlugin);return a.validateTokenResponse(i.body),E(a.handleServerTokenResponse.bind(a),g.HandleServerTokenResponse,t.logger,t.performanceClient,e.correlationId)(i.body,t.authority,r,e,void 0,void 0,!0,e.forceCache,o)})()}acquireTokenByRefreshToken(e){var t=this;return(0,v.A)(function*(){if(!e)throw $(Cr);if(t.performanceClient?.addQueueMeasurement(g.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw T(Ut);if(t.cacheManager.isAppMetadataFOCI(e.account.environment))try{return yield E(t.acquireTokenWithCachedRefreshToken.bind(t),g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.logger,t.performanceClient,e.correlationId)(e,!0)}catch(a){if(a instanceof he&&a.errorCode===ft||a instanceof Ge&&"invalid_grant"===a.errorCode&&"client_mismatch"===a.subError)return E(t.acquireTokenWithCachedRefreshToken.bind(t),g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.logger,t.performanceClient,e.correlationId)(e,!1);throw a}return E(t.acquireTokenWithCachedRefreshToken.bind(t),g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.logger,t.performanceClient,e.correlationId)(e,!1)})()}acquireTokenWithCachedRefreshToken(e,t){var r=this;return(0,v.A)(function*(){r.performanceClient?.addQueueMeasurement(g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);var i=je(r.cacheManager.getRefreshToken.bind(r.cacheManager),g.CacheManagerGetRefreshToken,r.logger,r.performanceClient,e.correlationId)(e.account,t,void 0,r.performanceClient,e.correlationId);if(!i)throw Vi(ft);if(i.expiresOn&&Mi(i.expiresOn,e.refreshTokenExpirationOffsetSeconds||300))throw Vi(Qi);var o={...e,refreshToken:i.secret,authenticationScheme:e.authenticationScheme||F.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:"home_account_id"}};try{return yield E(r.acquireToken.bind(r),g.RefreshTokenClientAcquireToken,r.logger,r.performanceClient,e.correlationId)(o)}catch(s){if(s instanceof he&&s.subError===mt){r.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");var a=lt(i);r.cacheManager.removeRefreshToken(a)}throw s}})()}executeTokenRequest(e,t){var r=this;return(0,v.A)(function*(){r.performanceClient?.addQueueMeasurement(g.RefreshTokenClientExecuteTokenRequest,e.correlationId);var i=r.createTokenQueryParameters(e),o=x.appendQueryString(t.tokenEndpoint,i),a=yield E(r.createTokenRequestBody.bind(r),g.RefreshTokenClientCreateTokenRequestBody,r.logger,r.performanceClient,e.correlationId)(e),s=r.createTokenRequestHeaders(e.ccsCredential),c={clientId:e.tokenBodyParameters?.clientId||r.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return E(r.executePostToTokenEndpoint.bind(r),g.RefreshTokenClientExecutePostToTokenEndpoint,r.logger,r.performanceClient,e.correlationId)(o,a,s,c,e.correlationId,g.RefreshTokenClientExecutePostToTokenEndpoint)})()}createTokenRequestBody(e){var t=this;return(0,v.A)(function*(){t.performanceClient?.addQueueMeasurement(g.RefreshTokenClientCreateTokenRequestBody,e.correlationId);var i=new tr(e.correlationId,t.performanceClient);if(i.addClientId(e.embeddedClientId||e.tokenBodyParameters?.[Je]||t.config.authOptions.clientId),e.redirectUri&&i.addRedirectUri(e.redirectUri),i.addScopes(e.scopes,!0,t.config.authOptions.authority.options.OIDCOptions?.defaultScopes),i.addGrantType("refresh_token"),i.addClientInfo(),i.addLibraryInfo(t.config.libraryInfo),i.addApplicationTelemetry(t.config.telemetry.application),i.addThrottling(),t.serverTelemetryManager&&!Fi(t.config)&&i.addServerTelemetry(t.serverTelemetryManager),i.addRefreshToken(e.refreshToken),t.config.clientCredentials.clientSecret&&i.addClientSecret(t.config.clientCredentials.clientSecret),t.config.clientCredentials.clientAssertion){var o=t.config.clientCredentials.clientAssertion;i.addClientAssertion(yield Ua(o.assertion,t.config.authOptions.clientId,e.resourceRequestUri)),i.addClientAssertionType(o.assertionType)}if(e.authenticationScheme===F.POP){var s,a=new vt(t.cryptoUtils,t.performanceClient);s=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield E(a.generateCnf.bind(a),g.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,i.addPopToken(s)}else if(e.authenticationScheme===F.SSH){if(!e.sshJwk)throw $(tt);i.addSshJwk(e.sshJwk)}if((!ge.isEmptyObj(e.claims)||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&i.addClaims(e.claims,t.config.authOptions.clientCapabilities),t.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case"home_account_id":try{var l=dt(e.ccsCredential.credential);i.addCcsOid(l)}catch(d){t.logger.verbose("Could not parse home account ID for CCS Header: "+d)}break;case"UPN":i.addCcsUpn(e.ccsCredential.credential)}return e.embeddedClientId&&i.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),e.tokenBodyParameters&&i.addExtraQueryParameters(e.tokenBodyParameters),i.createQueryString()})()}}class Ad extends Zi{constructor(e,t){super(e,t)}acquireToken(e){var t=this;return(0,v.A)(function*(){try{var[r,i]=yield t.acquireCachedToken({...e,scopes:e.scopes?.length?e.scopes:[...Ze]});return"4"===i&&(t.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),new co(t.config,t.performanceClient).acquireTokenByRefreshToken(e).catch(()=>{})),r}catch(s){if(s instanceof Gr&&s.errorCode===me)return new co(t.config,t.performanceClient).acquireTokenByRefreshToken(e);throw s}})()}acquireCachedToken(e){var t=this;return(0,v.A)(function*(){t.performanceClient?.addQueueMeasurement(g.SilentFlowClientAcquireCachedToken,e.correlationId);var r="0";if(e.forceRefresh||!t.config.cacheOptions.claimsBasedCachingEnabled&&!ge.isEmptyObj(e.claims))throw t.setCacheOutcome("1",e.correlationId),T(me);if(!e.account)throw T(Ut);var i=e.account.tenantId||function(n){var t=new x(n).getUrlComponents(),r=t.PathSegments.slice(-1)[0]?.toLowerCase();switch(r){case"common":case"organizations":case"consumers":return;default:return r}}(e.authority),o=t.cacheManager.getTokenKeys(),a=t.cacheManager.getAccessToken(e.account,e,o,i,t.performanceClient,e.correlationId);if(!a)throw t.setCacheOutcome("2",e.correlationId),T(me);if(function(n){return Number(n)>Te()}(a.cachedAt)||Mi(a.expiresOn,t.config.systemOptions.tokenRenewalOffsetSeconds))throw t.setCacheOutcome("3",e.correlationId),T(me);a.refreshOn&&Mi(a.refreshOn,0)&&(r="4");var s=e.authority||t.authority.getPreferredCache(),c={account:t.cacheManager.readAccountFromCache(e.account),accessToken:a,idToken:t.cacheManager.getIdToken(e.account,o,i,t.performanceClient,e.correlationId),refreshToken:null,appMetadata:t.cacheManager.readAppMetadataFromCache(s)};return t.setCacheOutcome(r,e.correlationId),t.config.serverTelemetryManager&&t.config.serverTelemetryManager.incrementCacheHits(),[yield E(t.generateResultFromCacheRecord.bind(t),g.SilentFlowClientGenerateResultFromCacheRecord,t.logger,t.performanceClient,e.correlationId)(c,e),r]})()}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),"0"!==e&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}generateResultFromCacheRecord(e,t){var r=this;return(0,v.A)(function*(){var i;if(r.performanceClient?.addQueueMeasurement(g.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId),e.idToken&&(i=Ve(e.idToken.secret,r.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){var o=i?.auth_time;if(!o)throw T(Nt);ra(o,t.maxAge)}return Xe.generateAuthenticationResult(r.cryptoUtils,r.authority,e,!0,t,i)})()}}class Ba extends Ct{acquireToken(e){var t=this;return(0,v.A)(function*(){t.performanceClient.addQueueMeasurement(g.SilentCacheClientAcquireToken,e.correlationId);var r=t.initializeServerTelemetryManager(61),i=yield E(t.getClientConfiguration.bind(t),g.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:r,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),o=new Ad(i,t.performanceClient);t.logger.verbose("Silent auth client created");try{var s=(yield E(o.acquireCachedToken.bind(o),g.SilentFlowClientAcquireCachedToken,t.logger,t.performanceClient,e.correlationId)(e))[0];return t.performanceClient.addFields({fromCache:!0},e.correlationId),s}catch(c){throw c instanceof Xt&&c.errorCode===jt&&t.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),c}})()}logout(e){this.logger.verbose("logoutRedirect called");var t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t?.account)}}class At extends xa{constructor(e,t,r,i,o,a,s,c,l,d,h,u){super(e,t,r,i,o,a,c,l,u),this.apiId=s,this.accountId=d,this.nativeMessageHandler=l,this.nativeStorageManager=h,this.silentCacheClient=new Ba(e,this.nativeStorageManager,r,i,o,a,c,l,u),this.serverTelemetryManager=this.initializeServerTelemetryManager(this.apiId);var f="ppnbnpeolgkicgegkbkbjmhlideopiji"===this.nativeMessageHandler.getExtensionId()?"chrome":this.nativeMessageHandler.getExtensionId()?.length?"unknown":void 0;this.skus=rr.makeExtraSkuString({libraryName:ce.MSAL_SKU,libraryVersion:bn,extensionName:f,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[Xl]:this.skus}}acquireToken(e){var t=this;return(0,v.A)(function*(){t.performanceClient.addQueueMeasurement(g.NativeInteractionClientAcquireToken,e.correlationId),t.logger.trace("NativeInteractionClient - acquireToken called.");var r=t.performanceClient.startMeasurement(g.NativeInteractionClientAcquireToken,e.correlationId),i=Te();try{var o=yield t.initializeNativeRequest(e);try{var a=yield t.acquireTokensFromCache(t.accountId,o);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),a}catch{t.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}var{...s}=o,c={method:"GetToken",request:s},l=yield t.nativeMessageHandler.sendMessage(c),d=t.validateNativeResponse(l);return yield t.handleNativeResponse(d,o,i).then(h=>(r.end({success:!0,isNativeBroker:!0,requestId:h.requestId}),t.serverTelemetryManager.clearNativeBrokerErrorCode(),h)).catch(h=>{throw r.end({success:!1,errorCode:h.errorCode,subErrorCode:h.subError,isNativeBroker:!0}),h})}catch(h){throw h instanceof Ee&&t.serverTelemetryManager.setNativeBrokerErrorCode(h.errorCode),h}})()}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:j.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}acquireTokensFromCache(e,t){var r=this;return(0,v.A)(function*(){if(!e)throw r.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),T(Lt);var i=r.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!i)throw T(Lt);try{var o=r.createSilentCacheRequest(t,i),a=yield r.silentCacheClient.acquireToken(o),s={...i,idTokenClaims:a?.idTokenClaims,idToken:a?.idToken};return{...a,account:s}}catch(c){throw c}})()}acquireTokenRedirect(e,t){var r=this;return(0,v.A)(function*(){r.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");var{...i}=e;delete i.onRedirectNavigate;var o=yield r.initializeNativeRequest(i),a={method:"GetToken",request:o};try{var s=yield r.nativeMessageHandler.sendMessage(a);r.validateNativeResponse(s)}catch(d){if(d instanceof Ee&&(r.serverTelemetryManager.setNativeBrokerErrorCode(d.errorCode),yt(d)))throw d}r.browserStorage.setTemporaryCache("request.native",JSON.stringify(o),!0);var c={apiId:861,timeout:r.config.system.redirectNavigationTimeout,noHistory:!1},l=r.config.auth.navigateToLoginRequestUrl?window.location.href:r.getRedirectUri(e.redirectUri);t.end({success:!0}),yield r.navigationClient.navigateExternal(l,c)})()}handleRedirectPromise(e,t){var r=this;return(0,v.A)(function*(){if(r.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!r.browserStorage.isInteractionInProgress(!0))return r.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;var i=r.browserStorage.getCachedNativeRequest();if(!i)return r.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;var{prompt:o,...a}=i;o&&r.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),r.browserStorage.removeItem(r.browserStorage.generateCacheKey("request.native"));var s={method:"GetToken",request:a},c=Te();try{r.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");var l=yield r.nativeMessageHandler.sendMessage(s);r.validateNativeResponse(l);var d=r.handleNativeResponse(l,a,c);r.browserStorage.setInteractionInProgress(!1);var h=yield d;return r.serverTelemetryManager.clearNativeBrokerErrorCode(),h}catch(u){throw r.browserStorage.setInteractionInProgress(!1),u}})()}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}handleNativeResponse(e,t,r){var i=this;return(0,v.A)(function*(){i.logger.trace("NativeInteractionClient - handleNativeResponse called.");var o=Ve(e.id_token,Ie),a=i.createHomeAccountIdentifier(e,o),s=i.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId})?.homeAccountId;if(a!==s&&e.account.id!==t.accountId)throw so(Ka);var c=yield i.getDiscoveredAuthority({requestAuthority:t.authority}),l=eo(i.browserStorage,c,a,Ie,o,e.client_info,void 0,o.tid,void 0,e.account.id,i.logger),d=yield i.generateAuthenticationResult(e,t,o,l,c.canonicalAuthority,r);return i.cacheAccount(l),i.cacheNativeTokens(e,t,a,o,e.access_token,d.tenantId,r),d})()}createHomeAccountIdentifier(e,t){return J.generateHomeAccountId(e.client_info||C.EMPTY_STRING,0,this.logger,this.browserCrypto,t)}generateScopes(e,t){return j.fromString(e.scope?e.scope:t.scope)}generatePopAccessToken(e,t){var r=this;return(0,v.A)(function*(){if(t.tokenType===F.POP&&t.signPopToken){if(e.shr)return r.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;var i=new vt(r.browserCrypto),o={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw T(Kt);return i.signPopToken(e.access_token,t.keyId,o)}return e.access_token})()}generateAuthenticationResult(e,t,r,i,o,a){var s=this;return(0,v.A)(function*(){var c=s.addTelemetryFromNativeResponse(e),l=j.fromString(e.scope?e.scope:t.scope),d=e.account.properties||{},h=d.UID||r.oid||r.sub||C.EMPTY_STRING,u=d.TenantId||r.tid||C.EMPTY_STRING,f=Hi(i.getAccountInfo(),void 0,r,e.id_token);f.nativeAccountId!==e.account.id&&(f.nativeAccountId=e.account.id);var p=yield s.generatePopAccessToken(e,t),m=t.tokenType===F.POP?F.POP:F.BEARER;return{authority:o,uniqueId:h,tenantId:u,scopes:l.asArray(),account:f,idToken:e.id_token,idTokenClaims:r,accessToken:p,fromCache:!!c&&s.isResponseFromCache(c),expiresOn:new Date(1e3*Number(a+e.expires_in)),tokenType:m,correlationId:s.correlationId,state:e.state,fromNativeBroker:!0}})()}cacheAccount(e){this.browserStorage.setAccount(e),this.browserStorage.removeAccountContext(e).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,r,i,o,a,s){var c=An(r,t.authority,e.id_token||"",t.clientId,i.tid||""),d=s+(t.tokenType===F.POP?C.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),h=this.generateScopes(e,t),u=Tn(r,t.authority,o,t.clientId,i.tid||a,h.printScopes(),d,0,Ie,void 0,t.tokenType,void 0,t.keyId);this.nativeStorageManager.saveCacheRecord({idToken:c,accessToken:u},t.storeInCache)}addTelemetryFromNativeResponse(e){var t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw ko(Et,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}initializeNativeRequest(e){var t=this;return(0,v.A)(function*(){t.logger.trace("NativeInteractionClient - initializeNativeRequest called");var r=e.authority||t.config.auth.authority;e.account&&(yield t.getDiscoveredAuthority({requestAuthority:r,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}));var i=new x(r);i.validateAsUri();var{scopes:o,...a}=e,s=new j(o||[]);s.appendScopes(Ze);var l={...a,accountId:t.accountId,clientId:t.config.auth.clientId,authority:i.urlString,scope:s.printScopes(),redirectUri:t.getRedirectUri(e.redirectUri),prompt:(()=>{switch(t.apiId){case 863:case 61:return t.logger.trace("initializeNativeRequest: silent request sets prompt to none"),Z.NONE}if(e.prompt)switch(e.prompt){case Z.NONE:case Z.CONSENT:case Z.LOGIN:return t.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw t.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),R(dn)}else t.logger.trace("initializeNativeRequest: prompt was not provided")})(),correlationId:t.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(l.signPopToken&&e.popKid)throw R(hn);if(t.handleExtraBrokerParams(l),l.extraParameters=l.extraParameters||{},l.extraParameters.telemetry="MATS",e.authenticationScheme===F.POP){var u,d={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},h=new vt(t.browserCrypto);if(l.keyId)u=t.browserCrypto.base64UrlEncode(JSON.stringify({kid:l.keyId})),l.signPopToken=!1;else{var f=yield E(h.generateCnf.bind(h),g.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(d,t.logger);u=f.reqCnfString,l.keyId=f.kid,l.signPopToken=!0}l.reqCnf=u}return t.addRequestSKUs(l),l})()}handleExtraBrokerParams(e){var t=e.extraParameters&&e.extraParameters.hasOwnProperty(ji)&&e.extraParameters.hasOwnProperty(Ji)&&e.extraParameters.hasOwnProperty(Je);if(e.embeddedClientId||t){var r="",i=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[Ji],r=e.extraParameters[Je]),e.extraParameters={child_client_id:r,child_redirect_uri:i},this.performanceClient?.addFields({embeddedClientId:r,embeddedRedirectUri:i},e.correlationId)}}}class _e{constructor(e,t,r,i){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=i,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(g.NativeMessageHandlerHandshake)}sendMessage(e){var t=this;return(0,v.A)(function*(){t.logger.trace("NativeMessageHandler - sendMessage called.");var r={channel:st_CHANNEL_ID,extensionId:t.extensionId,responseId:ke(),body:e};return t.logger.trace("NativeMessageHandler - Sending request to browser extension"),t.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(r)}`),t.messageChannel.port1.postMessage(r),new Promise((i,o)=>{t.resolvers.set(r.responseId,{resolve:i,reject:o})})})()}static createProvider(e,t,r){return(0,v.A)(function*(){e.trace("NativeMessageHandler - createProvider called.");try{var i=new _e(e,t,r,"ppnbnpeolgkicgegkbkbjmhlideopiji");return yield i.sendHandshakeRequest(),i}catch{var o=new _e(e,t,r);return yield o.sendHandshakeRequest(),o}})()}sendHandshakeRequest(){var e=this;return(0,v.A)(function*(){e.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",e.windowListener,!1);var t={channel:st_CHANNEL_ID,extensionId:e.extensionId,responseId:ke(),body:{method:"Handshake"}};return e.handshakeEvent.add({extensionId:e.extensionId,extensionHandshakeTimeoutMs:e.handshakeTimeoutMs}),e.messageChannel.port1.onmessage=r=>{e.onChannelMessage(r)},window.postMessage(t,window.origin,[e.messageChannel.port2]),new Promise((r,i)=>{e.handshakeResolvers.set(t.responseId,{resolve:r,reject:i}),e.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",e.windowListener,!1),e.messageChannel.port1.close(),e.messageChannel.port2.close(),e.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),i(R(sn)),e.handshakeResolvers.delete(t.responseId)},e.handshakeTimeoutMs)})})()}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source===window){var t=e.data;if(t.channel&&t.channel===st_CHANNEL_ID&&(!t.extensionId||t.extensionId===this.extensionId)&&"Handshake"===t.body.method){var r=this.handshakeResolvers.get(t.responseId);if(!r)return void this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),r.reject(R(cn))}}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");var t=e.data,r=this.resolvers.get(t.responseId),i=this.handshakeResolvers.get(t.responseId);try{var o=t.body.method;if("Response"===o){if(!r)return;var a=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(a)}`),"Success"!==a.status)r.reject(so(a.code,a.description,a.ext));else{if(!a.result)throw ko(Et,"Event does not contain result.");a.result.code&&a.result.description?r.reject(so(a.result.code,a.result.description,a.result.ext)):r.resolve(a.result)}this.resolvers.delete(t.responseId)}else if("HandshakeResponse"===o){if(!i)return void this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(s){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${s}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(s):i&&i.reject(s)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,r,i){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!r)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(i)switch(i){case F.BEARER:case F.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}class lo{constructor(e,t,r,i,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=o}handleCodeResponse(e,t){var r=this;return(0,v.A)(function*(){var i;r.performanceClient.addQueueMeasurement(g.HandleCodeResponse,t.correlationId);try{i=r.authModule.handleFragmentResponse(e,t.state)}catch(o){throw o instanceof Ge&&o.subError===ye?R(ye):o}return E(r.handleCodeResponseFromServer.bind(r),g.HandleCodeResponseFromServer,r.logger,r.performanceClient,t.correlationId)(i,t)})()}handleCodeResponseFromServer(e,t,r=!0){var i=this;return(0,v.A)(function*(){if(i.performanceClient.addQueueMeasurement(g.HandleCodeResponseFromServer,t.correlationId),i.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),i.authCodeRequest.code=e.code,e.cloud_instance_host_name&&(yield E(i.authModule.updateAuthority.bind(i.authModule),g.UpdateTokenEndpointAuthority,i.logger,i.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId)),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)i.authCodeRequest.clientInfo=e.client_info;else{var o=i.createCcsCredentials(t);o&&(i.authCodeRequest.ccsCredential=o)}return yield E(i.authModule.acquireToken.bind(i.authModule),g.AuthClientAcquireToken,i.logger,i.performanceClient,t.correlationId)(i.authCodeRequest,e)})()}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:"home_account_id"}:e.loginHint?{credential:e.loginHint,type:"UPN"}:null}}function Fa(n,e,t){var r=$r(n);if(!r)throw Po(n)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${n}`),R(zr)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),R(qr));return r}class Id extends Ct{constructor(e,t,r,i,o,a,s,c,l,d){super(e,t,r,i,o,a,s,l,d),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=c}acquireToken(e){try{var r={popupName:this.generatePopupName(e.scopes||Ze,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(e,r))}catch(i){return Promise.reject(i)}}logout(e){try{this.logger.verbose("logoutPopup called");var t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},i=e&&e.authority,o=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,i,o)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,i,o))}catch(a){return Promise.reject(a)}}acquireTokenPopupAsync(e,t){var r=this;return(0,v.A)(function*(){r.logger.verbose("acquireTokenPopupAsync called");var i=r.initializeServerTelemetryManager(862),o=yield E(r.initializeAuthorizationRequest.bind(r),g.StandardInteractionClientInitializeAuthorizationRequest,r.logger,r.performanceClient,r.correlationId)(e,b.Popup);zo(o.authority);try{var l,a=yield E(r.initializeAuthorizationCodeRequest.bind(r),g.StandardInteractionClientInitializeAuthorizationCodeRequest,r.logger,r.performanceClient,r.correlationId)(o),s=yield E(r.createAuthCodeClient.bind(r),g.StandardInteractionClientCreateAuthCodeClient,r.logger,r.performanceClient,r.correlationId)({serverTelemetryManager:i,requestAuthority:o.authority,requestAzureCloudOptions:o.azureCloudOptions,requestExtraQueryParameters:o.extraQueryParameters,account:o.account}),c=_e.isNativeAvailable(r.config,r.logger,r.nativeMessageHandler,e.authenticationScheme);c&&(l=r.performanceClient.startMeasurement(g.FetchAccountIdWithNativeBroker,e.correlationId));var d=yield s.getAuthCodeUrl({...o,nativeBroker:c}),h=new lo(s,r.browserStorage,a,r.logger,r.performanceClient),u=r.initiateAuthRequest(d,t);r.eventHandler.emitEvent("msal:popupOpened",b.Popup,{popupWindow:u},null);var f=yield r.monitorPopupForHash(u,t.popupWindowParent),p=je(Fa,g.DeserializeResponse,r.logger,r.performanceClient,r.correlationId)(f,r.config.auth.OIDCOptions.serverResponseType,r.logger);if(Se.removeThrottle(r.browserStorage,r.config.auth.clientId,a),p.accountId){if(r.logger.verbose("Account id found in hash, calling WAM for token"),l&&l.end({success:!0,isNativeBroker:!0}),!r.nativeMessageHandler)throw R(ze);var m=new At(r.config,r.browserStorage,r.browserCrypto,r.logger,r.eventHandler,r.navigationClient,862,r.performanceClient,r.nativeMessageHandler,p.accountId,r.nativeStorage,o.correlationId),{userRequestState:A}=ve.parseRequestState(r.browserCrypto,o.state);return yield m.acquireToken({...o,state:A,prompt:void 0})}return yield h.handleCodeResponse(p,o)}catch(_){throw t.popup?.close(),_ instanceof q&&(_.setCorrelationId(r.correlationId),i.cacheFailedRequest(_)),_}})()}logoutPopupAsync(e,t,r,i){var o=this;return(0,v.A)(function*(){o.logger.verbose("logoutPopupAsync called"),o.eventHandler.emitEvent("msal:logoutStart",b.Popup,e);var a=o.initializeServerTelemetryManager(962);try{yield o.clearCacheOnLogout(e.account);var d=(yield E(o.createAuthCodeClient.bind(o),g.StandardInteractionClientCreateAuthCodeClient,o.logger,o.performanceClient,o.correlationId)({serverTelemetryManager:a,requestAuthority:r,account:e.account||void 0})).getLogoutUri(e);o.eventHandler.emitEvent("msal:logoutSuccess",b.Popup,e);var h=o.openPopup(d,t);if(o.eventHandler.emitEvent("msal:popupOpened",b.Popup,{popupWindow:h},null),yield o.monitorPopupForHash(h,t.popupWindowParent).catch(()=>{}),i){var u={apiId:962,timeout:o.config.system.redirectNavigationTimeout,noHistory:!1},f=x.getAbsoluteUrl(i,Pe());o.logger.verbose("Redirecting main window to url specified in the request"),o.logger.verbosePii(`Redirecting main window to: ${f}`),yield o.navigationClient.navigateInternal(f,u)}else o.logger.verbose("No main window navigation requested")}catch(p){throw t.popup?.close(),p instanceof q&&(p.setCorrelationId(o.correlationId),a.cacheFailedRequest(p)),o.browserStorage.setInteractionInProgress(!1),o.eventHandler.emitEvent("msal:logoutFailure",b.Popup,null,p),o.eventHandler.emitEvent("msal:logoutEnd",b.Popup),p}o.eventHandler.emitEvent("msal:logoutEnd",b.Popup)})()}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),R(nt)}monitorPopupForHash(e,t){return new Promise((r,i)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");var o=setInterval(()=>{if(e.closed)return this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(o),void i(R(ye));var a="";try{a=e.location.href}catch{}if(a&&"about:blank"!==a){clearInterval(o);var s="";e&&(s=this.config.auth.OIDCOptions.serverResponseType===Tt.QUERY?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),r(s)}},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{var r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t)),!r)throw R(Yr);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(i){throw this.logger.error("error opening popup "+i.message),this.browserStorage.setInteractionInProgress(!1),R(Vr)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:i}){var o=i.screenLeft?i.screenLeft:i.screenX,a=i.screenTop?i.screenTop:i.screenY,s=i.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=i.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,l=r.popupSize?.width,d=r.popupSize?.height,h=r.popupPosition?.top,u=r.popupPosition?.left;return(!l||l<0||l>s)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),l=ce.POPUP_WIDTH),(!d||d<0||d>c)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),d=ce.POPUP_HEIGHT),(!h||h<0||h>c)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),h=Math.max(0,c/2-ce.POPUP_HEIGHT/2+a)),(!u||u<0||u>s)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),u=Math.max(0,s/2-ce.POPUP_WIDTH/2+o)),i.open(e,t,`width=${l}, height=${d}, top=${h}, left=${u}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(b.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${ce.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){return`${ce.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.account&&e.account.homeAccountId}.${this.correlationId}`}}class Ga{constructor(e,t,r,i,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=o}initiateAuthRequest(e,t){var r=this;return(0,v.A)(function*(){if(r.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(r.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),r.browserStorage.setTemporaryCache("request.origin",t.redirectStartPage,!0)),r.browserStorage.setTemporaryCache("request.correlationId",r.authCodeRequest.correlationId,!0),r.browserStorage.cacheCodeRequest(r.authCodeRequest),r.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);var i={apiId:861,timeout:t.redirectTimeout,noHistory:!1};return"function"==typeof t.onRedirectNavigate?(r.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1!==t.onRedirectNavigate(e)?(r.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),void(yield t.navigationClient.navigateExternal(e,i))):void r.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation")):(r.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),void(yield t.navigationClient.navigateExternal(e,i)))}throw r.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),R(nt)})()}handleCodeResponse(e,t){var r=this;return(0,v.A)(function*(){r.logger.verbose("RedirectHandler.handleCodeResponse called"),r.browserStorage.setInteractionInProgress(!1);var a,i=r.browserStorage.generateStateKey(t),o=r.browserStorage.getTemporaryCache(i);if(!o)throw T(rt,"Cached State");try{a=r.authModule.handleFragmentResponse(e,o)}catch(h){throw h instanceof Ge&&h.subError===ye?R(ye):h}var s=r.browserStorage.generateNonceKey(o),c=r.browserStorage.getTemporaryCache(s);if(r.authCodeRequest.code=a.code,a.cloud_instance_host_name&&(yield E(r.authModule.updateAuthority.bind(r.authModule),g.UpdateTokenEndpointAuthority,r.logger,r.performanceClient,r.authCodeRequest.correlationId)(a.cloud_instance_host_name,r.authCodeRequest.correlationId)),a.nonce=c||void 0,a.state=o,a.client_info)r.authCodeRequest.clientInfo=a.client_info;else{var l=r.checkCcsCredentials();l&&(r.authCodeRequest.ccsCredential=l)}var d=yield r.authModule.acquireToken(r.authCodeRequest,a);return r.browserStorage.cleanRequestByState(t),d})()}checkCcsCredentials(){var e=this.browserStorage.getTemporaryCache("ccs.credential",!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}class Ed extends Ct{constructor(e,t,r,i,o,a,s,c,l,d){super(e,t,r,i,o,a,s,l,d),this.nativeStorage=c}acquireToken(e){var t=this;return(0,v.A)(function*(){var r=yield E(t.initializeAuthorizationRequest.bind(t),g.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,t.correlationId)(e,b.Redirect);t.browserStorage.updateCacheEntries(r.state,r.nonce,r.authority,r.loginHint||"",r.account||null);var i=t.initializeServerTelemetryManager(861),o=h=>{h.persisted&&(t.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),t.browserStorage.cleanRequestByState(r.state),t.eventHandler.emitEvent("msal:restoreFromBFCache",b.Redirect))};try{var a=yield E(t.initializeAuthorizationCodeRequest.bind(t),g.StandardInteractionClientInitializeAuthorizationCodeRequest,t.logger,t.performanceClient,t.correlationId)(r),s=yield E(t.createAuthCodeClient.bind(t),g.StandardInteractionClientCreateAuthCodeClient,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:i,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),c=new Ga(s,t.browserStorage,a,t.logger,t.performanceClient),l=yield s.getAuthCodeUrl({...r,nativeBroker:_e.isNativeAvailable(t.config,t.logger,t.nativeMessageHandler,e.authenticationScheme)}),d=t.getRedirectStartPage(e.redirectStartPage);return t.logger.verbosePii(`Redirect start page: ${d}`),window.addEventListener("pageshow",o),yield c.initiateAuthRequest(l,{navigationClient:t.navigationClient,redirectTimeout:t.config.system.redirectNavigationTimeout,redirectStartPage:d,onRedirectNavigate:e.onRedirectNavigate||t.config.auth.onRedirectNavigate})}catch(h){throw h instanceof q&&(h.setCorrelationId(t.correlationId),i.cacheFailedRequest(h)),window.removeEventListener("pageshow",o),t.browserStorage.cleanRequestByState(r.state),h}})()}handleRedirectPromise(e="",t){var r=this;return(0,v.A)(function*(){var i=r.initializeServerTelemetryManager(865);try{if(!r.browserStorage.isInteractionInProgress(!0))return r.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;var[o,a]=r.getRedirectResponse(e||"");if(!o)return r.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),r.browserStorage.cleanRequestByInteractionType(b.Redirect),"back_forward"!==function(){if(!(typeof window>"u"||typeof window.performance>"u"||"function"!=typeof window.performance.getEntriesByType)){var n=window.performance.getEntriesByType("navigation"),e=n.length?n[0]:void 0;return e?.type}}()?t.event.errorCode="no_server_response":r.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;var s=r.browserStorage.getTemporaryCache("request.origin",!0)||C.EMPTY_STRING;if(x.removeHashFromUrl(s)===x.removeHashFromUrl(window.location.href)&&r.config.auth.navigateToLoginRequestUrl)return r.logger.verbose("Current page is loginRequestUrl, handling response"),s.indexOf("#")>-1&&function(n){var e=n.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}(s),yield r.handleResponse(o,i);if(!r.config.auth.navigateToLoginRequestUrl)return r.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),yield r.handleResponse(o,i);if(!vn()||r.config.system.allowRedirectInIframe){r.browserStorage.setTemporaryCache("urlHash",a,!0);var h={apiId:865,timeout:r.config.system.redirectNavigationTimeout,noHistory:!0},u=!0;if(s&&"null"!==s)r.logger.verbose(`Navigating to loginRequestUrl: ${s}`),u=yield r.navigationClient.navigateInternal(s,h);else{var f=function(){var e=new x(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}();r.browserStorage.setTemporaryCache("request.origin",f,!0),r.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),u=yield r.navigationClient.navigateInternal(f,h)}if(!u)return yield r.handleResponse(o,i)}return null}catch(p){throw p instanceof q&&(p.setCorrelationId(r.correlationId),i.cacheFailedRequest(p)),r.browserStorage.cleanRequestByInteractionType(b.Redirect),p}})()}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");var t=e;t||(t=this.config.auth.OIDCOptions.serverResponseType===Tt.QUERY?window.location.search:window.location.hash);var r=$r(t);if(r){try{!function(n,e,t){if(!n.state)throw R(Gt);var r=Ra(e,n.state);if(!r)throw R(Wr);if(r.interactionType!==t)throw R(Qr)}(r,this.browserCrypto,b.Redirect)}catch(o){return o instanceof q&&this.logger.error(`Interaction type validation failed due to ${o.errorCode}: ${o.errorMessage}`),[null,""]}return function(n){n.location.hash="","function"==typeof n.history.replaceState&&n.history.replaceState(null,"",`${n.location.origin}${n.location.pathname}${n.location.search}`)}(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}var i=this.browserStorage.getTemporaryCache("urlHash",!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey("urlHash")),i&&(r=$r(i))?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,i]):[null,""]}handleResponse(e,t){var r=this;return(0,v.A)(function*(){var i=e.state;if(!i)throw R(Gt);var o=r.browserStorage.getCachedRequest(i);if(r.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(r.logger.verbose("Account id found in hash, calling WAM for token"),!r.nativeMessageHandler)throw R(ze);var a=new At(r.config,r.browserStorage,r.browserCrypto,r.logger,r.eventHandler,r.navigationClient,862,r.performanceClient,r.nativeMessageHandler,e.accountId,r.nativeStorage,o.correlationId),{userRequestState:s}=ve.parseRequestState(r.browserCrypto,i);return a.acquireToken({...o,state:s,prompt:void 0}).finally(()=>{r.browserStorage.cleanRequestByState(i)})}var c=r.browserStorage.getCachedAuthority(i);if(!c)throw R(Qt);var l=yield E(r.createAuthCodeClient.bind(r),g.StandardInteractionClientCreateAuthCodeClient,r.logger,r.performanceClient,r.correlationId)({serverTelemetryManager:t,requestAuthority:c});return Se.removeThrottle(r.browserStorage,r.config.auth.clientId,o),new Ga(l,r.browserStorage,o,r.logger,r.performanceClient).handleCodeResponse(e,i)})()}logout(e){var t=this;return(0,v.A)(function*(){t.logger.verbose("logoutRedirect called");var r=t.initializeLogoutRequest(e),i=t.initializeServerTelemetryManager(961);try{t.eventHandler.emitEvent("msal:logoutStart",b.Redirect,e),yield t.clearCacheOnLogout(r.account);var o={apiId:961,timeout:t.config.system.redirectNavigationTimeout,noHistory:!1},s=(yield E(t.createAuthCodeClient.bind(t),g.StandardInteractionClientCreateAuthCodeClient,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:i,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0})).getLogoutUri(r);if(t.eventHandler.emitEvent("msal:logoutSuccess",b.Redirect,r),!e||"function"!=typeof e.onRedirectNavigate)return t.browserStorage.getInteractionInProgress()||t.browserStorage.setInteractionInProgress(!0),void(yield t.navigationClient.navigateExternal(s,o));if(!1!==e.onRedirectNavigate(s))return t.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),t.browserStorage.getInteractionInProgress()||t.browserStorage.setInteractionInProgress(!0),void(yield t.navigationClient.navigateExternal(s,o));t.browserStorage.setInteractionInProgress(!1),t.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}catch(l){throw l instanceof q&&(l.setCorrelationId(t.correlationId),i.cacheFailedRequest(l)),t.eventHandler.emitEvent("msal:logoutFailure",b.Redirect,null,l),t.eventHandler.emitEvent("msal:logoutEnd",b.Redirect),l}t.eventHandler.emitEvent("msal:logoutEnd",b.Redirect)})()}getRedirectStartPage(e){var t=e||window.location.href;return x.getAbsoluteUrl(t,Pe())}}function _d(n,e,t,r,i){return uo.apply(this,arguments)}function uo(){return uo=(0,v.A)(function*(n,e,t,r,i){if(e.addQueueMeasurement(g.SilentHandlerInitiateAuthRequest,r),!n)throw t.info("Navigate url is empty"),R(nt);return i?E(Rd,g.SilentHandlerLoadFrame,t,e,r)(n,i,e,r):je(bd,g.SilentHandlerLoadFrameSync,t,e,r)(n)}),uo.apply(this,arguments)}function wd(n,e,t,r,i,o,a){return ho.apply(this,arguments)}function ho(){return ho=(0,v.A)(function*(n,e,t,r,i,o,a){return r.addQueueMeasurement(g.SilentHandlerMonitorIframeForHash,o),new Promise((s,c)=>{e<Gi&&i.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${Gi}ms). This may result in timeouts.`);var l=window.setTimeout(()=>{window.clearInterval(d),c(R(qt))},e),d=window.setInterval(()=>{var h="",u=n.contentWindow;try{h=u?u.location.href:""}catch{}if(h&&"about:blank"!==h){var f="";u&&(f=a===Tt.QUERY?u.location.search:u.location.hash),window.clearTimeout(l),window.clearInterval(d),s(f)}},t)}).finally(()=>{je(kd,g.RemoveHiddenIframe,i,r,o)(n)})}),ho.apply(this,arguments)}function Rd(n,e,t,r){return t.addQueueMeasurement(g.SilentHandlerLoadFrame,r),new Promise((i,o)=>{var a=$a();window.setTimeout(()=>{a?(a.src=n,i(a)):o("Unable to load iframe")},e)})}function bd(n){var e=$a();return e.src=n,e}function $a(){var n=document.createElement("iframe");return n.className="msalSilentIframe",n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height="0",n.style.border="0",n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(n),n}function kd(n){document.body===n.parentNode&&document.body.removeChild(n)}class Pd extends Ct{constructor(e,t,r,i,o,a,s,c,l,d,h){super(e,t,r,i,o,a,c,d,h),this.apiId=s,this.nativeStorage=l}acquireToken(e){var t=this;return(0,v.A)(function*(){t.performanceClient.addQueueMeasurement(g.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&t.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");var r={...e};r.prompt?r.prompt!==Z.NONE&&r.prompt!==Z.NO_SESSION&&(t.logger.warning(`SilentIframeClient. Replacing invalid prompt ${r.prompt} with ${Z.NONE}`),r.prompt=Z.NONE):r.prompt=Z.NONE;var i=yield E(t.initializeAuthorizationRequest.bind(t),g.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,e.correlationId)(r,b.Silent);zo(i.authority);var a,o=t.initializeServerTelemetryManager(t.apiId);try{return a=yield E(t.createAuthCodeClient.bind(t),g.StandardInteractionClientCreateAuthCodeClient,t.logger,t.performanceClient,e.correlationId)({serverTelemetryManager:o,requestAuthority:i.authority,requestAzureCloudOptions:i.azureCloudOptions,requestExtraQueryParameters:i.extraQueryParameters,account:i.account}),yield E(t.silentTokenHelper.bind(t),g.SilentIframeClientTokenHelper,t.logger,t.performanceClient,e.correlationId)(a,i)}catch(c){if(c instanceof q&&(c.setCorrelationId(t.correlationId),o.cacheFailedRequest(c)),!(a&&c instanceof q&&c.errorCode===ce.INVALID_GRANT_ERROR))throw c;t.performanceClient.addFields({retryError:c.errorCode},t.correlationId);var s=yield E(t.initializeAuthorizationRequest.bind(t),g.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,e.correlationId)(r,b.Silent);return yield E(t.silentTokenHelper.bind(t),g.SilentIframeClientTokenHelper,t.logger,t.performanceClient,t.correlationId)(a,s)}})()}logout(){return Promise.reject(R(it))}silentTokenHelper(e,t){var r=this;return(0,v.A)(function*(){var i=t.correlationId;r.performanceClient.addQueueMeasurement(g.SilentIframeClientTokenHelper,i);var o=yield E(r.initializeAuthorizationCodeRequest.bind(r),g.StandardInteractionClientInitializeAuthorizationCodeRequest,r.logger,r.performanceClient,i)(t),a=yield E(e.getAuthCodeUrl.bind(e),g.GetAuthCodeUrl,r.logger,r.performanceClient,i)({...t,nativeBroker:_e.isNativeAvailable(r.config,r.logger,r.nativeMessageHandler,t.authenticationScheme)}),s=new lo(e,r.browserStorage,o,r.logger,r.performanceClient),c=yield E(_d,g.SilentHandlerInitiateAuthRequest,r.logger,r.performanceClient,i)(a,r.performanceClient,r.logger,i,r.config.system.navigateFrameWait),l=r.config.auth.OIDCOptions.serverResponseType,d=yield E(wd,g.SilentHandlerMonitorIframeForHash,r.logger,r.performanceClient,i)(c,r.config.system.iframeHashTimeout,r.config.system.pollIntervalMilliseconds,r.performanceClient,r.logger,i,l),h=je(Fa,g.DeserializeResponse,r.logger,r.performanceClient,r.correlationId)(d,l,r.logger);if(h.accountId){if(r.logger.verbose("Account id found in hash, calling WAM for token"),!r.nativeMessageHandler)throw R(ze);var u=new At(r.config,r.browserStorage,r.browserCrypto,r.logger,r.eventHandler,r.navigationClient,r.apiId,r.performanceClient,r.nativeMessageHandler,h.accountId,r.browserStorage,i),{userRequestState:f}=ve.parseRequestState(r.browserCrypto,t.state);return E(u.acquireToken.bind(u),g.NativeInteractionClientAcquireToken,r.logger,r.performanceClient,i)({...t,state:f,prompt:t.prompt||Z.NONE})}return E(s.handleCodeResponse.bind(s),g.HandleCodeResponse,r.logger,r.performanceClient,i)(h,t)})()}}class Od extends Ct{acquireToken(e){var t=this;return(0,v.A)(function*(){t.performanceClient.addQueueMeasurement(g.SilentRefreshClientAcquireToken,e.correlationId);var r=yield E(io,g.InitializeBaseRequest,t.logger,t.performanceClient,e.correlationId)(e,t.config,t.performanceClient,t.logger),i={...e,...r};e.redirectUri&&(i.redirectUri=t.getRedirectUri(e.redirectUri));var o=t.initializeServerTelemetryManager(61),a=yield t.createRefreshTokenClient({serverTelemetryManager:o,authorityUrl:i.authority,azureCloudOptions:i.azureCloudOptions,account:i.account});return E(a.acquireTokenByRefreshToken.bind(a),g.RefreshTokenClientAcquireTokenByRefreshToken,t.logger,t.performanceClient,e.correlationId)(i).catch(s=>{throw s.setCorrelationId(t.correlationId),o.cacheFailedRequest(s),s})})()}logout(){return Promise.reject(R(it))}createRefreshTokenClient(e){var t=this;return(0,v.A)(function*(){var r=yield E(t.getClientConfiguration.bind(t),g.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new co(r,t.performanceClient)})()}}class Nd{constructor(e,t,r,i){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=r,this.cryptoObj=i}loadExternalTokens(e,t,r){if(!this.isBrowserEnvironment)throw R(ot);var i=t.id_token?Ve(t.id_token,Ie):void 0,o={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},a=e.authority?new ne(ne.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,o,this.logger,e.correlationId||ke()):void 0,s=this.loadAccount(e,r.clientInfo||t.client_info||"",i,a),c=this.loadIdToken(t,s.homeAccountId,s.environment,s.realm),l=this.loadAccessToken(e,t,s.homeAccountId,s.environment,s.realm,r),d=this.loadRefreshToken(t,s.homeAccountId,s.environment);return this.generateAuthenticationResult(e,{account:s,idToken:c,accessToken:l,refreshToken:d},i,a)}loadAccount(e,t,r,i){if(this.logger.verbose("TokenCache - loading account"),e.account){var o=J.createFromAccountInfo(e.account);return this.storage.setAccount(o),o}if(!i||!t&&!r)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),R(tn);var a=J.generateHomeAccountId(t,i.authorityType,this.logger,this.cryptoObj,r),s=r?.tid,c=eo(this.storage,i,a,Ie,r,t,i.hostnameAndPort,s,void 0,void 0,this.logger);return this.storage.setAccount(c),c}loadIdToken(e,t,r,i){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");var o=An(t,r,e.id_token,this.config.auth.clientId,i);return this.storage.setIdTokenCredential(o),o}loadAccessToken(e,t,r,i,o,a){if(!t.access_token)return this.logger.verbose("TokenCache - no access token found in response"),null;if(!t.expires_in)return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;if(!(t.scope||e.scopes&&e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null;this.logger.verbose("TokenCache - loading access token");var s=t.scope?j.fromString(t.scope):new j(e.scopes),c=a.expiresOn||t.expires_in+(new Date).getTime()/1e3,l=a.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+(new Date).getTime()/1e3,d=Tn(r,i,t.access_token,this.config.auth.clientId,o,s.printScopes(),c,l,Ie);return this.storage.setAccessTokenCredential(d),d}loadRefreshToken(e,t,r){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");var i=na(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return this.storage.setRefreshTokenCredential(i),i}generateAuthenticationResult(e,t,r,i){var c,o="",a=[],s=null;t?.accessToken&&(o=t.accessToken.secret,a=j.fromString(t.accessToken.target).asArray(),s=new Date(1e3*Number(t.accessToken.expiresOn)),c=new Date(1e3*Number(t.accessToken.extendedExpiresOn)));var l=t.account;return{authority:i?i.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:a,account:l.getAccountInfo(),idToken:t.idToken?.secret||"",idTokenClaims:r||{},accessToken:o,fromCache:!0,expiresOn:s,correlationId:e.correlationId||"",requestId:"",extExpiresOn:c,familyId:t.refreshToken?.familyId||"",tokenType:t?.accessToken?.tokenType||"",state:e.state||"",cloudGraphHostName:l.cloudGraphHostName||"",msGraphHost:l.msGraphHost||"",fromNativeBroker:!1}}}class Md extends Da{constructor(e){super(e),this.includeRedirectUri=!1}}class Ud extends Ct{constructor(e,t,r,i,o,a,s,c,l,d){super(e,t,r,i,o,a,c,l,d),this.apiId=s}acquireToken(e){var t=this;return(0,v.A)(function*(){if(!e.code)throw R(rn);var r=yield E(t.initializeAuthorizationRequest.bind(t),g.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,e.correlationId)(e,b.Silent),i=t.initializeServerTelemetryManager(t.apiId);try{var o={...r,code:e.code},a=yield E(t.getClientConfiguration.bind(t),g.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,e.correlationId)({serverTelemetryManager:i,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),s=new Md(a);t.logger.verbose("Auth code client created");var c=new lo(s,t.browserStorage,o,t.logger,t.performanceClient);return yield E(c.handleCodeResponseFromServer.bind(c),g.HandleCodeResponseFromServer,t.logger,t.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},r,!1)}catch(l){throw l instanceof q&&(l.setCorrelationId(t.correlationId),i.cacheFailedRequest(l)),l}})()}logout(){return Promise.reject(R(it))}}function we(n){var e=n?.idTokenClaims;return e?.tfp||e?.acr?"B2C":e?.tid?"9188040d-6c67-4c5b-b112-36a304b66dad"===e?.tid?"MSA":"AAD":void 0}function Nn(n,e){try{Ri(n)}catch(t){throw e.end({success:!1},t),t}}class Mn{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new gt(this.logger,this.performanceClient):yn,this.eventHandler=new pl(this.logger),this.browserStorage=this.isBrowserEnvironment?new Yi(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,function(n){var e=n.cloudDiscoveryMetadata,t=void 0;if(e)try{t=JSON.parse(e)}catch{throw $(Rt)}return{canonicalAuthority:n.authority?Ea(n.authority):void 0,knownAuthorities:n.knownAuthorities,cloudDiscoveryMetadata:t}}(this.config.auth),this.performanceClient):(()=>new Yi(this.config.auth.clientId,{cacheLocation:oe.MemoryStorage,temporaryCacheLocation:oe.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},yn,this.logger))(),this.nativeInternalStorage=new Yi(this.config.auth.clientId,{cacheLocation:oe.MemoryStorage,temporaryCacheLocation:oe.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},this.browserCrypto,this.logger,void 0,this.performanceClient),this.tokenCache=new Nd(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this),this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}static createController(e,t){return(0,v.A)(function*(){var r=new Mn(e);return yield r.initialize(t),r})()}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}initialize(e){var t=this;return(0,v.A)(function*(){if(t.logger.trace("initialize called"),t.initialized)t.logger.info("initialize has already been called, exiting early.");else{if(!t.isBrowserEnvironment)return t.logger.info("in non-browser environment, exiting early."),t.initialized=!0,void t.eventHandler.emitEvent("msal:initializeEnd");var r=e?.correlationId||t.getRequestCorrelationId(),i=t.config.system.allowNativeBroker,o=t.performanceClient.startMeasurement(g.InitializeClientApplication,r);if(t.eventHandler.emitEvent("msal:initializeStart"),i)try{t.nativeExtensionProvider=yield _e.createProvider(t.logger,t.config.system.nativeBrokerHandshakeTimeout,t.performanceClient)}catch(a){t.logger.verbose(a)}t.config.cache.claimsBasedCachingEnabled||(t.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),yield E(t.browserStorage.clearTokensAndKeysWithClaims.bind(t.browserStorage),g.ClearTokensAndKeysWithClaims,t.logger,t.performanceClient,r)(t.performanceClient,r)),t.initialized=!0,t.eventHandler.emitEvent("msal:initializeEnd"),o.end({allowNativeBroker:i,success:!0})}})()}handleRedirectPromise(e){var t=this;return(0,v.A)(function*(){if(t.logger.verbose("handleRedirectPromise called"),$o(t.initialized),t.isBrowserEnvironment){var r=e||"",i=t.redirectResponse.get(r);return typeof i>"u"?(i=t.handleRedirectPromiseInternal(e),t.redirectResponse.set(r,i),t.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):t.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),i}return t.logger.verbose("handleRedirectPromise returns null, not browser environment"),null})()}handleRedirectPromiseInternal(e){var t=this;return(0,v.A)(function*(){var c,r=t.getAllAccounts(),i=t.browserStorage.getCachedNativeRequest(),o=i&&_e.isNativeAvailable(t.config,t.logger,t.nativeExtensionProvider)&&t.nativeExtensionProvider&&!e,a=o?i?.correlationId:t.browserStorage.getTemporaryCache("request.correlationId",!0)||"",s=t.performanceClient.startMeasurement(g.AcquireTokenRedirect,a);if(t.eventHandler.emitEvent("msal:handleRedirectStart",b.Redirect),o&&t.nativeExtensionProvider){t.logger.trace("handleRedirectPromise - acquiring token from native platform");var l=new At(t.config,t.browserStorage,t.browserCrypto,t.logger,t.eventHandler,t.navigationClient,865,t.performanceClient,t.nativeExtensionProvider,i.accountId,t.nativeInternalStorage,i.correlationId);c=E(l.handleRedirectPromise.bind(l),g.HandleNativeRedirectPromiseMeasurement,t.logger,t.performanceClient,s.event.correlationId)(t.performanceClient,s.event.correlationId)}else{t.logger.trace("handleRedirectPromise - acquiring token from web flow");var d=t.createRedirectClient(a);c=E(d.handleRedirectPromise.bind(d),g.HandleRedirectPromiseMeasurement,t.logger,t.performanceClient,s.event.correlationId)(e,s)}return c.then(h=>(h?(r.length<t.getAllAccounts().length?(t.eventHandler.emitEvent("msal:loginSuccess",b.Redirect,h),t.logger.verbose("handleRedirectResponse returned result, login success")):(t.eventHandler.emitEvent("msal:acquireTokenSuccess",b.Redirect,h),t.logger.verbose("handleRedirectResponse returned result, acquire token success")),s.end({success:!0,accountType:we(h.account)})):s.event.errorCode?s.end({success:!1}):s.discard(),t.eventHandler.emitEvent("msal:handleRedirectEnd",b.Redirect),h)).catch(h=>{var u=h;throw t.eventHandler.emitEvent(r.length>0?"msal:acquireTokenFailure":"msal:loginFailure",b.Redirect,null,u),t.eventHandler.emitEvent("msal:handleRedirectEnd",b.Redirect),s.end({success:!1},u),h})})()}acquireTokenRedirect(e){var t=this;return(0,v.A)(function*(){var r=t.getRequestCorrelationId(e);t.logger.verbose("acquireTokenRedirect called",r);var i=t.performanceClient.startMeasurement(g.AcquireTokenPreRedirect,r);i.add({accountType:we(e.account),scenarioId:e.scenarioId});var o=e.onRedirectNavigate;if(o)e.onRedirectNavigate=h=>{var u="function"==typeof o?o(h):void 0;return!1!==u?i.end({success:!0}):i.discard(),u};else{var a=t.config.auth.onRedirectNavigate;t.config.auth.onRedirectNavigate=h=>{var u="function"==typeof a?a(h):void 0;return!1!==u?i.end({success:!0}):i.discard(),u}}var s=t.getAllAccounts().length>0;try{var c;return qo(t.initialized,t.config),t.browserStorage.setInteractionInProgress(!0),t.eventHandler.emitEvent(s?"msal:acquireTokenStart":"msal:loginStart",b.Redirect,e),c=t.nativeExtensionProvider&&t.canUseNative(e)?new At(t.config,t.browserStorage,t.browserCrypto,t.logger,t.eventHandler,t.navigationClient,861,t.performanceClient,t.nativeExtensionProvider,t.getNativeAccountId(e),t.nativeInternalStorage,r).acquireTokenRedirect(e,i).catch(h=>{if(h instanceof Ee&&yt(h))return t.nativeExtensionProvider=void 0,t.createRedirectClient(r).acquireToken(e);if(h instanceof he)return t.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),t.createRedirectClient(r).acquireToken(e);throw t.browserStorage.setInteractionInProgress(!1),h}):t.createRedirectClient(r).acquireToken(e),yield c}catch(h){throw i.end({success:!1},h),t.eventHandler.emitEvent(s?"msal:acquireTokenFailure":"msal:loginFailure",b.Redirect,null,h),h}})()}acquireTokenPopup(e){var t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(g.AcquireTokenPopup,t);r.add({scenarioId:e.scenarioId,accountType:we(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),Nn(this.initialized,r),this.browserStorage.setInteractionInProgress(!0)}catch(s){return Promise.reject(s)}var i=this.getAllAccounts();return this.eventHandler.emitEvent(i.length>0?"msal:acquireTokenStart":"msal:loginStart",b.Popup,e),(this.canUseNative(e)?this.acquireTokenNative({...e,correlationId:t},862).then(s=>(this.browserStorage.setInteractionInProgress(!1),r.end({success:!0,isNativeBroker:!0,accountType:we(s.account)}),s)).catch(s=>{if(s instanceof Ee&&yt(s))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(s instanceof he)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),s}):this.createPopupClient(t).acquireToken(e)).then(s=>{var c=i.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(c?"msal:loginSuccess":"msal:acquireTokenSuccess",b.Popup,s),r.end({success:!0,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length,accountType:we(s.account)}),s}).catch(s=>(this.eventHandler.emitEvent(i.length>0?"msal:acquireTokenFailure":"msal:loginFailure",b.Popup,null,s),r.end({success:!1},s),Promise.reject(s)))}trackPageVisibilityWithMeasurement(){var e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}ssoSilent(e){var t=this;return(0,v.A)(function*(){var r=t.getRequestCorrelationId(e),i={...e,prompt:e.prompt,correlationId:r};return t.ssoSilentMeasurement=t.performanceClient.startMeasurement(g.SsoSilent,r),t.ssoSilentMeasurement?.add({scenarioId:e.scenarioId,accountType:we(e.account)}),Nn(t.initialized,t.ssoSilentMeasurement),t.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement),t.logger.verbose("ssoSilent called",r),t.eventHandler.emitEvent("msal:ssoSilentStart",b.Silent,i),(t.canUseNative(i)?t.acquireTokenNative(i,863).catch(s=>{if(s instanceof Ee&&yt(s))return t.nativeExtensionProvider=void 0,t.createSilentIframeClient(i.correlationId).acquireToken(i);throw s}):t.createSilentIframeClient(i.correlationId).acquireToken(i)).then(s=>(t.eventHandler.emitEvent("msal:ssoSilentSuccess",b.Silent,s),t.ssoSilentMeasurement?.end({success:!0,isNativeBroker:s.fromNativeBroker,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length,accountType:we(s.account)}),s)).catch(s=>{throw t.eventHandler.emitEvent("msal:ssoSilentFailure",b.Silent,null,s),t.ssoSilentMeasurement?.end({success:!1},s),s}).finally(()=>{document.removeEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement)})})()}acquireTokenByCode(e){var t=this;return(0,v.A)(function*(){var r=t.getRequestCorrelationId(e);t.logger.trace("acquireTokenByCode called",r);var i=t.performanceClient.startMeasurement(g.AcquireTokenByCode,r);Nn(t.initialized,i),t.eventHandler.emitEvent("msal:acquireTokenByCodeStart",b.Silent,e),i.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw R(on);if(e.code){var o=e.code,a=t.hybridAuthCodeResponses.get(o);return a?(t.logger.verbose("Existing acquireTokenByCode request found",r),i.discard()):(t.logger.verbose("Initiating new acquireTokenByCode request",r),a=t.acquireTokenByCodeAsync({...e,correlationId:r}).then(c=>(t.eventHandler.emitEvent("msal:acquireTokenByCodeSuccess",b.Silent,c),t.hybridAuthCodeResponses.delete(o),i.end({success:!0,isNativeBroker:c.fromNativeBroker,accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length,accountType:we(c.account)}),c)).catch(c=>{throw t.hybridAuthCodeResponses.delete(o),t.eventHandler.emitEvent("msal:acquireTokenByCodeFailure",b.Silent,null,c),i.end({success:!1},c),c}),t.hybridAuthCodeResponses.set(o,a)),yield a}if(e.nativeAccountId){if(t.canUseNative(e,e.nativeAccountId)){var s=yield t.acquireTokenNative({...e,correlationId:r},866,e.nativeAccountId).catch(c=>{throw c instanceof Ee&&yt(c)&&(t.nativeExtensionProvider=void 0),c});return i.end({accountType:we(s.account),success:!0}),s}throw R(an)}throw R(nn)}catch(c){throw t.eventHandler.emitEvent("msal:acquireTokenByCodeFailure",b.Silent,null,c),i.end({success:!1},c),c}})()}acquireTokenByCodeAsync(e){var t=this;return(0,v.A)(function*(){t.logger.trace("acquireTokenByCodeAsync called",e.correlationId),t.acquireTokenByCodeAsyncMeasurement=t.performanceClient.startMeasurement(g.AcquireTokenByCodeAsync,e.correlationId),t.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement);var r=t.createSilentAuthCodeClient(e.correlationId);return yield r.acquireToken(e).then(o=>(t.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:o.fromCache,isNativeBroker:o.fromNativeBroker}),o)).catch(o=>{throw t.acquireTokenByCodeAsyncMeasurement?.end({success:!1},o),o}).finally(()=>{document.removeEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement)})})()}acquireTokenFromCache(e,t){var r=this;return(0,v.A)(function*(){switch(r.performanceClient.addQueueMeasurement(g.AcquireTokenFromCache,e.correlationId),t){case 0:case 1:case 2:var i=r.createSilentCacheClient(e.correlationId);return E(i.acquireToken.bind(i),g.SilentCacheClientAcquireToken,r.logger,r.performanceClient,e.correlationId)(e);default:throw T(me)}})()}acquireTokenByRefreshToken(e,t){var r=this;return(0,v.A)(function*(){switch(r.performanceClient.addQueueMeasurement(g.AcquireTokenByRefreshToken,e.correlationId),t){case 0:case 2:case 3:case 4:var i=r.createSilentRefreshClient(e.correlationId);return E(i.acquireToken.bind(i),g.SilentRefreshClientAcquireToken,r.logger,r.performanceClient,e.correlationId)(e);default:throw T(me)}})()}acquireTokenBySilentIframe(e){var t=this;return(0,v.A)(function*(){t.performanceClient.addQueueMeasurement(g.AcquireTokenBySilentIframe,e.correlationId);var r=t.createSilentIframeClient(e.correlationId);return E(r.acquireToken.bind(r),g.SilentIframeClientAcquireToken,t.logger,t.performanceClient,e.correlationId)(e)})()}logout(e){var t=this;return(0,v.A)(function*(){var r=t.getRequestCorrelationId(e);return t.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",r),t.logoutRedirect({correlationId:r,...e})})()}logoutRedirect(e){var t=this;return(0,v.A)(function*(){var r=t.getRequestCorrelationId(e);return qo(t.initialized,t.config),t.browserStorage.setInteractionInProgress(!0),t.createRedirectClient(r).logout(e)})()}logoutPopup(e){try{var t=this.getRequestCorrelationId(e);return Ri(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(i){return Promise.reject(i)}}clearCache(e){var t=this;return(0,v.A)(function*(){if(t.isBrowserEnvironment){var r=t.getRequestCorrelationId(e);return t.createSilentCacheClient(r).logout(e)}t.logger.info("in non-browser environment, returning early.")})()}getAllAccounts(e){return function(n,e,t,r){return n.verbose("getAllAccounts called"),t?e.getAllAccounts(r):[]}(this.logger,this.browserStorage,this.isBrowserEnvironment,e)}getAccount(e){return function(n,e,t){if(e.trace("getAccount called"),0===Object.keys(n).length)return e.warning("getAccount: No accountFilter provided"),null;var r=t.getAccountInfoFilteredBy(n);return r?(e.verbose("getAccount: Account matching provided filter found, returning"),r):(e.verbose("getAccount: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage)}getAccountByUsername(e){return function(n,e,t){if(e.trace("getAccountByUsername called"),!n)return e.warning("getAccountByUsername: No username provided"),null;var r=t.getAccountInfoFilteredBy({username:n});return r?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${n}`),r):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage)}getAccountByHomeId(e){return function(n,e,t){if(e.trace("getAccountByHomeId called"),!n)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;var r=t.getAccountInfoFilteredBy({homeAccountId:n});return r?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${n}`),r):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage)}getAccountByLocalId(e){return function(n,e,t){if(e.trace("getAccountByLocalId called"),!n)return e.warning("getAccountByLocalId: No localAccountId provided"),null;var r=t.getAccountInfoFilteredBy({localAccountId:n});return r?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${n}`),r):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage)}setActiveAccount(e){!function(n,e){e.setActiveAccount(n)}(e,this.browserStorage)}getActiveAccount(){return function(n){return n.getActiveAccount()}(this.browserStorage)}hydrateCache(e,t){var r=this;return(0,v.A)(function*(){r.logger.verbose("hydrateCache called");var i=J.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return r.browserStorage.setAccount(i),e.fromNativeBroker?(r.logger.verbose("Response was from native broker, storing in-memory"),r.nativeInternalStorage.hydrateCache(e,t)):r.browserStorage.hydrateCache(e,t)})()}acquireTokenNative(e,t,r){var i=this;return(0,v.A)(function*(){if(i.logger.trace("acquireTokenNative called"),!i.nativeExtensionProvider)throw R(ze);return new At(i.config,i.browserStorage,i.browserCrypto,i.logger,i.eventHandler,i.navigationClient,t,i.performanceClient,i.nativeExtensionProvider,r||i.getNativeAccountId(e),i.nativeInternalStorage,e.correlationId).acquireToken(e)})()}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!_e.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case Z.NONE:case Z.CONSENT:case Z.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),1))}getNativeAccountId(e){var t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Id(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new Ed(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new Pd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,863,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new Ba(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new Od(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new Ud(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,866,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return Go(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}handleAccountCacheChange(e){try{e.key?.includes("active-account-filters")&&this.eventHandler.emitEvent("msal:activeAccountChanged");var t=e.newValue||e.oldValue;if(!t)return;var r=JSON.parse(t);if("object"!=typeof r||!J.isAccountEntity(r))return;var o=ht.toObject(new J,r).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.eventHandler.emitEvent("msal:accountAdded",void 0,o)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.eventHandler.emitEvent("msal:accountRemoved",void 0,o))}catch{return}}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?ke():C.EMPTY_STRING}loginRedirect(e){var t=this;return(0,v.A)(function*(){var r=t.getRequestCorrelationId(e);return t.logger.verbose("loginRedirect called",r),t.acquireTokenRedirect({correlationId:r,...e||Uo})})()}loginPopup(e){var t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||Uo})}acquireTokenSilent(e){var t=this;return(0,v.A)(function*(){var r=t.getRequestCorrelationId(e),i=t.performanceClient.startMeasurement(g.AcquireTokenSilent,r);i.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),Nn(t.initialized,i),t.logger.verbose("acquireTokenSilent called",r);var o=e.account||t.getActiveAccount();if(!o)throw R(Jr);i.add({accountType:we(o)});var s=JSON.stringify({clientId:t.config.auth.clientId,authority:e.authority||C.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:o.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions}),c=t.activeSilentTokenRequests.get(s);if(typeof c>"u"){t.logger.verbose("acquireTokenSilent called for the first time, storing active request",r);var l=E(t.acquireTokenSilentAsync.bind(t),g.AcquireTokenSilentAsync,t.logger,t.performanceClient,r)({...e,correlationId:r},o).then(d=>(t.activeSilentTokenRequests.delete(s),i.end({success:!0,fromCache:d.fromCache,isNativeBroker:d.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,accessTokenSize:d.accessToken.length,idTokenSize:d.idToken.length}),d)).catch(d=>{throw t.activeSilentTokenRequests.delete(s),i.end({success:!1},d),d});return t.activeSilentTokenRequests.set(s,l),{...yield l,state:e.state}}return t.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",r),i.discard(),{...yield c,state:e.state}})()}acquireTokenSilentAsync(e,t){var r=this;return(0,v.A)(function*(){var i=()=>r.trackPageVisibility(e.correlationId);r.performanceClient.addQueueMeasurement(g.AcquireTokenSilentAsync,e.correlationId),r.eventHandler.emitEvent("msal:acquireTokenStart",b.Silent,e),e.correlationId&&r.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",i);var o=yield E(ld,g.InitializeSilentRequest,r.logger,r.performanceClient,e.correlationId)(e,t,r.config,r.performanceClient,r.logger),a=e.cacheLookupPolicy||0,s=r.acquireTokenSilentNoIframe(o,a).catch(function(){var c=(0,v.A)(function*(l){var d=function(n,e){var i=!(n instanceof he&&n.subError!==mt)&&(n.errorCode===ce.INVALID_GRANT_ERROR||n.errorCode===me)||n.errorCode===ft||n.errorCode===Qi,o=As.includes(e);return i&&o}(l,a);if(d){if(r.activeIframeRequest){if(5!==a){var[u,f]=r.activeIframeRequest;r.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${f}`,o.correlationId);var p=r.performanceClient.startMeasurement(g.AwaitConcurrentIframe,o.correlationId);p.add({awaitIframeCorrelationId:f});var m=yield u;if(p.end({success:m}),m)return r.logger.verbose(`Parallel iframe request with correlationId: ${f} succeeded. Retrying cache and/or RT redemption`,o.correlationId),r.acquireTokenSilentNoIframe(o,a);throw r.logger.info(`Iframe request with correlationId: ${f} failed. Interaction is required.`),l}return r.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",o.correlationId),E(r.acquireTokenBySilentIframe.bind(r),g.AcquireTokenBySilentIframe,r.logger,r.performanceClient,o.correlationId)(o)}var h;return r.activeIframeRequest=[new Promise(A=>{h=A}),o.correlationId],r.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",o.correlationId),E(r.acquireTokenBySilentIframe.bind(r),g.AcquireTokenBySilentIframe,r.logger,r.performanceClient,o.correlationId)(o).then(A=>(h(!0),A)).catch(A=>{throw h(!1),A}).finally(()=>{r.activeIframeRequest=void 0})}throw l});return function(l){return c.apply(this,arguments)}}());return s.then(c=>(r.eventHandler.emitEvent("msal:acquireTokenSuccess",b.Silent,c),e.correlationId&&r.performanceClient.addFields({fromCache:c.fromCache,isNativeBroker:c.fromNativeBroker},e.correlationId),c)).catch(c=>{throw r.eventHandler.emitEvent("msal:acquireTokenFailure",b.Silent,null,c),c}).finally(()=>{document.removeEventListener("visibilitychange",i)})})()}acquireTokenSilentNoIframe(e,t){var r=this;return(0,v.A)(function*(){return _e.isNativeAvailable(r.config,r.logger,r.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(r.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),r.acquireTokenNative(e,61).catch(function(){var i=(0,v.A)(function*(o){throw o instanceof Ee&&yt(o)?(r.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),r.nativeExtensionProvider=void 0,T(me)):o});return function(o){return i.apply(this,arguments)}}())):(r.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),E(r.acquireTokenFromCache.bind(r),g.AcquireTokenFromCache,r.logger,r.performanceClient,e.correlationId)(e,t).catch(i=>{if(1===t)throw i;return r.eventHandler.emitEvent("msal:acquireTokenFromNetworkStart",b.Silent,e),E(r.acquireTokenByRefreshToken.bind(r),g.AcquireTokenByRefreshToken,r.logger,r.performanceClient,e.correlationId)(e,t)}))})()}}function go(){return go=(0,v.A)(function*(n,e){var t=new Ye(n);return yield t.initialize(),Mn.createController(t,e)}),go.apply(this,arguments)}class nr{static createPublicClientApplication(e){return(0,v.A)(function*(){var t=yield function(n,e){return go.apply(this,arguments)}(e);return new nr(e,t)})()}constructor(e,t){this.controller=t||new Mn(new Ye(e))}initialize(e){var t=this;return(0,v.A)(function*(){return t.controller.initialize(e)})()}acquireTokenPopup(e){var t=this;return(0,v.A)(function*(){return t.controller.acquireTokenPopup(e)})()}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}hydrateCache(e,t){var r=this;return(0,v.A)(function*(){return r.controller.hydrateCache(e,t)})()}clearCache(e){return this.controller.clearCache(e)}}var xd=w(0),ae=function(n){return n.Unexpected="Unexpected",n.ClusterResolutionFailure="ClusterResolutionFailure",n.AcquireTokenFailure="AcquireTokenFailure",n.MissingFixedClusterUriProperty="MissingFixedClusterUriProperty",n.AccessTokenExpiryStringUndefined="AccessTokenExpiryStringUndefined",n.LoginRedirectFailure="LoginRedirectFailure",n.LoginPopupFailure="LoginPopupFailure",n}({}),Un=function(n){return n.Error="Error",n.Info="Info",n.Debug="Debug",n.Warning="Warning",n}({}),S=function(n){return n.AbtLoginHintCacheKey="abtLoginHint",n.ApiActivityIdHeaderKey="X-AS-ActivityID",n.ApiErrorInfoHeaderKey="X-PowerBI-Error-Info",n.ApiPreviousTenantIdHeaderKey="X-PowerBI-User-PreviousTenantId",n.ApiRedirectedFromSignUpHeaderKey="X-PowerBI-RedirectedFromSignup",n.ApiRequestIdHeaderKey="X-AS-RequestID",n.B2bQueryParameterKey="b2b",n.DefaultScopePath="/.default",n.DefaultAuthorityPath="common",n.DefaultSignInQueryParameterKey="defaultSignIn",n.DisableSignInQueryParameterKey="disableSignin",n.DomainHintQueryParameterKey="domain_hint",n.NoSignUpCheckQueryParameterKey="noSignUpCheck",n.OfficeResponseQueryParameterKey="response",n.OfficeResponseDomainNotAllowedValue="DomainNotAllowed",n.OfficeResponseUnsupportedRegionValue="UnsupportedRegion",n.InvitationCodeQueryParameterKey="invitationCode",n.SharingInvitationCodeV2ParameterName="i",n.ReturnUrlQueryParameterKey="ru",n.LiveIdpId="live.com",n.OfficeWaffleTenantIdQueryParameterKey="tenant",n.OfficeWaffleUpnQueryParameterKey="UPN",n.PreviousTenantIdQueryParameterKey="tenantId",n.RedirectedFromSignUpQueryParameterKey="redirectedFromSignup",n.RedirectedWaitSimpleQueryParameterKey="redirectedWaitSimple",n.ClientSideAuthSwitchQueryParameterKey="clientSideAuth",n.FallbackErrorQueryParameterKey="fallbackError",n.SiteId="500453",n.TenantIdQueryParameterKey="ctid",n.LegacyUserSignedUpCookieKey="PowerBIUserSignedUp",n.UserSignedUpCookieKey="PbiUserSignedUp",n.SignedInCookieKey="PowerBISignedInFlag",n.WFESessionIdCookieKey="WFESessionId",n.SingleSignOnRoute="singleSignOn",n.PleaseWaitRoute="PleaseWait",n.ClusterUriCacheKeyPrefix="clusterUri",n.PrivateLinkFixedClusterUriCacheKeyPrefix="PLclusterUri",n.ClusterUriExpiryCacheKeyPrefix="clusterUriExpiry",n.DefaultClusterUri="https://biazure-int-edog-redirect.analysis-df.windows.net/",n.AuthDCParam="authDCParam",n.AppInsightsConnectionString="appInsightsConnectionString",n.AppInsightsConnectionStringExpiryCacheKeyPrefix="appInsightsConnectionStringExpiry",n.AppInsightsV2InstrKey="appInsightsV2InstrKey",n.appInsightsV2EndpointUrlKey="appInsightsV2EndpointUrlKey",n.AppInsightsV2StringExpiryCacheKeyPrefix="appInsightsV2StringExpiry",n.AzureMapsEndpointKey="azureMapsEndpoint",n.TenantHasReamlsCacheKeyPrefix="tenantHasRealms",n.RealmInfoCacheKeyPrefix="realmInfo",n.RealmInfoExpiryCacheKeyPrefix="realmInfoExpiry",n}({}),Dn=function(n){return n.Cache="Cache",n.GlobalService="GlobalService",n}({}),qa=function(n){return n.OfficeWaffle="OfficeWaffle",n.B2b="B2B",n}({}),za=function(n){return n.DashboardInvitation="DashboardInvitation",n.OfficeWaffle="OfficeWaffle",n}({}),Kd=function(n){return n.Error="insufficient_claims",n}({}),Ln="realmId",Hn=window;function xn(){return!!Hn.realmInFabricShellEnabled}var zd=w(616),Wd=w(208),Wa=["AADSTS50081","AADSTS50158","AADSTS53000","AADSTS530003","AADSTS530004","AADSTS53001","AADSTS53002","AADSTS530021","AADSTS53003","AADSTS530032","AADSTS53009","AADSTS700003"],Qa=["AADSTS500341","AADSTS50057","AADSTS50058","AADSTS50173"];function Va(n){if(!n)return"System";try{var e=n.errorInfo??n.message;if(e&&([er.FallbackToRedirection,er.NoNetworkMessage,er.UserAccountChanged,er.UserInteractionDeclined,ye,Vt,Ot,bt,...Wa,...Be.clientAuthEnabled?[]:Qa].some(t=>e.includes(t))||function(n){return!(!n?.includes("redirect_in_iframe")||"/thousandeyes"!==window.parent?.location?.pathname)}(e)||function(n){return function(n){return!!n?.includes(er.UserNotSignedIn)}(n)&&!!window.signInProviderService?.isSignedOut}(e)||function(n,e){return!Be.clientAuthEnabled&&Xa(new q(n,e))}(n.code,e)||Ya(e))||"ClusterResolutionFailure"===n.errorType&&["0","401"].includes(n.errorCode))return"User"}catch{}return"System"}function Qd(n){if(n){var e=n.errorInfo??n.message;if(Ya(e))return"browser_storage_unsupported";if("ClusterResolutionFailure"===n.errorType&&"401"===n.errorCode)return"cluster_resolution_failure_401";if(function(n){return!(!n?.includes("Failed to execute 'setItem' on 'Storage'")&&!n?.includes("The quota has been exceeded."))}(e))return"storage_quota_exceeded";if([zt,Wt].some(t=>e?.includes(t)))return"host_window_unsupported"}}function Ya(n){return Be.clientAuthCacheLocation!==oe.MemoryStorage&&!!n?.includes(Zt)||!!n?.includes(ct)||!!n?.includes("Failed to read the 'sessionStorage' property")}function Xa(n){var t=["AADSTS50076","AADSTS50078","AADSTS50079","AADSTS50142","AADSTS70044",...Wa];return!!n&&(n instanceof he||"InteractionRequiredAuthError"===n.name||["AADSTS50089","AADSTS70008","AADSTS700082","AADSTS700084",...Qa,...t].some(r=>n.message.includes(r))||n.errorCode===qt)}function vo(n){return n().catch(e=>{if(e.message?.includes($t))return window.signInProviderService.isInteractionInProgress$.pipe((0,zd.p)(t=>!t),(0,Wd.s)(1)).toPromise().then(()=>vo(n));throw e})}function ir(n,e){if(e&&e.document&&e.document.cookie){var t=e.document.cookie.split(";");for(var r of t){var i=r.split("=");if(i.length>0&&i[0].trim()===n)return i[1]}}}var Ce=n=>{try{window.logEvent?.(n)}catch{}},Jd=window;function Za(n){if(n&&n.startsWith("Bearer")){for(var r,e={},t=/(\w*?)="(.*?)"/g;null!==(r=t.exec(n));){r.index===t.lastIndex&&t.lastIndex++;var i=r[1];i&&(e[i]=r[2])}return e}}function or(n,e,t){return n?.searchParams?.append(e,t),n}function ue(){return typeof window.performance<"u"&&window.performance.now&&window.performance.timeOrigin?window.performance.now()+window.performance.timeOrigin:(new Date).getTime()}function es(){return window?.performance?.timeOrigin||Jd.initializeContainerStartTime?.getTime()}function W(n,e){for(var t=(e=e||window.location.search).substring(1).split("&"),r=0,i=t.length;r<i;++r){var o=t[r].split("=");if(o[0]?.toLowerCase()===n.toLowerCase())return decodeURIComponent(o[1])}}function ts(n){return n.endsWith("/")?n:n+"/"}function Co(){var n="",e=0;for(e=0;e<32;e+=1){var t=16*Math.random()|0;switch(e){case 8:case 12:case 16:case 20:n+="-"}n+=t.toString(16)}return n}function L(n){return!n||""===n.trim()}function yo(n){var e=function(n){if(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(e).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join(""))}}(n);return e?JSON.parse(e):void 0}function Kn(n){var e=n?.account?.idTokenClaims?n.account.idTokenClaims:{},t=n?.accessToken?function(n){return yo(n.split(".")[1])}(n.accessToken):{},r=e.puid;r||e.idp===S.LiveIdpId&&(r=e.altsecid)||(r=t.puid);var o=t.upn;return o||(o=t.unique_name),{accessToken:n.accessToken,accessTokenExpiry:n.expiresOn,accessTokenExpiryString:n?.expiresOn?.toISOString(),clusterUri:"",givenName:t.given_name?t.given_name:"",objectId:t.oid?t.oid:"",puid:r||"",surname:t.family_name?t.family_name:"",tenantId:n.tenantId,userName:o||"",idp:e.idp?e.idp:"",iss:e.iss?e.iss:"",acct:t.acct,signInState:e.signin_state,wsit:e.xms_wsit}}function ar(n,e){if(Number.isFinite(n)&&Number.isFinite(e))return n-e}function Re(n,e){return new Promise(t=>{e?window.location.replace(n):window.location.href=n})}function Q(n,e,t,r){try{return"setItem"===e?window[n].setItem(t,r??""):window[n].getItem(t)}catch(i){Ce({name:"StorageOperationFailed",properties:{storageType:n,method:e,key:t,message:i.message}})}}var iu=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function rs(n){return iu.test(n)}function ns(n,e){return`${S.ClusterUriCacheKeyPrefix}.${n}.${e}`}function is(n,e){return`${S.ClusterUriExpiryCacheKeyPrefix}.${n}.${e}`}function os(n,e){return`${S.TenantHasReamlsCacheKeyPrefix}.${n}.${e}`}function as(n,e,t){return`${S.RealmInfoCacheKeyPrefix}.${n}.${e}.${t}`}function ss(n,e,t){return`${S.RealmInfoExpiryCacheKeyPrefix}.${n}.${e}.${t}`}function cs(n,e){xn()&&(function(n){Hn.realmInfo=n}(n),function(n,e){var t=new URL(location.href),r=W(Ln,t.search);if(r!==n&&(r||n)){n?t.searchParams.set(Ln,n):t.searchParams.delete(Ln);try{history.replaceState(null,"",t.toString())}catch(i){return void Ce({name:"updateRealmIdInUrl_error",properties:{message:i?.message}})}Ce({name:"updateRealmIdInUrl",properties:{originalRealmId:r,resolvedRealmId:n,resolutionSource:e}})}}(n?.realmId,e),n&&Ce({name:"setGlobalRealmInfo",properties:{realmId:n.realmId,resolutionSource:e}}))}var $e,M=window,k=window,I=window.signInInfo={},Ne=window.signInErrorInfo=[],Bn=window.msalLogInfo=[],Me=(n,e)=>{var t={errorSource:Va(n),attemptNumber:$e,appName:k.clientAuthAppName,...n};if(Ne.push(t),!e)throw t;e(t)},du=window.location.origin+"/signin",ls="Cannot initialize MSAL application, missing global property:",Ao=[k.clientAuthResourceUrl+S.DefaultScopePath];class ds{isInIframe(){if(null===this._isInIframe)try{this._isInIframe=window.self!==window.top}catch{this._isInIframe=!0}return this._isInIframe}get isSignedOut(){return this._isSignedOut}constructor(){this.signOutEventListeners=[],this._isSignedOut=!1,this._isInteractionInProgress$=new xd.t(this.isInteractionInProgress()),this._isInIframe=null,this.isInteractionInProgress$=this._isInteractionInProgress$.asObservable(),I.appName=k.clientAuthAppName,I.pageLoadStartTimestamp=es(),this._initializePromise=this.initializeClientApp()}ensureClientApplicationInitialized(){return this._initializePromise}registerSignOutEventListener(e){this.signOutEventListeners.push(e)}checkForOfficeResponseRedirect(){return(0,v.A)(function*(){if(window.location.search&&window.location.search.length>0){var e=W(S.OfficeResponseQueryParameterKey);if(!L(e)){var t=null;switch(e){case S.OfficeResponseDomainNotAllowedValue:t=k.clientAuthOfficeResponseRedirectUrl_DomainNotAllowed;break;case S.OfficeResponseUnsupportedRegionValue:t=k.clientAuthOfficeResponseRedirectUrl_UnsupportedRegion}t&&(yield Re(t))}}})()}checkForSignUpRedirect(){var e=this;return(0,v.A)(function*(){var t=!1;if(window.location.search&&window.location.search.length>0&&(t=!L(W(S.DefaultSignInQueryParameterKey))),(t||k.clientAuthRequireUserSignUpCheck&&!L(k.clientAuthSignUpRedirectUrl))&&e.shouldRedirectToSignUp())if(k.clientAuthDefaultSignInCheck&&(k.clientAuthCheckOfficeDefaultSignIn||t)){var r=new URL(window.location.href),i=new URL(window.location.href);r=or(r,S.NoSignUpCheckQueryParameterKey,"1"),(i=or(i,S.ReturnUrlQueryParameterKey,r.toString())).pathname=S.SingleSignOnRoute,yield Re(i.toString())}else{var o=new URL(window.location.href),a=new URL(k.clientAuthSignUpRedirectUrl);o=or(o,S.NoSignUpCheckQueryParameterKey,"1"),a=or(a,S.ReturnUrlQueryParameterKey,o.toString()),yield Re(a.toString())}else if(window.location.search&&window.location.search.length>0&&!L(W(S.RedirectedFromSignUpQueryParameterKey))&&L(W(S.RedirectedWaitSimpleQueryParameterKey))&&L(ir(S.UserSignedUpCookieKey,window))&&L(ir(S.LegacyUserSignedUpCookieKey,window))&&k.clientAuthPleaseWaitDelayInSeconds&&parseInt(k.clientAuthPleaseWaitDelayInSeconds,10)>0){var s=new URL(window.location.href);(s=or(s,S.RedirectedWaitSimpleQueryParameterKey,"1")).pathname=S.PleaseWaitRoute,yield Re(s.toString())}})()}clearTransientSignInConfigParamsBeforeRedirect(e){try{var t=new URL(window.location.href);return t.searchParams.delete(S.NoSignUpCheckQueryParameterKey),t.searchParams.delete(S.NoSignUpCheckQueryParameterKey.toLowerCase()),t.searchParams.delete(S.OfficeWaffleUpnQueryParameterKey),t.searchParams.delete(S.OfficeWaffleUpnQueryParameterKey.toLowerCase()),e.redirectStartPage=t.toString(),e}catch(r){return e}}constructRequestQueryParameters(){var e={site_id:S.SiteId,nux:"1"};if(window.location.search&&window.location.search.length>0){var t=W(S.DomainHintQueryParameterKey);L(t)||(e.domain_hint=t);var r=W(S.InvitationCodeQueryParameterKey);if(L(r)){var o=W(S.OfficeWaffleUpnQueryParameterKey);L(o)||(I.loginInHintSource=za.OfficeWaffle,e.login_hint=o)}else{var i=decodeURIComponent(r).split("|");i.length>2&&(I.loginInHintSource=za.DashboardInvitation,e.login_hint=i[2])}var a=W(S.TenantIdQueryParameterKey),s=W(S.B2bQueryParameterKey);(L(a)&&(L(r)||L(s))||!k.clientAuthAllowConsumerDomains)&&(e.msafed="0")}return e}getTokenQueryParameters(){var e=W(S.AuthDCParam);if(window.CAEAuth&&!L(e))return{dc:e}}getClusterForPublishedTenant(e){var t=Co(),r=ue();return Ce({name:"GetClusterForPublishedTenant_Start",properties:{tenantId:e,requestId:t}}),new Promise((i,o)=>{try{var c=`${ts(k.clientAuthApimUrl)}public/routing/cluster/${e}`,l=new XMLHttpRequest;l.open("GET",c,!0),l.setRequestHeader("Accept","application/json"),l.setRequestHeader(S.ApiActivityIdHeaderKey,k.clientAuthWfeSessionId),l.setRequestHeader(S.ApiRequestIdHeaderKey,t),l.onreadystatechange=(0,v.A)(function*(){var h;try{if(l.readyState===XMLHttpRequest.DONE)if(I.clusterResolutionEndTime=ue(),200===(h=l.status)){var u=JSON.parse(l.responseText);if(L(u.FixedClusterUri)){var f={errorType:ae.MissingFixedClusterUriProperty,errorInfo:`Response is missing fixedClusterUri property and error header is: ${l.getResponseHeader(S.ApiErrorInfoHeaderKey)}`,errorCode:h.toString(),requestId:t};Me(f,o)}else i(u)}else{var p={errorType:ae.ClusterResolutionFailure,errorInfo:`Response code is not 200. Error header is: ${l.getResponseHeader(S.ApiErrorInfoHeaderKey)}`,errorCode:h.toString(),requestId:t};Me(p,o)}}catch(A){var m={errorType:ae.ClusterResolutionFailure,errorInfo:`Cluster resolution failed. ${A.message}`,errorCode:h.toString(),requestId:t};Me(m,o)}}),I.clusterResolutionStartTime=ue(),l.send()}catch(h){var d={errorType:ae.ClusterResolutionFailure,errorInfo:h.toString(),errorCode:h.status?.toString(),requestId:t};Me(d,o)}}).then(i=>(Ce({name:"GetClusterForPublishedTenant",properties:{tenantId:e,requestId:t,operationStartTime:r,operationEndTime:ue(),clusterUri:i.FixedClusterUri}}),i))}getOrInsertClusterForTenant(e,t,r,i,o){var a=Co();return new Promise((s,c)=>{try{var l=function(n,e){return`${ts(n)}spglobalservice/GetOrInsertClusterUrisByTenantLocation?${encodeURIComponent(e)}`}(k.clientAuthApiUrl,k.clientAuthClusterUrl),d=new XMLHttpRequest;d.open("PUT",l,!0),d.setRequestHeader("Accept","application/json"),d.setRequestHeader("Authorization",`Bearer ${e}`),d.setRequestHeader(S.ApiActivityIdHeaderKey,k.clientAuthWfeSessionId),d.setRequestHeader(S.ApiRequestIdHeaderKey,a),function(n,e){if(e&&xn()){if(!rs(e))return void Ce({name:"setRealmResolutionHeader_invalidRealmId",properties:{realmId:e}});n.setRequestHeader("x-ms-fabric-realm-id",e)}}(d,o),L(i)||d.setRequestHeader(S.ApiPreviousTenantIdHeaderKey,i),r&&d.setRequestHeader(S.ApiRedirectedFromSignUpHeaderKey,"true"),d.onreadystatechange=(0,v.A)(function*(){var u;try{if(d.readyState===XMLHttpRequest.DONE)if(I.clusterResolutionEndTime=ue(),200===(u=d.status)){var f=JSON.parse(d.responseText);if(f.FixedClusterUri&&""!==f.FixedClusterUri.trim())s(f);else{var p={errorType:ae.MissingFixedClusterUriProperty,errorInfo:`Response is missing fixedClusterUri property and error header is: ${d.getResponseHeader(S.ApiErrorInfoHeaderKey)}`,errorCode:u.toString(),attemptNumber:$e,requestId:a,realmId:o,appName:k.clientAuthAppName};Ne.push(p),c(p)}}else{var m={errorType:ae.ClusterResolutionFailure,errorInfo:`Response code is not 200. Error header is: ${d.getResponseHeader(S.ApiErrorInfoHeaderKey)}`,errorCode:u.toString(),attemptNumber:$e,requestId:a,realmId:o,appName:k.clientAuthAppName};Ne.push(m),c(m)}}catch(y){var A={errorType:ae.Unexpected,errorInfo:`Cluster resolution failed. ${y.message}`,errorCode:u.toString(),attemptNumber:$e,requestId:a,realmId:o,appName:k.clientAuthAppName};Ne.push(A),c(A)}}),I.clusterResolutionStartTime=ue(),d.send()}catch(u){var h={errorType:ae.Unexpected,errorInfo:`Cluster resolution failed. ${u.message}`,errorCode:u.status?.toString(),attemptNumber:$e,requestId:a,realmId:o,appName:k.clientAuthAppName};Ne.push(h),c(h)}})}initializeClientApp(){I.wFESessionId=k.clientAuthWfeSessionId,I.CAEAuth=window.CAEAuth,k.clientAuthClientId||Me({errorType:ae.Unexpected,errorInfo:`${ls} 'clientAuthClientId'`});var t=M.msalConfigRedirectUrlOverride??du,r={auth:{clientId:k.clientAuthClientId,authority:this.resolveAuthority(),redirectUri:t},cache:{cacheLocation:window.clientAuthCacheLocation??"sessionStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(i,o,a)=>{if(!a)switch(i){case G.Error:return void Bn.push({logType:Un.Error,logMessage:o});case G.Info:return void Bn.push({logType:Un.Info,logMessage:o});case G.Verbose:return void Bn.push({logType:Un.Debug,logMessage:o});case G.Warning:return void Bn.push({logType:Un.Warning,logMessage:o})}}}}};return window.CAEAuth&&(r.auth.clientCapabilities=["CP1"]),k.clientAuthTimeoutIncrease&&(r.system.iframeHashTimeout=12e3),this.msalClientApplication=new nr(r),this.msalClientApplication.initialize().then(()=>{this.msalClientApplication.addEventCallback(()=>{this._isInteractionInProgress$.next(this.isInteractionInProgress())}),this.msalClientApplication.addPerformanceCallback(i=>{try{i.forEach(o=>{var a={name:"msal.perf",properties:{...o}};Ce(a)})}catch{}})})}resolveAuthority(){if(k.clientAuthAadInstance||Me({errorType:ae.Unexpected,errorInfo:`${ls} 'clientAuthAadInstance'`}),!L(W(S.OfficeWaffleUpnQueryParameterKey))){var r=W(S.OfficeWaffleTenantIdQueryParameterKey);if(!L(r))return I.authorityScope=r,I.authorityOverrideSource=qa.OfficeWaffle,k.clientAuthAadInstance.replace("{0}",r)}var i=W(S.TenantIdQueryParameterKey);return L(i)?(I.authorityScope=S.DefaultAuthorityPath,k.clientAuthAadInstance.replace("{0}",S.DefaultAuthorityPath)):(I.authorityScope=i,I.authorityOverrideSource=qa.B2b,k.clientAuthAadInstance.replace("{0}",i))}resolveClusterUri(e,t){var r=this;return(0,v.A)(function*(){var i,o=W(S.PreviousTenantIdQueryParameterKey);if(L(t))return L(o)?(I.noTenantSpecified=!0,k.clientAuthApiUrl):"";var a=null,s=function(n){if(!xn())return"";var e=W(Ln,n);return rs(e)?e:(Ce({name:"extractRealmIdFromLocationSearch_invalidRealmId",properties:{realmId:e}}),"")}(window.location.search),c=r.retrieveClusterUriFromCache(t,s);if(c)return I.clusterUriResolutionSource=Dn.Cache,c;var l=null,d=null,h=null;if(L(e))i=yield r.getClusterForPublishedTenant(t);else{i=yield r.getOrInsertClusterForTenant(e,t,!L(W(S.RedirectedFromSignUpQueryParameterKey)),o,s);var u=i.Clients?.find(A=>"trident-web"===A.Name);if(u&&u.AppInsightsConnectionString){M.connectionString=l=u.AppInsightsConnectionString;var f=function(n){return n.split(";").reduce((r,i)=>{var[o,a]=i.split("=");return r[o.trim()]=a.trim(),r},{})}(l);I.appInsightsInstrumentationKey=f.InstrumentationKey?f.InstrumentationKey:null,f.InstrumentationKey&&f.IngestionEndpoint&&(window.appInsightsV2InstrKey=f.InstrumentationKey,window.appInsightsV2EndpointUrl=f.IngestionEndpoint+"v2/track",d=window.appInsightsV2InstrKey,h=window.appInsightsV2EndpointUrl,a={connectionString:l,tenantId:t,timestamp:ue()},window.sessionStorage.setItem("appInsightsConnectionStringInfo",JSON.stringify(a)))}}var p=M.azureMapsEndpoint=i.ClientServicesMetadata?.AzureMapsDomain,m=function(n){var e=n.FixedClusterUri,t=n.PrivateLinkFixedClusterUri,r=n.HasRealms,i=n.RealmClusterAssignmentRecord,o=e,a=void 0;return xn()&&i?.Cluster&&i?.RealmId&&(a={realmId:i.RealmId,tenantId:i.TenantId,friendlyName:i.FriendlyName,region:i.Region,clusterUri:i.Cluster},t||(o=a.clusterUri)),{clusterUri:o,homeClusterUri:e,privateLinkFixedClusterUri:t,tenantHasRealms:r,realmInfo:a}}(i);return r.setClusterUriCacheEntry(t,m.homeClusterUri,m.privateLinkFixedClusterUri,l,d,h,p,m.tenantHasRealms,m.realmInfo),M.homeClusterUri=m.homeClusterUri,M.privateLinkFixedClusterUri=m.privateLinkFixedClusterUri,M.tenantHasRealms=m.tenantHasRealms,cs(m.realmInfo,Dn.GlobalService),I.clusterUriResolutionSource=Dn.GlobalService,m.clusterUri})()}retrieveSignedInAccount(){var e=this;return(0,v.A)(function*(){yield e.ensureClientApplicationInitialized();var t=e.msalClientApplication.getActiveAccount();if(!t){var r=e.msalClientApplication.getAllAccounts();if(r&&r.length>0)return e.msalClientApplication.setActiveAccount(r[0]),r[0]}return t??void 0})()}setCookie(e,t,r="/",i="none",o){o||(o=new Date).setFullYear(o.getFullYear()+1),window&&window.document&&(window.document.cookie=e+" = "+t+";secure;partitioned;path="+r+";expires="+o.toUTCString()+";samesite="+i,L(ir(e,window))&&(window.document.cookie=e+" = "+t+";secure;path="+r+";expires="+o.toUTCString()+";samesite="+i))}shouldRedirectToSignUp(){if(!k.clientAuthPrivateLinkHeaderPresent&&!k.clientAuthAccessTokenPresentInRequestBody&&L(ir(S.UserSignedUpCookieKey,window))&&L(ir(S.LegacyUserSignedUpCookieKey,window))){if(!(window.location.search&&window.location.search.length>0))return!0;if(L(W(S.NoSignUpCheckQueryParameterKey))&&L(W(S.RedirectedFromSignUpQueryParameterKey))&&L(W(S.OfficeWaffleTenantIdQueryParameterKey))&&L(W(S.OfficeWaffleUpnQueryParameterKey))&&L(W(S.SharingInvitationCodeV2ParameterName)))return!0}return!1}removeCookie(e,t="/",r="none"){var i=new Date("1970-01-01Z00:00:00:000");window&&window.document&&(window.document.cookie=e+" = ;secure;partitioned;path="+t+";expires="+i.toUTCString()+";samesite="+r,window.document.cookie=e+" = ;secure;path="+t+";expires="+i.toUTCString()+";samesite="+r)}retrieveClusterUriFromCache(e,t){if(!e)return null;var r,o=Q("localStorage","getItem",is(e,M.environmentName));if(!o||o<=Date.now().toString())return function(n,e){try{Object.keys(localStorage).forEach(t=>{t.startsWith(`${S.RealmInfoCacheKeyPrefix}.${n}`)&&t.endsWith(e)&&localStorage.removeItem(t)})}catch(t){Ce({name:"cleanRealmInfoCache_error",properties:{tenantId:n,message:t?.message}})}}(e,M.environmentName),null;var s=Q("localStorage","getItem",ns(e,M.environmentName));if(!s)return null;r=s,M.homeClusterUri=s;var l="true"===Q("localStorage","getItem",os(e,M.environmentName));if(M.tenantHasRealms=l,t){var h=Q("localStorage","getItem",ss(e,t,M.environmentName));if(!h||h<=Date.now().toString())return null;var p,f=Q("localStorage","getItem",as(e,t,M.environmentName));try{p=f?JSON.parse(f):null}catch(pu){return Ce({name:"parseRealmInfoCache_error",properties:{tenantId:e,message:pu?.message}}),null}var m=p?.clusterUri;if(!m)return null;r=m,cs(p,Dn.Cache)}var y=Q("localStorage","getItem",`${S.AppInsightsConnectionString}.${e}.${M.environmentName}`);y&&(M.connectionString=y);var K=Q("localStorage","getItem",`${S.AppInsightsV2InstrKey}.${e}.${M.environmentName}`);K&&(window.appInsightsV2InstrKey=K);var H=Q("localStorage","getItem",`${S.appInsightsV2EndpointUrlKey}.${e}.${M.environmentName}`);if(H&&(window.appInsightsV2EndpointUrl=H),!y||!K||!H)return null;var Ue=Q("localStorage","getItem",`${S.AzureMapsEndpointKey}.${e}.${M.environmentName}`);Ue&&(M.azureMapsEndpoint=Ue);var gs=Q("localStorage","getItem",`${S.PrivateLinkFixedClusterUriCacheKeyPrefix}.${e}.${M.environmentName}`);return gs&&(M.privateLinkFixedClusterUri=gs),I.clusterUriCacheExpiry=o,r}setClusterUriCacheEntry(e,t,r,i,o,a,s,c,l){if(e&&t){var d=Date.now()+36e5,h=ns(e,M.environmentName),u=is(e,M.environmentName);if(Q("localStorage","setItem",h,t),Q("localStorage","setItem",u,d.toString()),Q("localStorage","setItem",os(e,M.environmentName),c?"true":"false"),l){var p=as(e,l.realmId,M.environmentName),m=ss(e,l.realmId,M.environmentName);Q("localStorage","setItem",p,JSON.stringify(l)),Q("localStorage","setItem",m,d.toString())}if(r&&Q("localStorage","setItem",`${S.PrivateLinkFixedClusterUriCacheKeyPrefix}.${e}.${M.environmentName}`,r),i){var _=`${S.AppInsightsConnectionStringExpiryCacheKeyPrefix}.${e}.${M.environmentName}`;Q("localStorage","setItem",`${S.AppInsightsConnectionString}.${e}.${M.environmentName}`,i),Q("localStorage","setItem",_,d.toString())}if(o){var Y=`${S.AppInsightsV2StringExpiryCacheKeyPrefix}.${e}.${M.environmentName}`;Q("localStorage","setItem",`${S.AppInsightsV2InstrKey}.${e}.${M.environmentName}`,o),Q("localStorage","setItem",Y,d.toString())}if(a){var te=`${S.AppInsightsV2StringExpiryCacheKeyPrefix}.${e}.${M.environmentName}`;Q("localStorage","setItem",`${S.appInsightsV2EndpointUrlKey}.${e}.${M.environmentName}`,a),Q("localStorage","setItem",te,d.toString())}s&&Q("localStorage","setItem",`${S.AzureMapsEndpointKey}.${e}.${M.environmentName}`,s)}}setGlobalVariablesFromAuthResult({accessToken:e,accessTokenExpiryString:t,tenantId:r,clusterUri:i,userName:o,givenName:a,surname:s,puid:c,objectId:l,idp:d,iss:h,acct:u}){if(!t){var f={errorType:ae.AccessTokenExpiryStringUndefined,errorInfo:"accessTokenExpiryString has to be defined",attemptNumber:$e,appName:k.clientAuthAppName};throw Ne.push(f),f}M.powerBIAccessToken=e,M.powerBIAccessTokenExpiry=t,M.tenantId=r,M.clusterUri=i;var p=function(){window.powerbi||(window.powerbi={});var n=window.powerbi;return n.session||(n.session={}),n.session.userInfo||(n.session.userInfo={}),n.session.userInfo}();return p.name=o,p.givenName=a,p.surname=s,p.puid=c,p.uoid=l,p.idp=d,p.iss=h,p.acct=u,p}setAuthFlags(){this.setCookie(S.UserSignedUpCookieKey,"1"),this.setCookie(S.LegacyUserSignedUpCookieKey,"1"),this.setCookie(S.SignedInCookieKey,"1"),window.sessionStorage.setItem(ki,"1"),I.signInSucceeded=!0}signInInternal(e){var t=this;return(0,v.A)(function*(){var r,i=t.isInteractionInProgress()&&!e?.isTokenRefresh?yield t.msalClientApplication.handleRedirectPromise():null;if(null!==i){t.msalClientApplication.setActiveAccount(i.account),I.signInUserInteractionEndTime=es(),I.postRedirectSignInStartTimestamp=ue();var o,a,s,c=i.state?.split(";");c&&(o=c[0],a=c[1],s=c[2]),I.signInStartTime=Number(o||0),I.signInUserInteractionStartTime=Number(a||0),I.pageLoadStartTimestamp=Number(s||0),I.signInMethod=i.fromCache?"Cache":"Redirect",(!(r=Kn(i)).accessTokenExpiry||r.accessTokenExpiry&&r.accessTokenExpiry.getTime()<=Date.now())&&(I.tokenExpiredAfterRedirect=!0,r=yield t.acquireToken(e)),window.CAEAuth&&e?.claimChallenge&&(I.claimChallengeAfterRedirect=!0,r=yield t.acquireToken(e))}else r=yield t.acquireToken(e);if(r){if(!(I.tenantId=r.tenantId,I.userObjectId=r.objectId,I.userPuid=r.puid,e?.isTokenRefresh||(yield t.validateTenantAndRedirectIfNeeded(r.tenantId,r.idp,e))))return yield t.signInInternal({forceRefresh:!0,promptedByTenantMismatch:!0});I.resolveClusterUri=e?.resolveClusterUri,r.clusterUri=!1!==e?.resolveClusterUri?I.clusterUri=yield t.resolveClusterUri(r.accessToken,r.tenantId):M.clusterUri,t.setGlobalVariablesFromAuthResult(r),t.setAuthFlags()}return r})()}acquireToken(e){var t=this;return(0,v.A)(function*(){I.claimChallengeAuth=!!e?.claimChallenge,I.dialogPopup=e?.dialogPopup?.enabled;var r,i=yield t.retrieveSignedInAccount();if(i)try{var o=e?.claimChallenge?Za(e?.claimChallenge):void 0,a=o?.error===Kd.Error?yo(o?.claims):void 0,s=JSON.stringify(window.CAEAuth?{access_token:{xms_cc:{values:["CP1"]},...a?.access_token},...e?.claims}:e?.claims),c=yield t.msalClientApplication.acquireTokenSilent({scopes:Ao,extraQueryParameters:t.constructRequestQueryParameters(),tokenQueryParameters:t.getTokenQueryParameters(),account:i,forceRefresh:e?.forceRefresh??!1,claims:s});t.msalClientApplication.setActiveAccount(c.account),r=Kn(c),I.signInMethod="Silent"}catch(y){if(Xa(y))try{I.signInUserInteractionStartTime||t.markUserInteractionStartTime();var l=I?.signInStartTime+";"+I?.signInUserInteractionStartTime+";"+I?.pageLoadStartTimestamp;null!=M.msalConfigRedirectUrlOverride&&(l=I?.signInStartTime+";"+I?.signInUserInteractionStartTime+";"+I?.pageLoadStartTimestamp+";cst="+window.location.host.split(".")[0]);var d={scopes:Ao,extraQueryParameters:t.constructRequestQueryParameters(),tokenQueryParameters:t.getTokenQueryParameters(),state:l};return yield vo((0,v.A)(function*(){if(e?.interactionHandler&&(yield e.interactionHandler()),e?.dialogPopup?.enabled||t.isInIframe()){var _=yield t.msalClientApplication.acquireTokenPopup(d);t.msalClientApplication.setActiveAccount(_.account),I.signInUserInteractionEndTime=ue(),I.signInMethod="Popup",r=Kn(_)}else yield t.msalClientApplication.acquireTokenRedirect(d)})),r}catch(_){var h={errorType:ae.AcquireTokenFailure,errorInfo:_.toString(),errorCode:_.errorCode??_.status?.toString()};Me(h)}var u={errorType:ae.AcquireTokenFailure,errorInfo:y.toString(),errorCode:y.errorCode??y.status?.toString()};Me(u)}else{k.clientAuthRedirectChecks&&!e?.isTokenRefresh&&(yield t.checkForSignUpRedirect());try{I.signInUserInteractionStartTime||t.markUserInteractionStartTime();var f=I?.signInStartTime+";"+I?.signInUserInteractionStartTime+";"+I?.pageLoadStartTimestamp;null!=M.msalConfigRedirectUrlOverride&&(f=I?.signInStartTime+";"+I?.signInUserInteractionStartTime+";"+I?.pageLoadStartTimestamp+";cst="+window.location.host.split(".")[0]);var p={scopes:Ao,extraQueryParameters:t.constructRequestQueryParameters(),tokenQueryParameters:t.getTokenQueryParameters(),state:f};k.clientAuthRedirectChecks&&!e?.isTokenRefresh&&(p=t.clearTransientSignInConfigParamsBeforeRedirect(p));try{var m=window.sessionStorage.getItem(S.AbtLoginHintCacheKey);m&&(window.sessionStorage.removeItem(S.AbtLoginHintCacheKey),p.loginHint=m)}catch{}return yield vo((0,v.A)(function*(){if(e?.interactionHandler&&(yield e.interactionHandler()),e?.dialogPopup?.enabled||t.isInIframe()){I.signInMethod="Popup";var y=yield t.msalClientApplication.loginPopup(p);t.msalClientApplication.setActiveAccount(y.account),I.signInUserInteractionEndTime=ue(),r=Kn(y)}else yield t.msalClientApplication.loginRedirect(p)})),r}catch(y){var A={errorType:ae.LoginRedirectFailure,errorInfo:y.toString(),errorCode:y.errorCode??y.status?.toString()};Me(A)}}return r})()}validateTenantAndRedirectIfNeeded(e,t,r){var i=this;return(0,v.A)(function*(){if(null===e&&(yield Re("/SignupRedirect")),k.clientAuthRedirectChecks){var o,a=W(S.OfficeWaffleTenantIdQueryParameterKey),s=W(S.TenantIdQueryParameterKey);if(L(a))if(L(s)){if(t)try{var l=new URL(t).pathname;l.startsWith("/")&&(l=l.substring(1)),l.endsWith("/")&&(l=l.substring(0,l.length-1)),o=l}catch(m){}}else o=s;else o=a;if(o&&o.toLowerCase()!==e.toLowerCase()){if(yield i.checkForSignUpRedirect(),L(a)&&L(s)){var d=new URL(window.location.href);d.searchParams.set(S.TenantIdQueryParameterKey,e),yield Re(d.toString())}if(!r?.promptedByTenantMismatch)return!1}}if(!k.clientAuthAllowedTenantIdsFilterEnabled||k.clientAuthAllowedTenantIds.includes(e.toLowerCase())||(window.location.pathname+window.location.search).startsWith("/invite?")||(window.location.pathname+window.location.search).startsWith("/invite.cshtml?")){if(k.clientAuthTenantEnvironmentRedirect&&k.clientAuthTenantEnvironmentRedirectMapping?.includes(e)&&!(window.location.pathname+window.location.search).startsWith("/invite?")&&!(window.location.pathname+window.location.search).startsWith("/invite.cshtml?")){var u=function(n,e){var t=n.split(new RegExp("[,;]")),r=t.indexOf(e);return r>-1?t[r+1]:null}(k.clientAuthTenantEnvironmentRedirectMapping,e);if(u&&!window.location.href.includes(u)&&(!Hn.realmInFabricShellEnabled||!Hn.realmInfo?.realmId)){var f=i.createQueryParams(u),p=`${u}${window.location.pathname}${f}`;yield Re(p)}}}else{var h=new URL(k.clientAuthUnallowedTenantRedirect);h.searchParams.set(S.TenantIdQueryParameterKey,e),yield Re(h.toString())}return!0})()}isInteractionInProgress(){return!!Q("sessionStorage","getItem","msal.interaction.status")}handleRedirect(){this.isInteractionInProgress()&&this.ensureClientApplicationInitialized().then(()=>{this.msalClientApplication.handleRedirectPromise()}).then(()=>{}).catch(()=>{})}signIn(e){var t=this;return(0,v.A)(function*(){if(yield t.ensureClientApplicationInitialized(),$e=1,Ne.length=0,L(W(S.DisableSignInQueryParameterKey))){k.clientAuthRedirectChecks&&!e?.isTokenRefresh&&(yield t.checkForOfficeResponseRedirect());for(var o=0;o<3;o++)try{I.signInStartTime=ue();var a=yield t.signInInternal(e);return I.signInCompletionTime=ue(),t.calculateSignInDuration(),a}catch(y){if(2!==o){$e++;continue}var s=(y?.errorInfo??y?.message??"").substring(0,1024),c=y?.errorSource??Va(y),l=Qd(y)??y?.errorCode??"";if(M.clientAuthFallbackToServerOnError){var d={flow:e?.isTokenRefresh?"TokenRefresh":k.clientAuthAppName,type:y?.errorType,source:c,info:s,code:l,raid:y?.requestId,tenant:I?.tenantId,uoid:I?.userObjectId,puid:I?.userPuid},h=new URL(window.location.href);h.searchParams.set(S.ClientSideAuthSwitchQueryParameterKey,"0"),h.searchParams.set(S.FallbackErrorQueryParameterKey,JSON.stringify(d)),yield Re(h.toString(),!0)}else{var u=y?.errorType??ae.Unexpected,f=ic.includes(l),p=oc.includes(l),m=Ne?.map(_=>({..._,errorInfo:_.errorInfo?.substring(0,1024/Ne.length)})),A=m?JSON.stringify(m):null;if(e?.isTokenRefresh)throw{errorType:u,errorInfo:s,errorCode:l,errorArray:A,extDocRequired:f,newTabRequired:p};yield Re(`/ErrorPage?telemetryType=SignIn&errorType=${encodeURIComponent(u)}${s?`&errorInfo=${encodeURIComponent(s)}`:""}${l?`&code=${encodeURIComponent(l)}`:""}${y?.requestId?`&raid=${encodeURIComponent(y.requestId)}`:""}&appName=${encodeURIComponent(k.clientAuthAppName)}${f?"&extDoc=true":""}${p?"&newTab=true":""}${c?`&source=${encodeURIComponent(c)}`:""}${I.tenantId?`&tenantId=${encodeURIComponent(I.tenantId)}`:""}${I.userObjectId?`&userObjectId=${encodeURIComponent(I.userObjectId)}`:""}${I.userPuid?`&userPuid=${encodeURIComponent(I.userPuid)}`:""}${A?`&errorArray=${encodeURIComponent(A)}`:""}`)}}}else{var r=yield t.retrieveSignedInAccount(),i=r?.idTokenClaims;t.setGlobalVariablesFromAuthResult({accessToken:"",clusterUri:S.DefaultClusterUri,givenName:r?.name??"",puid:i?.puid??"",surname:"",tenantId:r?.tenantId??"",accessTokenExpiryString:new Date(Date.now()+864e5).toISOString(),userName:r?.username??"",objectId:i?.oid})}})()}signOut(e,t){var r=this;return(0,v.A)(function*(){yield r.ensureClientApplicationInitialized();var i=yield r.retrieveSignedInAccount();r.removeCookie(S.SignedInCookieKey),r.removeCookie(S.WFESessionIdCookieKey),i?.tenantId&&(localStorage.removeItem(`${S.ClusterUriCacheKeyPrefix}.${i.tenantId}.${M.environmentName}`),localStorage.removeItem(`${S.PrivateLinkFixedClusterUriCacheKeyPrefix}.${i.tenantId}.${M.environmentName}`),localStorage.removeItem(`${S.ClusterUriExpiryCacheKeyPrefix}.${i.tenantId}.${M.environmentName}`),Object.keys(localStorage).forEach(a=>{a.startsWith(`${S.ClusterUriCacheKeyPrefix}.${i.tenantId}.`)&&a.endsWith(`.${M.environmentName}`)&&localStorage.removeItem(a)})),r._isSignedOut=!0,[...r.signOutEventListeners].forEach(a=>a());var o={account:i,postLogoutRedirectUri:t||null,logoutHint:i?.idTokenClaims?.login_hint};e?yield r.msalClientApplication.logoutPopup(o):yield r.msalClientApplication.logoutRedirect(o)})()}calculateSignInDuration(){I.signInUserInteractionDuration=ar(I?.signInUserInteractionEndTime,I?.signInUserInteractionStartTime),I.clusterResolutionDuration=ar(I?.clusterResolutionEndTime,I?.clusterResolutionStartTime),Number.isFinite(I.signInUserInteractionDuration)&&(I.preRedirectSignInStartTimestamp=I?.signInStartTime,I.preRedirectSignInEndTimestamp=I?.signInUserInteractionStartTime,I.postRedirectSignInEndTimestamp=I?.signInCompletionTime,I.preRedirectSignInDuration=ar(I?.preRedirectSignInEndTimestamp,I?.preRedirectSignInStartTimestamp),I.postRedirectSignInDuration=ar(I?.postRedirectSignInEndTimestamp,I?.postRedirectSignInStartTimestamp)),I.signInNonInteractiveDuration=Number.isFinite(I?.preRedirectSignInDuration)&&Number.isFinite(I?.postRedirectSignInDuration)?I?.preRedirectSignInDuration+I?.postRedirectSignInDuration:ar(I?.signInCompletionTime,I?.signInStartTime)}createQueryParams(e){var t=window.location.search,r=k.clientAuthGetAppSpecificQueryParams?k.clientAuthGetAppSpecificQueryParams(window.location.href,e)?.toString():"";return r?`${t}${t?"&":"?"}${r}`:t}markUserInteractionStartTime(e=ue()){I.signInUserInteractionStartTime=e}}Cn.init();var us=window,Fn=window.signInProviderService=new ds;function uu(n){return window.msalClientApplication=Fn.msalClientApplication,us.clientAuthInSignInPageContext?Fn.handleRedirect():window.signInPromise=us.clientAuthEagerlyLogTelemetry?new Promise((e,t)=>{Fn.signIn(n).then(r=>{w.e("SignInTelemetry").then(w.bind(w,378)).then(i=>{var o=window.powerbi?.createTelemetryService(window.powerbi?.createTelemetryOptions(),window.powerbi?.createTelemetryHostService(),window.powerbi?.createUserActivityContextService());new i.SignInTelemetryLogger(o).logAndFlushQueue(),e(r)}).catch(i=>{t(i)})}).catch(r=>{t(r)})}):Fn.signIn(n),window.signInPromise}function hu(n,e){return window.signInProviderService.signOut(n,e)}function hs(){return window.signInProviderService?window.signInProviderService.retrieveSignedInAccount():Promise.resolve(void 0)}function gu(){return To.apply(this,arguments)}function To(){return(To=(0,v.A)(function*(){return void 0!==(yield hs())})).apply(this,arguments)}function fu(){return vn()}window.addEventListener("beforeunload",()=>{window.sessionStorage.removeItem(ki)}),window.clientAuthProvider=Gn}();